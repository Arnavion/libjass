{"version":3,"sources":["../src/settings.ts","../src/index.ts","../src/version.ts","../src/renderers/index.ts","../src/renderers/default.ts","../src/renderers/web/renderer.ts","../src/renderers/web/span-styles.ts","../src/renderers/web/font-size.ts","../src/renderers/web/drawing-styles.ts","../src/renderers/web/animation-collection.ts","../src/renderers/web/keyframe.ts","../src/renderers/null.ts","../src/parser/ttf.ts","../src/renderers/settings.ts","../src/renderers/clocks/video.ts","../src/renderers/clocks/auto.ts","../src/renderers/clocks/manual.ts","../src/utility/mixin.ts","../src/renderers/clocks/base.ts","../src/parser/index.ts","../src/parser/stream-parsers.ts","../src/types/ass.ts","../src/types/script-properties.ts","../src/types/dialogue.ts","../src/types/style.ts","../src/types/attachment.ts","../src/parser/misc.ts","../src/parser/streams.ts","../src/parser/parse.ts","../src/parts/index.ts","../src/parts/drawing.ts","../src/types/misc.ts","../src/webworker/index.ts","../src/webworker/channel.ts","../src/webworker/misc.ts","../src/webworker/commands.ts","../src/serialization.ts","../src/utility/promise.ts","../src/utility/map.ts","../src/utility/set.ts"],"names":["exports","factory","global","libjass","def","moduleId","deps","body","req","registeredModules","Object","create","apply","configure","newConfig","debugMode","settings","setDebugMode","verboseMode","setVerboseMode","Set","set","setImplementation","Map","map","Promise","promise","settings_11","set_2","map_15","promise_8","DeferredPromise","webworker","parts","parser","renderers","serialize","serialization_8","deserialize","ASS","ass_2","Attachment","attachment_3","AttachmentType","Dialogue","dialogue_3","ScriptProperties","script_properties_2","Style","style_3","BorderStyle","misc_9","Format","WrappingStyle","version","version_1","defineProperties","get","value","console","warn","ClockEvent","base_4","EventSource","AutoClock","auto_2","ManualClock","manual_2","VideoClock","video_2","DefaultRenderer","default_1","NullRenderer","null_2","WebRenderer","renderer_2","RendererSettings","settings_10","_super","_video","ass","call","this","video_1","document","createElement","parentElement","replaceChild","libjassSubsWrapper","insertBefore","firstElementChild","__extends","prototype","resize","videoWidth","videoHeight","videoOffsetWidth","offsetWidth","videoOffsetHeight","offsetHeight","ratio","Math","min","subsWrapperWidth","subsWrapperHeight","subsWrapperLeft","subsWrapperTop","resizeVideo","_ready","renderer_1","fontSrcUrlRegex","clock","_libjassSubsWrapper","_this","HTMLDivElement","temp","_layerWrappers","_layerAlignmentWrappers","_fontMetricsCache","map_14","_currentSubs","_preRenderedSubs","_eventListeners","classList","add","_subsWrapper","appendChild","className","_fontSizeElement","createTextNode","settings_9","log","preloadFontPromises","fontFetchPromisesCache","fontMap","attachedFontsMap","useAttachedFonts","attachments","forEach","attachment","type","attachment_2","Font","ttfNames","ttf_1","getTtfNames","ex","error","attachmentUrl","contents","name","correspondingFontMapEntry","undefined","push","existingList","srcs","fontFamily","fontFamilyMetricsPromise","fonts","source_1","src","match","join","attachedFontUrls","_i","attachedFontUrls_1","length","url","existingFontFaces_1","fontFace","family","fontFetchPromise","FontFace","quotedFontFace","promise_7","any","load","_calculateFontMetricsAfterFetch","catch","reason","urls_1","split","trim","filter","concat","thisFontFamilysFetchPromises","resolve","reject","xhr","XMLHttpRequest","addEventListener","err","open","send","allFontsFetchedPromise","first","then","metrics","all","defineProperty","width","height","left","top","_removeAllSubs","style","toFixed","_subsWrapperWidth","_scaleX","properties","resolutionX","_scaleY","resolutionY","clear","currentTime","_onClockTick","preRender","dialogue","currentTimeRelativeToDialogueStart","start","containsTransformTag","alreadyPreRenderedSub","id","sub","marginLeft","marginRight","marginTop","marginBottom","marginVertical","minWidth","dialogueAnimationStylesElement","dialogueAnimationCollection","animation_collection_1","AnimationCollection","svgElement","createElementNS","setAttribute","baseVal","valueAsString","svgDefsElement","currentSpan","currentSpanStyles","span_styles_1","SpanStyles","currentAnimationCollection","previousAddNewLine","startNewSpan","addNewLine","hasChildNodes","setStylesOnSpan","animationDelays","delay","makeNewLine","currentDrawingStyles","drawing_styles_1","DrawingStyles","wrappingStyle","karaokeTimesAccumulator","_a","part","Italic","italic","Bold","bold","Underline","underline","StrikeThrough","strikeThrough","Border","outlineWidth","outlineHeight","BorderX","BorderY","Shadow","shadowDepthX","shadowDepthY","ShadowX","ShadowY","Blur","blur","GaussianBlur","gaussianBlur","FontName","fontName","FontSize","fontSize","FontSizePlus","FontSizeMinus","FontScaleX","fontScaleX","FontScaleY","fontScaleY","LetterSpacing","letterSpacing","RotateX","rotationX","RotateY","rotationY","RotateZ","rotationZ","SkewX","skewX","SkewY","skewY","PrimaryColor","primaryColor","SecondaryColor","secondaryColor","OutlineColor","outlineColor","ShadowColor","shadowColor","Alpha","primaryAlpha","secondaryAlpha","outlineAlpha","shadowAlpha","PrimaryAlpha","SecondaryAlpha","OutlineAlpha","ShadowAlpha","Alignment","ColorKaraoke","keyframe_1","Keyframe","withAlpha","toString","duration","Reset","newStyleName","reset","styles","Position","position","x","y","Move","x1","y1","t1","t2","x2","y2","end","Fade","ComplexFade","a1","a2","t3","t4","a3","Transform","progression","pow","accel","_b","_c","tags","tag","interpolate","DrawingMode","scale","DrawingBaselineOffset","baselineOffset","DrawingInstructions","toSVG","Text","Comment","NewLine","divTransformStyle","transformOrigin","_transformOrigins","alignment","transformOriginString","_d","_e","webkitTransform","transform","webkitTransformOrigin","misc_8","EndOfLineWrapping","whiteSpace","NoLineWrapping","SmartWrappingWithWiderTopLine","SmartWrappingWithWiderBottomLine","textAlign","webkitAnimation","animationStyle","animation","textContent","result","draw","has","thePreRenderedSub","preRenderedSub","cloneNode","applyAnimationDelays","node","animationNames","animationName","webkitAnimationName","rate","webkitAnimationDelay","animationDelay","animatedDescendants","querySelectorAll","i","layer","layerWrapper","insertBeforeElement","insertBeforeLayer","layerAlignmentWrapper","insertBeforeAlignment","getElementsByTagName","sheet","cssRules","cssText","_onClockPlay","display","remove","delete","_removeSub","_onClockPause","_onClockStop","_onClockRateChange","_dispatchEvent","fontSizeElement","lastly","font_size_2","calculateFontMetrics","fallbackFonts","removeChild","parentNode","null_1","mixin_3","mixin","base_3","createComponentTransferFilter","color","redTransferNode","SVGComponentTransferFunctionElement","SVG_FECOMPONENTTRANSFER_TYPE_LINEAR","slope","intercept","red","greenTransferNode","green","blueTransferNode","blue","alphaTransferNode","alpha","valueOrDefault","newValue","defaultValue","renderer","_settings","_svgDefsElement","_nextFilterId","_id","_defaultStyle","newStyle","outlineThickness","shadowDepth","span","animationCollection","isTextOnlySpan","childNodes","fontStyleOrWeight","_italic","_bold","lineHeight","_fontScaleX","_fontSize","font_size_1","fontSizeForLineHeight","_fontName","font","textDecoration","_underline","_strikeThrough","_fontScaleY","_skewX","_skewY","_letterSpacing","_outlineWidth","_outlineHeight","_shadowDepthX","_shadowDepthY","_primaryColor","_primaryAlpha","_outlineColor","_outlineAlpha","_shadowColor","_shadowAlpha","enableSvg","opacity","_svg","_textShadow","_rotationX","_rotationY","filterElement","source","in1","sourceAlphaTransferNode","mergedOutlines_1","outlineNumber_1","increment_1","preciseOutlines","_gaussianBlur","addOutline","sqrt","outlineId","outlineFilter","operator","SVGFEMorphologyElement","SVG_MORPHOLOGY_OPERATOR_DILATE","radiusX","radiusY","outlineReferenceNode","dx","dy","coloredOutline","gaussianBlurFilter","stdDeviationX","stdDeviationY","_blur","blurFilter","edgeMode","SVGFEConvolveMatrixElement","SVG_EDGEMODE_NONE","cutoutNode","in2","SVGFECompositeElement","SVG_FECOMPOSITE_OPERATOR_OUT","shadowFilter","coloredShadow","lastFilter","mergedResult","shadowReferenceNode","sourceGraphicReferenceNode","childElementCount","filterId","filterProperty","webkitFilter","outlineCssString_1","shadowCssString_1","maxY","textShadow","substr","shadowCssString","_rotationZ","_secondaryColor","_secondaryAlpha","prepareFontSizeElement","lineHeightForFontSize","promise_6","setTimeout","lineHeightForFontSizeSync","fontMetricsFromLineHeights","lowerLineHeight","upperLineHeight","fontSizeFromMetrics","factor","fontMetricsCache","existingMetrics","lowerLineHeight_1","_outputScaleX","_outputScaleY","_scale","_baselineOffset","drawingInstructions","fillColor","svg","instructions","scaleFactor","scaleX","scaleY","path","pathString","bboxMinX","Infinity","bboxMaxX","bboxMinY","bboxMaxY","instruction","drawing","MoveInstruction","max","LineInstruction","CubicBezierCurveInstruction","x3","y3","bboxWidth","bboxHeight","g","_style","_animationStyle","_animationDelays","map_13","_numAnimations","_nextId","_rate","timingFunction","keyframes","keyframes_1","keyframe","time","Error","ruleCssText","keyframes_2","_time","_properties","_ass","_clock","_lastRendererId","settings_8","from","base_2","Play","Tick","Pause","Stop","RateChange","enable","disable","toggle","setEnabled","enabled","settings_7","dialogues","preRenderTime","decoded","atob","bytes","Uint8Array","ArrayBuffer","charCodeAt","reader","dataView","DataView","buffer","offsetTable","OffsetTable","read","nameTableRecord","numTables","tableRecord","TableRecord","c1","c2","c3","c4","offset","nameTableHeader","NameTableHeader","set_1","count","nameRecord","NameRecord","nameId","recordOffset","stringOffset","nameBytes","subarray","platformId","name_4","j","String","fromCharCode","name_5","struct","clazz","fields","__fields","fields_1","field_1","DataType","Char","getInt8","Uint16","getUint16","Uint32","getUint32","field","existingDecorator","fieldDecorators","proto","ctor","constructor","map_12","__decorate","isFontFaceRule","rule","CSSRule","FONT_FACE_RULE","testSupportsSvg","settings_6","morphologyFilter","DOMException","domException","code","NO_MODIFICATION_ALLOWED_ERR","getAttribute","makeFontMapFromStyleElement","linkStyle","map_11","styleSheet","name_3","getPropertyValue","line","matches","object","_f","_g","video","_autoClock","auto_1","play","pause","seeking","setRate","playbackRate","paused","listener","_getCurrentTime","_autoPauseAfter","_manualClock","manual_1","_nextAnimationFrameRequestId","_lastKnownExternalTime","_lastKnownExternalTimeObtainedAt","_startTicking","settings_5","_stopTicking","seek","_onTimerTick","timeStamp","currentExternalTime","tick","requestAnimationFrame","cancelAnimationFrame","_currentTime","_enabled","_paused","map_10","base_1","stop","mixin_2","mixins","mixins_1","mixin_1","getOwnPropertyNames","name_2","listeners","args","listeners_1","parse","parse_3","BrowserReadableStream","streams_1","StringStream","XhrStream","StreamParser","stream_parsers_1","SrtStreamParser","uuencodedToBase64","str","charCode","Section","_stream","ass_1","_minimalDeferred","promise_5","_deferred","_shouldSwallowBom","_currentSection","ScriptInfo","_currentAttachment","nextLine","_onNextLine","addAttachment","EOF","scriptProperties","currentSection","Styles","Events","Fonts","Graphics","Other","property","misc_7","parseLineIntoProperty","parseInt","scaleBorderAndShadow","stylesFormatSpecifier","property_1","addStyle","settings_4","stack","dialoguesFormatSpecifier","property_2","addEvent","startOfNewAttachmentRegex","startOfNewAttachment","exec","attachment_1","Graphic","filename","_currentDialogueNumber","_currentDialogueStart","_currentDialogueEnd","_currentDialogueText","style_2","map_9","dialogue_2","test","replace","substring","script_properties_1","_styles","map_8","_dialogues","_attachments","_stylesFormatSpecifier","_dialoguesFormatSpecifier","arguments","style_1","fromString","raw","misc_6","fromStream","stream","SRT","fromUrl","fetchPromise","fetch","ReadableStream","getReader","TextDecoder","response","ok","status","fromReadableStream","promise_4","settings_3","encoding","fromJSON","obj","keys","name_1","styleLine","misc_5","parseLineIntoTypedTemplate","styleTemplate","template","repr_1","key","dialogueLine","dialogueTemplate","repr_2","dialogue_1","toJSON","_classTag","serialization_7","registerClass","_resolutionX","_resolutionY","_wrappingStyle","_scaleBorderAndShadow","serialization_6","toTime","reduce","previousValue","currentValue","parseFloat","_parts","_containsTransformTag","normalizedTemplate_2","map_7","toLowerCase","_lastDialogueId","styleName","settings_2","_start","_end","_layer","misc_4","isNaN","text","_rawPartsString","_parsePartsString","_alignment","parse_2","index","possiblyIncorrectParses","indexOf","serialization_5","normalizedTemplate_1","map_6","_name","misc_3","parse_1","_outlineThickness","_borderStyle","_shadowDepth","_marginLeft","_marginRight","_marginVertical","serialization_4","_filename","_type","_contents","serialization_3","colonPos","formatSpecifier","slice","map_5","formatKey","_str","_readTill","nextNewLinePos","promise_3","_xhr","_pendingDeferred","_failedError","_onXhrProgress","_onXhrLoad","event","_onXhrError","deferred","_tryResolveNextLine","readyState","DONE","responseText","_buffer","_reader","_decoder","ignoreBOM","next","done","decode","input","ParserRun","settings_1","makeTagParserFunction","tagName","tagConstructor","valueParser","required","parent","current","ParseNode","pop","valueNode","rules","map_4","_input","ruleFunction","_parseTree","_result","parse_dialogueParts","_haveMore","enclosedTagsNode","parse_enclosedTags","whiteSpaceOrTextNode","parse_newline","parse_hardspace","parse_text","previousTextPart","inDrawingMode","_peek","childNode","parse_tag_alpha","parse_tag_iclip","parse_tag_xbord","parse_tag_ybord","parse_tag_xshad","parse_tag_yshad","parse_tag_blur","parse_tag_bord","parse_tag_clip","parse_tag_fade","parse_tag_fscx","parse_tag_fscy","parse_tag_move","parse_tag_shad","parse_tag_fad","parse_tag_fax","parse_tag_fay","parse_tag_frx","parse_tag_fry","parse_tag_frz","parse_tag_fsp","parse_tag_fsplus","parse_tag_fsminus","parse_tag_org","parse_tag_pbo","parse_tag_pos","parse_tag_an","parse_tag_be","parse_tag_fn","parse_tag_fr","parse_tag_fs","parse_tag_kf","parse_tag_ko","parse_tag_1a","parse_tag_1c","parse_tag_2a","parse_tag_2c","parse_tag_3a","parse_tag_3c","parse_tag_4a","parse_tag_4c","parse_tag_a","parse_tag_b","parse_tag_c","parse_tag_i","parse_tag_k","parse_tag_K","parse_tag_p","parse_tag_q","parse_tag_r","parse_tag_s","parse_tag_t","parse_tag_u","parse_comment","next2","parse_enableDisable","_parse_tag_clip_or_iclip","startNode","parse_decimal","endNode","a1Node","a2Node","a3Node","t1Node","t2Node","t3Node","t4Node","SweepingColorKaraoke","OutlineKaraoke","x1Node","y1Node","x2Node","y2Node","xNode","yNode","RotationOrigin","accelNode","firstNode","secondNode","thirdNode","transformTags","parse_drawingInstructions","currentType","numberParts","numberPart","splice","typePart","newType","parse_decimalInt32","isNegative","numberNode","parse_hexInt32","parse_decimalOrHexInt32","negative","numericalPart","parse_unsignedDecimal","characteristicNode","mantissaNode","parse_color","Color","parse_alpha","parse_colorWithAlpha","scaleNode","commandsNode","RectangularClip","VectorClip","_parent","_children","children","_value","_setEnd","newEnd","misc_2","registerWorkerCommand","commands_3","WorkerCommands","Parse","parameters","promise_2","_red","_green","_blue","_alpha","final","_duration","_x","_y","_x1","_y1","_x2","_y2","_t1","_t2","_a1","_a2","_a3","_t3","_t4","_accel","_tags","_inside","_instructions","addToString","ctorName","hasOwnProperty","propertyNames_1","Function","serialization_2","_x3","_y3","converter","validator","createWorker","scriptPath","_scriptNode","channel_1","WorkerChannelImpl","Worker","commands_2","supported","currentScript","WorkerGlobalScope","_comm","_pendingRequests","map_3","ev","_onMessage","data","request","command","promise_1","requestId","_lastRequestId","requestMessage","postMessage","serialization_1","cancelRequest","_respond","message","commands_1","Response","rawMessage","responseMessage","requestId_1","commandCallback","misc_1","getWorkerCommandHandler","Ping","handler","workerCommands","map_2","classes","size","JSON","stringify","hydratedValue","key_1","map_1","SimplePromise","promises","first_rec","previousRejections","head","tail","enqueueJob","MutationObserver","WebkitMutationObserver","process","nextTick","process_1","callback","pending_1","currentlyPending_1","div_1","processing","processing_1","observe","attributes","executor","_state","SimplePromiseState","PENDING","_fulfillReactions","_rejectReactions","_fulfilledValue","_rejectedReason","TypeError","_createResolvingFunctions","values","numUnresolved","race","values_1","onFulfilled","onRejected","resultCapability","fulfillReaction","capabilities","rejectReaction","FULFILLED","_enqueueFulfilledReactionJob","REJECTED","_enqueueRejectedReactionJob","alreadyResolved","resolution","_reject","_fulfill","_resolveWithThenable","thenable","reactions","reactions_1","reaction","reactions_2","handlerResult","_promise","enumerable","SimpleMap","iterable","Array","isArray","iterable_2","element","_keyToProperty","_values","_keys","_size","callbackfn","thisArg","SimpleSet","iterable_1","_toProperty","_elements"],"mappings":"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","file":"libjass.js.map","sourcesContent":["/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Debug mode. When true, libjass logs some debug messages.\n *\n * @type {boolean}\n */\nexport let debugMode: boolean = false;\n\n/**\n * Verbose debug mode. When true, libjass logs some more debug messages. This setting is independent of {@link libjass.debugMode}\n *\n * @type {boolean}\n */\nexport let verboseMode: boolean = false;\n\n/**\n * Sets the debug mode.\n *\n * @param {boolean} value\n */\nexport function setDebugMode(value: boolean): void {\n\tdebugMode = value;\n}\n\n/**\n * Sets the verbose debug mode.\n *\n * @param {boolean} value\n */\nexport function setVerboseMode(value: boolean): void {\n\tverboseMode = value;\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as settings from \"./settings\";\nexport { debugMode, verboseMode } from \"./settings\";\n\nimport * as set from \"./utility/set\";\nexport { Set } from \"./utility/set\";\n\nimport * as map from \"./utility/map\";\nexport { Map } from \"./utility/map\";\n\nimport * as promise from \"./utility/promise\";\nexport { Promise, DeferredPromise } from \"./utility/promise\";\n\nimport * as webworker from \"./webworker\";\nexport { webworker };\n\nimport * as parts from \"./parts\";\nexport { parts };\n\nimport * as parser from \"./parser\";\nexport { parser };\n\nimport * as renderers from \"./renderers\";\nexport { renderers };\n\nexport { serialize, deserialize } from \"./serialization\";\n\nexport { ASS } from \"./types/ass\";\nexport { Attachment, AttachmentType } from \"./types/attachment\";\nexport { Dialogue } from \"./types/dialogue\";\nexport { ScriptProperties } from \"./types/script-properties\";\nexport { Style } from \"./types/style\";\n\nexport { BorderStyle, Format, WrappingStyle } from \"./types/misc\";\n\nexport { version } from \"./version\";\n\n/**\n * Configures libjass with the given properties.\n *\n * @param {!*} newConfig\n * @param {?boolean} newConfig[\"debugMode\"] When true, libjass logs some debug messages.\n * @param {?boolean} newConfig[\"verboseMode\"] When true, libjass logs some more debug messages. This setting is independent of {@link libjass.debugMode}\n * @param {?function(new:Set, !Array.<T>=)} newConfig[\"Set\"] Sets the Set implementation used by libjass to the provided one. If null, {@link ./utility/set.SimpleSet} is used.\n * @param {?function(new:Map, !Array.<!Array.<*>>=)} newConfig[\"Map\"] Sets the Map implementation used by libjass to the provided one. If null, {@link ./utility/map.SimpleMap} is used.\n * @param {?function(new:Promise)} newConfig[\"Promise\"] Sets the Promise implementation used by libjass to the provided one. If null, {@link ./utility/promise.SimplePromise} is used.\n */\nexport function configure(newConfig: {\n\tdebugMode?: boolean,\n\tverboseMode?: boolean,\n\tSet?: typeof set.Set | null,\n\tMap?: typeof map.Map | null,\n\tPromise?: typeof promise.Promise | null,\n}): void {\n\tif (typeof newConfig.debugMode === \"boolean\") {\n\t\tsettings.setDebugMode(newConfig.debugMode);\n\t}\n\n\tif (typeof newConfig.verboseMode === \"boolean\") {\n\t\tsettings.setVerboseMode(newConfig.verboseMode);\n\t}\n\n\tif (typeof newConfig.Set === \"function\" || newConfig.Set === null) {\n\t\tset.setImplementation(newConfig.Set);\n\t}\n\n\tif (typeof newConfig.Map === \"function\" || newConfig.Map === null) {\n\t\tmap.setImplementation(newConfig.Map);\n\t}\n\n\tif (typeof newConfig.Promise === \"function\" || newConfig.Promise === null) {\n\t\tpromise.setImplementation(newConfig.Promise);\n\t}\n}\n\ndeclare const exports: any;\n\n// Getters below are to work around https://github.com/Microsoft/TypeScript/issues/6366\n\nObject.defineProperties(exports, {\n\tdebugMode: {\n\t\tget: () => settings.debugMode,\n\t\tset: value => {\n\t\t\tconsole.warn(\"Setter `libjass.debugMode = value` has been deprecated. Use `libjass.configure({ debugMode: value })` instead.\");\n\t\t\tsettings.setDebugMode(value);\n\t\t},\n\t},\n\n\tverboseMode: {\n\t\tget: () => settings.verboseMode,\n\t\tset: value => {\n\t\t\tconsole.warn(\"Setter `libjass.verboseMode = value` has been deprecated. Use `libjass.configure({ verboseMode: value })` instead.\");\n\t\t\tsettings.setVerboseMode(value);\n\t\t},\n\t},\n\n\tSet: {\n\t\tget: () => set.Set,\n\t\tset: value => {\n\t\t\tconsole.warn(\"Setter `libjass.Set = value` has been deprecated. Use `libjass.configure({ Set: value })` instead.\");\n\t\t\tset.setImplementation(value);\n\t\t},\n\t},\n\n\tMap: {\n\t\tget: () => map.Map,\n\t\tset: value => {\n\t\t\tconsole.warn(\"Setter `libjass.Map = value` has been deprecated. Use `libjass.configure({ Map: value })` instead.\");\n\t\t\tmap.setImplementation(value);\n\t\t},\n\t},\n\n\tPromise: {\n\t\tget: () => promise.Promise,\n\t\tset: value => {\n\t\t\tconsole.warn(\"Setter `libjass.Promise = value` has been deprecated. Use `libjass.configure({ Promise: value })` instead.\");\n\t\t\tpromise.setImplementation(value);\n\t\t},\n\t},\n});\n","/**\n * The version of libjass. An array like\n *\n *     [\"0.12.0\", 0, 12, 0]\n *\n * @type {!Array.<string|number>}\n */\nexport const version = [\"0.12.1\",0,12,1];\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport { Clock, ClockEvent, EventSource } from \"./clocks/base\";\nexport { AutoClock } from \"./clocks/auto\";\nexport { ManualClock } from \"./clocks/manual\";\nexport { VideoClock } from \"./clocks/video\";\n\nexport { DefaultRenderer } from \"./default\";\nexport { NullRenderer } from \"./null\";\nexport { WebRenderer } from \"./web/renderer\";\nexport { RendererSettings } from \"./settings\";\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { VideoClock } from \"./clocks/video\";\nimport { RendererSettings } from \"./settings\";\nimport { WebRenderer } from \"./web/renderer\";\n\nimport { ASS } from \"../types/ass\";\n\n/**\n * A default renderer implementation.\n *\n * @param {!HTMLVideoElement} video\n * @param {!libjass.ASS} ass\n * @param {libjass.renderers.RendererSettings} settings\n */\nexport class DefaultRenderer extends WebRenderer {\n\tconstructor(private _video: HTMLVideoElement, ass: ASS, settings?: RendererSettings) {\n\t\tsuper(ass, new VideoClock(_video), document.createElement(\"div\"), settings);\n\n\t\tthis._video.parentElement!.replaceChild(this.libjassSubsWrapper, this._video);\n\t\tthis.libjassSubsWrapper.insertBefore(this._video, this.libjassSubsWrapper.firstElementChild);\n\t}\n\n\t/**\n\t * Resize the subtitles to the dimensions of the video element.\n\t *\n\t * This method accounts for letterboxing if the video element's size is not the same ratio as the video resolution.\n\t */\n\tresize(): void {\n\t\t// Handle letterboxing around the video. If the width or height are greater than the video can be, then consider that dead space.\n\n\t\tconst videoWidth = this._video.videoWidth;\n\t\tconst videoHeight = this._video.videoHeight;\n\t\tconst videoOffsetWidth = this._video.offsetWidth;\n\t\tconst videoOffsetHeight = this._video.offsetHeight;\n\n\t\tconst ratio = Math.min(videoOffsetWidth / videoWidth, videoOffsetHeight / videoHeight);\n\t\tconst subsWrapperWidth = videoWidth * ratio;\n\t\tconst subsWrapperHeight = videoHeight * ratio;\n\t\tconst subsWrapperLeft = (videoOffsetWidth - subsWrapperWidth) / 2;\n\t\tconst subsWrapperTop = (videoOffsetHeight - subsWrapperHeight) / 2;\n\n\t\tsuper.resize(subsWrapperWidth, subsWrapperHeight, subsWrapperLeft, subsWrapperTop);\n\t}\n\n\t/**\n\t * @deprecated\n\t */\n\tresizeVideo(): void {\n\t\tconsole.warn(\"`DefaultRenderer.resizeVideo(width, height)` has been deprecated. Use `DefaultRenderer.resize()` instead.\");\n\t\tthis.resize();\n\t}\n\n\tprotected _ready(): void {\n\t\tthis.resize();\n\n\t\tsuper._ready();\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getTtfNames } from \"../../parser/ttf\";\n\nimport * as parts from \"../../parts\";\n\nimport { debugMode } from \"../../settings\";\n\nimport { ASS } from \"../../types/ass\";\nimport { AttachmentType } from \"../../types/attachment\";\nimport { Dialogue } from \"../../types/dialogue\";\nimport { WrappingStyle } from \"../../types/misc\";\n\nimport { Map } from \"../../utility/map\";\nimport { mixin } from \"../../utility/mixin\";\nimport { any as Promise_any, first as Promise_first, lastly as Promise_finally, Promise } from \"../../utility/promise\";\nimport { Set } from \"../../utility/set\";\n\nimport { Clock, EventSource } from \"../clocks/base\";\n\nimport { NullRenderer } from \"../null\";\nimport { RendererSettings } from \"../settings\";\n\nimport { AnimationCollection } from \"./animation-collection\";\nimport { DrawingStyles } from \"./drawing-styles\";\nimport { calculateFontMetrics } from \"./font-size\";\nimport { Keyframe } from \"./keyframe\";\nimport { SpanStyles } from \"./span-styles\";\n\ndeclare const global: {\n\tdocument: {\n\t\tfonts?: FontFaceSet;\n\t};\n};\n\ninterface FontFaceSet {\n\t/**\n\t * @param {!FontFace} fontFace\n\t * @return {!FontFaceSet}\n\t */\n\tadd(fontFace: FontFace): FontFaceSet;\n\n\t/**\n\t * @param {function(!FontFace, !FontFace, !FontFaceSet)} callbackfn A function that is called with each value in the set.\n\t * @param {*} thisArg\n\t */\n\tforEach(callbackfn: (fontFace: FontFace, index: FontFace, set: FontFaceSet) => void, thisArg?: any): void;\n}\n\ninterface FontFace {\n\t/** @type {string} */\n\tfamily: string;\n\n\t/**\n\t * @return {!Promise.<!FontFace>}\n\t */\n\tload(): Promise<FontFace>;\n}\n\ndeclare var FontFace: {\n\tnew (family: string, source: string): FontFace;\n};\n\nconst fontSrcUrlRegex = /^(url|local)\\([\"']?(.+?)[\"']?\\)$/;\n\n/**\n * A renderer implementation that draws subtitles to the given <div>\n *\n * After the renderer fires its ready event, {@link libjass.renderers.WebRenderer.resize} must be called to initialize its size before starting the clock.\n *\n * @param {!libjass.ASS} ass\n * @param {!libjass.renderers.Clock} clock\n * @param {!HTMLDivElement} libjassSubsWrapper Subtitles will be rendered to this <div>\n * @param {!libjass.renderers.RendererSettings} settings\n */\nexport class WebRenderer extends NullRenderer implements EventSource<string> {\n\tprivate static _transformOrigins: number[][] = [\n\t\t[],\n\t\t[0, 100], [50, 100], [100, 100],\n\t\t[0, 50], [50, 50], [100, 50],\n\t\t[0, 0], [50, 0], [100, 0],\n\t];\n\n\tprivate _subsWrapper: HTMLDivElement;\n\tprivate _subsWrapperWidth: number; // this._subsWrapper.offsetWidth is expensive, so cache this.\n\n\tprivate _layerWrappers: HTMLDivElement[] = [];\n\tprivate _layerAlignmentWrappers: HTMLDivElement[][] = [];\n\tprivate _fontSizeElement: HTMLDivElement;\n\n\tprivate _fontMetricsCache: Map<string, [number, number]> = new Map<string, [number, number]>();\n\n\tprivate _currentSubs: Map<Dialogue, HTMLDivElement> = new Map<Dialogue, HTMLDivElement>();\n\tprivate _preRenderedSubs: Map<number, PreRenderedSub> = new Map<number, PreRenderedSub>();\n\n\tprivate _scaleX: number;\n\tprivate _scaleY: number;\n\n\tconstructor(ass: ASS, clock: Clock, private _libjassSubsWrapper: HTMLDivElement, settings?: RendererSettings) {\n\t\tsuper(ass, clock, (() => {\n\t\t\tif (!(_libjassSubsWrapper instanceof HTMLDivElement)) {\n\t\t\t\tconst temp = settings;\n\t\t\t\tsettings = _libjassSubsWrapper as any;\n\t\t\t\t_libjassSubsWrapper = temp as any;\n\t\t\t\tconsole.warn(\"WebRenderer's constructor now takes libjassSubsWrapper as the third parameter and settings as the fourth parameter. Please update the caller.\");\n\t\t\t}\n\n\t\t\treturn settings;\n\t\t})());\n\n\t\tthis._libjassSubsWrapper.classList.add(\"libjass-wrapper\");\n\n\t\tthis._subsWrapper = document.createElement(\"div\");\n\t\tthis._libjassSubsWrapper.appendChild(this._subsWrapper);\n\t\tthis._subsWrapper.className = \"libjass-subs\";\n\n\t\tthis._fontSizeElement = document.createElement(\"div\");\n\t\tthis._libjassSubsWrapper.appendChild(this._fontSizeElement);\n\t\tthis._fontSizeElement.className = \"libjass-font-measure\";\n\t\tthis._fontSizeElement.appendChild(document.createTextNode(\"M\"));\n\n\t\t// Preload fonts\n\n\t\tif (debugMode) {\n\t\t\tconsole.log(`Preloading fonts...`);\n\t\t}\n\n\t\tconst preloadFontPromises: Promise<any>[] = [];\n\n\t\tconst fontFetchPromisesCache = new Map<string, Promise<any>>();\n\n\t\tconst fontMap = (this.settings.fontMap === null) ? new Map<string, string | string[]>() : this.settings.fontMap;\n\n\t\tconst attachedFontsMap = new Map<string, string[]>();\n\t\tif (this.settings.useAttachedFonts) {\n\t\t\tass.attachments.forEach(attachment => {\n\t\t\t\tif (attachment.type !== AttachmentType.Font) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet ttfNames: Set<string>;\n\t\t\t\ttry {\n\t\t\t\t\tttfNames = getTtfNames(attachment);\n\t\t\t\t}\n\t\t\t\tcatch (ex) {\n\t\t\t\t\tconsole.error(ex);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst attachmentUrl = `data:application/x-font-ttf;base64,${ attachment.contents }`;\n\n\t\t\t\tttfNames.forEach(name => {\n\t\t\t\t\tlet correspondingFontMapEntry = fontMap.get(name);\n\t\t\t\t\tif (correspondingFontMapEntry !== undefined) {\n\t\t\t\t\t\t// Also defined in fontMap.\n\t\t\t\t\t\tif (typeof correspondingFontMapEntry !== \"string\") {\n\t\t\t\t\t\t\t// Entry in fontMap is an array. Append this URL to it.\n\t\t\t\t\t\t\tcorrespondingFontMapEntry.push(attachmentUrl);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t/* The entry in fontMap is a string. Don't append this URL to it. Instead, put it in attachedFontsMap now\n\t\t\t\t\t\t\t * and it'll be merged with the entry from fontMap later. If it was added here, and later the string needed\n\t\t\t\t\t\t\t * to be split on commas, then the commas in the data URI would break the result.\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tlet existingList = attachedFontsMap.get(name);\n\t\t\t\t\t\t\tif (existingList === undefined) {\n\t\t\t\t\t\t\t\tattachedFontsMap.set(name, existingList = []);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\texistingList.push(attachmentUrl);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Not defined in fontMap. Add it there.\n\t\t\t\t\t\tfontMap.set(name, [attachmentUrl]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tfontMap.forEach((srcs, fontFamily) => {\n\t\t\tlet fontFamilyMetricsPromise: Promise<[number, number]>;\n\n\t\t\tif (global.document.fonts && global.document.fonts.add) {\n\t\t\t\t// value should be string. If it's string[], combine it into string\n\t\t\t\tlet source =\n\t\t\t\t\t(typeof srcs === \"string\") ?\n\t\t\t\t\t\tsrcs :\n\t\t\t\t\t\tsrcs.map(src =>\n\t\t\t\t\t\t\t(src.match(fontSrcUrlRegex) !== null) ?\n\t\t\t\t\t\t\t\tsrc :\n\t\t\t\t\t\t\t\t`url(\"${ src }\")`).join(\", \");\n\n\t\t\t\tconst attachedFontUrls = attachedFontsMap.get(fontFamily);\n\t\t\t\tif (attachedFontUrls !== undefined) {\n\t\t\t\t\tfor (const url of attachedFontUrls) {\n\t\t\t\t\t\tsource += `, url(\"${ url }\")`;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet existingFontFaces: FontFace[] = [];\n\t\t\t\tglobal.document.fonts.forEach(fontFace => {\n\t\t\t\t\tif (fontFace.family === fontFamily || fontFace.family === `\"${ fontFamily }\"`) {\n\t\t\t\t\t\texistingFontFaces.push(fontFace);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet fontFetchPromise: Promise<FontFace | null>;\n\t\t\t\tif (existingFontFaces.length === 0) {\n\t\t\t\t\tconst fontFace = new FontFace(fontFamily, source);\n\t\t\t\t\tconst quotedFontFace = new FontFace(`\"${ fontFamily }\"`, source);\n\n\t\t\t\t\tglobal.document.fonts.add(fontFace);\n\t\t\t\t\tglobal.document.fonts.add(quotedFontFace);\n\n\t\t\t\t\tfontFetchPromise = Promise_any([fontFace.load(), quotedFontFace.load()]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfontFetchPromise = Promise_any(existingFontFaces.map(fontFace => fontFace.load()));\n\t\t\t\t}\n\n\t\t\t\tfontFamilyMetricsPromise = this._calculateFontMetricsAfterFetch(fontFamily, fontFetchPromise.catch(reason => {\n\t\t\t\t\tconsole.warn(`Fetching fonts for ${ fontFamily } at ${ source } failed: %o`, reason);\n\t\t\t\t\treturn null;\n\t\t\t\t}));\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// value should be string[]. If it's string, split it into string[]\n\t\t\t\tlet urls =\n\t\t\t\t\t((typeof srcs === \"string\") ?\n\t\t\t\t\t\tsrcs.split(/,/) :\n\t\t\t\t\t\tsrcs).map(url => url.trim()).map(url => {\n\t\t\t\t\t\t\tconst match = url.match(fontSrcUrlRegex);\n\n\t\t\t\t\t\t\tif (match === null) {\n\t\t\t\t\t\t\t\t// A URL\n\t\t\t\t\t\t\t\treturn url;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (match[1] === \"local\") {\n\t\t\t\t\t\t\t\t// A local() URL. Don't fetch it.\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// A url() URL. Extract the raw URL.\n\t\t\t\t\t\t\treturn match[2];\n\t\t\t\t\t\t}).filter((url): url is string => url !== null);\n\n\t\t\t\tconst attachedFontUrls = attachedFontsMap.get(fontFamily);\n\t\t\t\tif (attachedFontUrls !== undefined) {\n\t\t\t\t\turls = urls.concat(attachedFontUrls);\n\t\t\t\t}\n\n\t\t\t\tconst thisFontFamilysFetchPromises =\n\t\t\t\t\turls.map(url => {\n\t\t\t\t\t\tlet fontFetchPromise = fontFetchPromisesCache.get(url);\n\t\t\t\t\t\tif (fontFetchPromise === undefined) {\n\t\t\t\t\t\t\tfontFetchPromise =\n\t\t\t\t\t\t\t\tnew Promise<null>((resolve, reject) => {\n\t\t\t\t\t\t\t\t\tconst xhr = new XMLHttpRequest();\n\t\t\t\t\t\t\t\t\txhr.addEventListener(\"load\", () => {\n\t\t\t\t\t\t\t\t\t\tif (debugMode) {\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(`Preloaded ${ url }.`);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tresolve(null);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\txhr.addEventListener(\"error\", err => {\n\t\t\t\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\txhr.open(\"GET\", url, true);\n\t\t\t\t\t\t\t\t\txhr.send();\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tfontFetchPromisesCache.set(url, fontFetchPromise);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn fontFetchPromise;\n\t\t\t\t\t});\n\n\t\t\t\tconst allFontsFetchedPromise =\n\t\t\t\t\t(thisFontFamilysFetchPromises.length === 0) ?\n\t\t\t\t\t\tPromise.resolve(null) :\n\t\t\t\t\t\tPromise_first(thisFontFamilysFetchPromises).catch(reason => {\n\t\t\t\t\t\t\tconsole.warn(`Fetching fonts for ${ fontFamily } at ${ urls.join(\", \") } failed: %o`, reason);\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t});\n\n\t\t\t\tfontFamilyMetricsPromise = this._calculateFontMetricsAfterFetch(fontFamily, allFontsFetchedPromise);\n\t\t\t}\n\n\t\t\tpreloadFontPromises.push(fontFamilyMetricsPromise.then(metrics => this._fontMetricsCache.set(fontFamily, metrics)));\n\t\t});\n\n\t\tPromise.all(preloadFontPromises).then(() => {\n\t\t\tif (debugMode) {\n\t\t\t\tconsole.log(\"All fonts have been preloaded.\");\n\t\t\t}\n\n\t\t\tthis._ready();\n\t\t});\n\t}\n\n\t/**\n\t * @type {!HTMLDivElement}\n\t */\n\tget libjassSubsWrapper(): HTMLDivElement {\n\t\treturn this._libjassSubsWrapper;\n\t}\n\n\t/**\n\t * Resize the subtitles to the given new dimensions.\n\t *\n\t * @param {number} width\n\t * @param {number} height\n\t * @param {number=0} left\n\t * @param {number=0} top\n\t */\n\tresize(width: number, height: number, left: number = 0, top: number = 0): void {\n\t\tthis._removeAllSubs();\n\n\t\tthis._subsWrapper.style.width = `${ width.toFixed(3) }px`;\n\t\tthis._subsWrapper.style.height = `${ height.toFixed(3) }px`;\n\t\tthis._subsWrapper.style.left = `${ left.toFixed(3) }px`;\n\t\tthis._subsWrapper.style.top = `${ top.toFixed(3) }px`;\n\n\t\tthis._subsWrapperWidth = width;\n\n\t\tthis._scaleX = width / this.ass.properties.resolutionX;\n\t\tthis._scaleY = height / this.ass.properties.resolutionY;\n\n\t\t// Any dialogues which have been pre-rendered will need to be pre-rendered again.\n\t\tthis._preRenderedSubs.clear();\n\n\t\t// this.currentTime will be -1 if resize() is called before the clock begins playing for the first time. In this situation, there is no need to force a redraw.\n\t\tif (this.clock.currentTime !== -1) {\n\t\t\tthis._onClockTick();\n\t\t}\n\t}\n\n\t/**\n\t * The magic happens here. The subtitle div is rendered and stored. Call {@link libjass.renderers.WebRenderer.draw} to get a clone of the div to display.\n\t *\n\t * @param {!libjass.Dialogue} dialogue\n\t * @return {PreRenderedSub}\n\t */\n\tpreRender(dialogue: Dialogue): PreRenderedSub | null {\n\t\tconst currentTimeRelativeToDialogueStart = this.clock.currentTime - dialogue.start;\n\n\t\tif (dialogue.containsTransformTag && currentTimeRelativeToDialogueStart < 0) {\n\t\t\t// draw() expects this function to always return non-null, but it only calls this function when currentTimeRelativeToDialogueStart would be >= 0\n\t\t\treturn null;\n\t\t}\n\n\t\tconst alreadyPreRenderedSub = this._preRenderedSubs.get(dialogue.id);\n\t\tif (alreadyPreRenderedSub) {\n\t\t\treturn alreadyPreRenderedSub;\n\t\t}\n\n\t\tconst sub = document.createElement(\"div\");\n\n\t\tsub.style.marginLeft = `${ (this._scaleX * dialogue.style.marginLeft).toFixed(3) }px`;\n\t\tsub.style.marginRight = `${ (this._scaleX * dialogue.style.marginRight).toFixed(3) }px`;\n\t\tsub.style.marginTop = sub.style.marginBottom = `${ (this._scaleY * dialogue.style.marginVertical).toFixed(3) }px`;\n\t\tsub.style.minWidth = `${ (this._subsWrapperWidth - this._scaleX * (dialogue.style.marginLeft + dialogue.style.marginRight)).toFixed(3) }px`;\n\n\t\tconst dialogueAnimationStylesElement = document.createElement(\"style\");\n\t\tdialogueAnimationStylesElement.id = `libjass-animation-styles-${ this.id }-${ dialogue.id }`;\n\t\tdialogueAnimationStylesElement.type = \"text/css\";\n\n\t\tconst dialogueAnimationCollection = new AnimationCollection(this, dialogueAnimationStylesElement);\n\n\t\tconst svgElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\t\tsvgElement.setAttribute(\"version\", \"1.1\");\n\t\tsvgElement.setAttribute(\"class\", \"libjass-filters\");\n\t\tsvgElement.width.baseVal.valueAsString = \"0\";\n\t\tsvgElement.height.baseVal.valueAsString = \"0\";\n\n\t\tconst svgDefsElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\n\t\tsvgElement.appendChild(svgDefsElement);\n\n\t\tlet currentSpan: HTMLSpanElement | null = null;\n\t\tconst currentSpanStyles = new SpanStyles(this, dialogue, this._scaleX, this._scaleY, this.settings, this._fontSizeElement, svgDefsElement, this._fontMetricsCache);\n\n\t\tlet currentAnimationCollection: AnimationCollection | null = null;\n\n\t\tlet previousAddNewLine = false; // If two or more \\N's are encountered in sequence, then all but the first will be created using currentSpanStyles.makeNewLine() instead\n\t\tconst startNewSpan = (addNewLine: boolean): void => {\n\t\t\tif (currentSpan !== null && currentSpan.hasChildNodes()) {\n\t\t\t\tsub.appendChild(currentSpanStyles.setStylesOnSpan(currentSpan, currentAnimationCollection!));\n\t\t\t}\n\n\t\t\tif (currentAnimationCollection !== null) {\n\t\t\t\tcurrentAnimationCollection.animationDelays.forEach((delay, name) => dialogueAnimationCollection.animationDelays.set(name, delay));\n\t\t\t}\n\n\t\t\tif (addNewLine) {\n\t\t\t\tif (previousAddNewLine) {\n\t\t\t\t\tsub.appendChild(currentSpanStyles.makeNewLine());\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tsub.appendChild(document.createElement(\"br\"));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcurrentSpan = document.createElement(\"span\");\n\t\t\tcurrentAnimationCollection = new AnimationCollection(this, dialogueAnimationStylesElement);\n\n\t\t\tpreviousAddNewLine = addNewLine;\n\t\t};\n\t\tstartNewSpan(false);\n\n\t\tconst currentDrawingStyles = new DrawingStyles(this._scaleX, this._scaleY);\n\n\t\tlet wrappingStyle = this.ass.properties.wrappingStyle;\n\n\t\tlet karaokeTimesAccumulator = 0;\n\n\t\tfor (const part of dialogue.parts) {\n\t\t\tif (part instanceof parts.Italic) {\n\t\t\t\tcurrentSpanStyles.italic = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Bold) {\n\t\t\t\tcurrentSpanStyles.bold = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Underline) {\n\t\t\t\tcurrentSpanStyles.underline = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.StrikeThrough) {\n\t\t\t\tcurrentSpanStyles.strikeThrough = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Border) {\n\t\t\t\tcurrentSpanStyles.outlineWidth = part.value;\n\t\t\t\tcurrentSpanStyles.outlineHeight = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.BorderX) {\n\t\t\t\tcurrentSpanStyles.outlineWidth = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.BorderY) {\n\t\t\t\tcurrentSpanStyles.outlineHeight = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Shadow) {\n\t\t\t\tcurrentSpanStyles.shadowDepthX = part.value;\n\t\t\t\tcurrentSpanStyles.shadowDepthY = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.ShadowX) {\n\t\t\t\tcurrentSpanStyles.shadowDepthX = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.ShadowY) {\n\t\t\t\tcurrentSpanStyles.shadowDepthY = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Blur) {\n\t\t\t\tcurrentSpanStyles.blur = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.GaussianBlur) {\n\t\t\t\tcurrentSpanStyles.gaussianBlur = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.FontName) {\n\t\t\t\tcurrentSpanStyles.fontName = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.FontSize) {\n\t\t\t\tcurrentSpanStyles.fontSize = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.FontSizePlus) {\n\t\t\t\tcurrentSpanStyles.fontSize = currentSpanStyles.fontSize! * (1 + part.value);\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.FontSizeMinus) {\n\t\t\t\tcurrentSpanStyles.fontSize = currentSpanStyles.fontSize! * (1 - part.value);\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.FontScaleX) {\n\t\t\t\tcurrentSpanStyles.fontScaleX = part.value as number;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.FontScaleY) {\n\t\t\t\tcurrentSpanStyles.fontScaleY = part.value as number;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.LetterSpacing) {\n\t\t\t\tcurrentSpanStyles.letterSpacing = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.RotateX) {\n\t\t\t\tcurrentSpanStyles.rotationX = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.RotateY) {\n\t\t\t\tcurrentSpanStyles.rotationY = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.RotateZ) {\n\t\t\t\tcurrentSpanStyles.rotationZ = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.SkewX) {\n\t\t\t\tcurrentSpanStyles.skewX = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.SkewY) {\n\t\t\t\tcurrentSpanStyles.skewY = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.PrimaryColor) {\n\t\t\t\tcurrentSpanStyles.primaryColor = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.SecondaryColor) {\n\t\t\t\tcurrentSpanStyles.secondaryColor = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.OutlineColor) {\n\t\t\t\tcurrentSpanStyles.outlineColor = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.ShadowColor) {\n\t\t\t\tcurrentSpanStyles.shadowColor = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Alpha) {\n\t\t\t\tcurrentSpanStyles.primaryAlpha = part.value;\n\t\t\t\tcurrentSpanStyles.secondaryAlpha = part.value;\n\t\t\t\tcurrentSpanStyles.outlineAlpha = part.value;\n\t\t\t\tcurrentSpanStyles.shadowAlpha = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.PrimaryAlpha) {\n\t\t\t\tcurrentSpanStyles.primaryAlpha = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.SecondaryAlpha) {\n\t\t\t\tcurrentSpanStyles.secondaryAlpha = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.OutlineAlpha) {\n\t\t\t\tcurrentSpanStyles.outlineAlpha = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.ShadowAlpha) {\n\t\t\t\tcurrentSpanStyles.shadowAlpha = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Alignment) {\n\t\t\t\t// Already handled in Dialogue\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.ColorKaraoke) {\n\t\t\t\tstartNewSpan(false);\n\n\t\t\t\tcurrentAnimationCollection!.add(\"step-end\", [\n\t\t\t\t\tnew Keyframe(0, new Map([\n\t\t\t\t\t\t[\"color\", currentSpanStyles.secondaryColor!.withAlpha(currentSpanStyles.secondaryAlpha!).toString()],\n\t\t\t\t\t])), new Keyframe(karaokeTimesAccumulator, new Map([\n\t\t\t\t\t\t[\"color\", currentSpanStyles.primaryColor!.withAlpha(currentSpanStyles.primaryAlpha!).toString()],\n\t\t\t\t\t])),\n\t\t\t\t]);\n\n\t\t\t\tkaraokeTimesAccumulator += part.duration;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.WrappingStyle) {\n\t\t\t\twrappingStyle = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Reset) {\n\t\t\t\tconst newStyleName = part.value;\n\t\t\t\tif (newStyleName === null) {\n\t\t\t\t\tcurrentSpanStyles.reset(null);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcurrentSpanStyles.reset(this.ass.styles.get(newStyleName));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Position) {\n\t\t\t\tsub.style.position = \"absolute\";\n\t\t\t\tsub.style.left = `${ (this._scaleX * part.x).toFixed(3) }px`;\n\t\t\t\tsub.style.top = `${ (this._scaleY * part.y).toFixed(3) }px`;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Move) {\n\t\t\t\tsub.style.position = \"absolute\";\n\t\t\t\tdialogueAnimationCollection.add(\"linear\", [new Keyframe(0, new Map([\n\t\t\t\t\t[\"left\", `${ (this._scaleX * part.x1).toFixed(3) }px`],\n\t\t\t\t\t[\"top\", `${ (this._scaleY * part.y1).toFixed(3) }px`],\n\t\t\t\t])), new Keyframe(part.t1!, new Map([\n\t\t\t\t\t[\"left\", `${ (this._scaleX * part.x1).toFixed(3) }px`],\n\t\t\t\t\t[\"top\", `${ (this._scaleY * part.y1).toFixed(3) }px`],\n\t\t\t\t])), new Keyframe(part.t2!, new Map([\n\t\t\t\t\t[\"left\", `${ (this._scaleX * part.x2).toFixed(3) }px`],\n\t\t\t\t\t[\"top\", `${ (this._scaleY * part.y2).toFixed(3) }px`],\n\t\t\t\t])), new Keyframe(dialogue.end - dialogue.start, new Map([\n\t\t\t\t\t[\"left\", `${ (this._scaleX * part.x2).toFixed(3) }px`],\n\t\t\t\t\t[\"top\", `${ (this._scaleY * part.y2).toFixed(3) }px`],\n\t\t\t\t]))]);\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Fade) {\n\t\t\t\tdialogueAnimationCollection.add(\"linear\", [new Keyframe(0, new Map([\n\t\t\t\t\t[\"opacity\", \"0\"],\n\t\t\t\t])), new Keyframe(part.start, new Map([\n\t\t\t\t\t[\"opacity\", \"1\"],\n\t\t\t\t])), new Keyframe(dialogue.end - dialogue.start - part.end, new Map([\n\t\t\t\t\t[\"opacity\", \"1\"],\n\t\t\t\t])), new Keyframe(dialogue.end - dialogue.start, new Map([\n\t\t\t\t\t[\"opacity\", \"0\"],\n\t\t\t\t]))]);\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.ComplexFade) {\n\t\t\t\tdialogueAnimationCollection.add(\"linear\", [new Keyframe(0, new Map([\n\t\t\t\t\t[\"opacity\", part.a1.toFixed(3)],\n\t\t\t\t])), new Keyframe(part.t1, new Map([\n\t\t\t\t\t[\"opacity\", part.a1.toFixed(3)],\n\t\t\t\t])), new Keyframe(part.t2, new Map([\n\t\t\t\t\t[\"opacity\", part.a2.toFixed(3)],\n\t\t\t\t])), new Keyframe(part.t3, new Map([\n\t\t\t\t\t[\"opacity\", part.a2.toFixed(3)],\n\t\t\t\t])), new Keyframe(part.t4, new Map([\n\t\t\t\t\t[\"opacity\", part.a3.toFixed(3)],\n\t\t\t\t])), new Keyframe(dialogue.end - dialogue.start, new Map([\n\t\t\t\t\t[\"opacity\", part.a3.toFixed(3)],\n\t\t\t\t]))]);\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Transform) {\n\t\t\t\tconst progression =\n\t\t\t\t\t(currentTimeRelativeToDialogueStart <= part.start!) ? 0 :\n\t\t\t\t\t(currentTimeRelativeToDialogueStart >= part.end!) ? 1 :\n\t\t\t\t\tMath.pow((currentTimeRelativeToDialogueStart - part.start!) / (part.end! - part.start!), part.accel!);\n\n\t\t\t\tfor (const tag of part.tags) {\n\t\t\t\t\tif (tag instanceof parts.Border) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineWidth += progression * (tag.value - currentSpanStyles.outlineWidth);\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineHeight += progression * (tag.value - currentSpanStyles.outlineHeight);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineWidth = null as any as number;\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineHeight = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.BorderX) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineWidth += progression * (tag.value - currentSpanStyles.outlineWidth);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineWidth = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.BorderY) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineHeight += progression * (tag.value - currentSpanStyles.outlineHeight);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineHeight = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.Shadow) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowDepthX += progression * (tag.value - currentSpanStyles.shadowDepthX);\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowDepthY += progression * (tag.value - currentSpanStyles.shadowDepthY);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowDepthX = null as any as number;\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowDepthY = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.ShadowX) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowDepthX += progression * (tag.value - currentSpanStyles.shadowDepthX);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowDepthX = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.ShadowY) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowDepthY += progression * (tag.value - currentSpanStyles.shadowDepthY);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowDepthY = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.Blur) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.blur += progression * (tag.value - currentSpanStyles.blur);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.blur = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.GaussianBlur) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.gaussianBlur += progression * (tag.value - currentSpanStyles.gaussianBlur);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.gaussianBlur = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.FontSize) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.fontSize += progression * (tag.value - currentSpanStyles.fontSize);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.fontSize = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.FontSizePlus) {\n\t\t\t\t\t\tcurrentSpanStyles.fontSize *= (1 + progression * tag.value);\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.FontSizeMinus) {\n\t\t\t\t\t\tcurrentSpanStyles.fontSize *= (1 - progression * tag.value);\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.FontScaleX) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.fontScaleX += progression * (tag.value - currentSpanStyles.fontScaleX);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.fontScaleX = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.FontScaleY) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.fontScaleY += progression * (tag.value - currentSpanStyles.fontScaleY);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.fontScaleY = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.LetterSpacing) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.letterSpacing += progression * (tag.value - currentSpanStyles.letterSpacing);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.letterSpacing = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.RotateX) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.rotationX += progression * (tag.value - currentSpanStyles.rotationX);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.rotationX = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.RotateY) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.rotationY += progression * (tag.value - currentSpanStyles.rotationY);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.rotationY = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.RotateZ) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.rotationZ += progression * (tag.value - currentSpanStyles.rotationZ);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.rotationZ = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.SkewX) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.skewX += progression * (tag.value - currentSpanStyles.skewX);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.skewX = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.SkewY) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.skewY += progression * (tag.value - currentSpanStyles.skewY);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.skewY = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.PrimaryColor) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.primaryColor = currentSpanStyles.primaryColor!.interpolate(tag.value, progression);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.primaryColor = null as any as parts.Color;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.SecondaryColor) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.secondaryColor = currentSpanStyles.secondaryColor!.interpolate(tag.value, progression);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.secondaryColor = null as any as parts.Color;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.OutlineColor) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineColor = currentSpanStyles.outlineColor!.interpolate(tag.value, progression);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineColor = null as any as parts.Color;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.ShadowColor) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowColor = currentSpanStyles.shadowColor!.interpolate(tag.value, progression);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowColor = null as any as parts.Color;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.Alpha) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.primaryAlpha += progression * (tag.value - currentSpanStyles.primaryAlpha);\n\t\t\t\t\t\t\tcurrentSpanStyles.secondaryAlpha += progression * (tag.value - currentSpanStyles.secondaryAlpha);\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineAlpha += progression * (tag.value - currentSpanStyles.outlineAlpha);\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowAlpha += progression * (tag.value - currentSpanStyles.shadowAlpha);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.primaryAlpha = null as any as number;\n\t\t\t\t\t\t\tcurrentSpanStyles.secondaryAlpha = null as any as number;\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineAlpha = null as any as number;\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowAlpha = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.PrimaryAlpha) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.primaryAlpha += progression * (tag.value - currentSpanStyles.primaryAlpha);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.primaryAlpha = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.SecondaryAlpha) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.secondaryAlpha += progression * (tag.value - currentSpanStyles.secondaryAlpha);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.secondaryAlpha = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.OutlineAlpha) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineAlpha += progression * (tag.value - currentSpanStyles.outlineAlpha);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.outlineAlpha = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\telse if (tag instanceof parts.ShadowAlpha) {\n\t\t\t\t\t\tif (tag.value !== null) {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowAlpha += progression * (tag.value - currentSpanStyles.shadowAlpha);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcurrentSpanStyles.shadowAlpha = null as any as number;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.DrawingMode) {\n\t\t\t\tif (part.scale !== 0) {\n\t\t\t\t\tcurrentDrawingStyles.scale = part.scale;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.DrawingBaselineOffset) {\n\t\t\t\tcurrentDrawingStyles.baselineOffset = part.value;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.DrawingInstructions) {\n\t\t\t\tcurrentSpan!.appendChild(currentDrawingStyles.toSVG(part, currentSpanStyles.primaryColor!.withAlpha(currentSpanStyles.primaryAlpha!)));\n\t\t\t\tstartNewSpan(false);\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Text) {\n\t\t\t\tcurrentSpan!.appendChild(document.createTextNode(part.value + \"\\u200C\"));\n\t\t\t\tstartNewSpan(false);\n\t\t\t}\n\n\t\t\telse if (debugMode && part instanceof parts.Comment) {\n\t\t\t\tcurrentSpan!.appendChild(document.createTextNode(part.value));\n\t\t\t\tstartNewSpan(false);\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.NewLine) {\n\t\t\t\tstartNewSpan(true);\n\t\t\t}\n\t\t}\n\n\t\tlet divTransformStyle = \"\";\n\t\tconst transformOrigin = WebRenderer._transformOrigins[dialogue.alignment];\n\t\tconst transformOriginString = `${ transformOrigin[0] }% ${ transformOrigin[1] }%`;\n\n\t\tfor (const part of dialogue.parts) {\n\t\t\tif (part instanceof parts.Position || part instanceof parts.Move) {\n\n\t\t\t\tdivTransformStyle = `translate(${ -transformOrigin[0] }%, ${ -transformOrigin[1] }%) translate(-${ sub.style.marginLeft }, -${ sub.style.marginTop })`;\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (currentSpanStyles.rotationY !== 0) {\n\t\t\tdivTransformStyle += ` rotateY(${ currentSpanStyles.rotationY }deg)`;\n\t\t}\n\t\tif (currentSpanStyles.rotationX !== 0) {\n\t\t\tdivTransformStyle += ` rotateX(${ currentSpanStyles.rotationX }deg)`;\n\t\t}\n\t\tif (currentSpanStyles.rotationZ !== 0) {\n\t\t\tdivTransformStyle += ` rotateZ(${ -1 * currentSpanStyles.rotationZ }deg)`;\n\t\t}\n\n\t\tsub.style.webkitTransform = divTransformStyle;\n\t\tsub.style.transform = divTransformStyle;\n\n\t\tsub.style.webkitTransformOrigin = transformOriginString;\n\t\tsub.style.transformOrigin = transformOriginString;\n\n\t\tswitch (wrappingStyle) {\n\t\t\tcase WrappingStyle.EndOfLineWrapping:\n\t\t\t\tsub.style.whiteSpace = \"pre-wrap\";\n\t\t\t\tbreak;\n\n\t\t\tcase WrappingStyle.NoLineWrapping:\n\t\t\t\tsub.style.whiteSpace = \"pre\";\n\t\t\t\tbreak;\n\n\t\t\tcase WrappingStyle.SmartWrappingWithWiderTopLine:\n\t\t\tcase WrappingStyle.SmartWrappingWithWiderBottomLine:\n\t\t\t\t/* Not supported. Treat the same as EndOfLineWrapping */\n\t\t\t\tsub.style.whiteSpace = \"pre-wrap\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (sub.style.position !== \"\") {\n\t\t\t// Explicitly set text alignment on absolutely-positioned subs because they'll go in a .an0 <div> and so won't get alignment CSS text-align.\n\t\t\tswitch (dialogue.alignment) {\n\t\t\t\tcase 1: case 4: case 7: sub.style.textAlign = \"left\"; break;\n\t\t\t\tcase 2: case 5: case 8: sub.style.textAlign = \"center\"; break;\n\t\t\t\tcase 3: case 6: case 9: sub.style.textAlign = \"right\"; break;\n\t\t\t}\n\t\t}\n\n\t\tsub.style.webkitAnimation = dialogueAnimationCollection.animationStyle;\n\t\tsub.style.animation = dialogueAnimationCollection.animationStyle;\n\n\t\tsub.setAttribute(\"data-dialogue-id\", `${ this.id }-${ dialogue.id }`);\n\n\t\tif (dialogueAnimationStylesElement.textContent !== \"\") {\n\t\t\tsub.appendChild(dialogueAnimationStylesElement);\n\t\t}\n\n\t\tif (svgDefsElement.hasChildNodes()) {\n\t\t\tsub.appendChild(svgElement);\n\t\t}\n\n\t\tconst result = { sub, animationDelays: dialogueAnimationCollection.animationDelays };\n\n\t\tif (!dialogue.containsTransformTag) {\n\t\t\tthis._preRenderedSubs.set(dialogue.id, result);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * Returns the subtitle div for display. The {@link libjass.renderers.Clock.currentTime} of the {@link libjass.renderers.NullRenderer.clock} is used to shift the\n\t * animations appropriately, so that at the time the div is inserted into the DOM and the animations begin, they are in sync with the clock time.\n\t *\n\t * @param {!libjass.Dialogue} dialogue\n\t */\n\tdraw(dialogue: Dialogue): void {\n\t\tif (this._currentSubs.has(dialogue) && !dialogue.containsTransformTag) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (debugMode) {\n\t\t\tconsole.log(dialogue.toString());\n\t\t}\n\n\t\tlet thePreRenderedSub = this._preRenderedSubs.get(dialogue.id);\n\n\t\tif (thePreRenderedSub === undefined) {\n\t\t\tthePreRenderedSub = this.preRender(dialogue)!;\n\n\t\t\tif (debugMode) {\n\t\t\t\tconsole.log(dialogue.toString());\n\t\t\t}\n\t\t}\n\n\t\tconst preRenderedSub = thePreRenderedSub;\n\n\t\tconst result = preRenderedSub.sub.cloneNode(true);\n\n\t\tconst applyAnimationDelays = (node: HTMLElement) => {\n\t\t\tconst animationNames = node.style.animationName || node.style.webkitAnimationName || \"\";\n\t\t\tif (animationNames !== \"\") {\n\t\t\t\tconst animationDelays = animationNames.split(\",\").map(name => {\n\t\t\t\t\tname = name.trim();\n\t\t\t\t\tconst delay = preRenderedSub.animationDelays.get(name)!;\n\t\t\t\t\treturn `${ ((delay + dialogue.start - this.clock.currentTime) / this.clock.rate).toFixed(3) }s`;\n\t\t\t\t}).join(\", \");\n\n\t\t\t\tnode.style.webkitAnimationDelay = animationDelays;\n\t\t\t\tnode.style.animationDelay = animationDelays;\n\t\t\t}\n\t\t};\n\t\tapplyAnimationDelays(result);\n\t\tconst animatedDescendants = result.querySelectorAll('[style*=\"animation:\"]');\n\t\tfor (let i = 0; i < animatedDescendants.length; i++) {\n\t\t\tapplyAnimationDelays(animatedDescendants[i] as HTMLElement);\n\t\t}\n\n\t\tconst layer = dialogue.layer;\n\t\tconst alignment = (result.style.position === \"absolute\") ? 0 : dialogue.alignment; // Alignment 0 is for absolutely-positioned subs\n\n\t\t// Create the layer wrapper div and the alignment div inside it if not already created\n\t\tif (this._layerWrappers[layer] === undefined) {\n\t\t\tconst layerWrapper = document.createElement(\"div\");\n\t\t\tlayerWrapper.className = `layer layer${ layer }`;\n\n\t\t\t// Find the next greater layer div and insert this div before that one\n\t\t\tlet insertBeforeElement: HTMLDivElement | null = null;\n\t\t\tfor (let insertBeforeLayer = layer + 1; insertBeforeLayer < this._layerWrappers.length && insertBeforeElement === null; insertBeforeLayer++) {\n\t\t\t\tif (this._layerWrappers[insertBeforeLayer] !== undefined) {\n\t\t\t\t\tinsertBeforeElement = this._layerWrappers[insertBeforeLayer];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._subsWrapper.insertBefore(layerWrapper, insertBeforeElement);\n\n\t\t\tthis._layerWrappers[layer] = layerWrapper;\n\t\t\tthis._layerAlignmentWrappers[layer] = [];\n\t\t}\n\n\t\tlet layerAlignmentWrapper = this._layerAlignmentWrappers[layer][alignment];\n\t\tif (layerAlignmentWrapper === undefined) {\n\t\t\tlayerAlignmentWrapper = this._layerAlignmentWrappers[layer][alignment] = document.createElement(\"div\");\n\t\t\tlayerAlignmentWrapper.className = `an an${ alignment }`;\n\n\t\t\t// Find the next greater layer,alignment div and insert this div before that one\n\t\t\tconst layerWrapper = this._layerWrappers[layer];\n\t\t\tlet insertBeforeElement: HTMLDivElement | null = null;\n\t\t\tfor (let insertBeforeAlignment = alignment + 1; insertBeforeAlignment < this._layerAlignmentWrappers[layer].length && insertBeforeElement === null; insertBeforeAlignment++) {\n\t\t\t\tif (this._layerAlignmentWrappers[layer][insertBeforeAlignment] !== undefined) {\n\t\t\t\t\tinsertBeforeElement = this._layerAlignmentWrappers[layer][insertBeforeAlignment];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlayerWrapper.insertBefore(layerAlignmentWrapper, insertBeforeElement);\n\t\t}\n\n\t\tif (alignment >= 1 && alignment <= 3) {\n\t\t\t// New subs go above existing subs\n\t\t\tlayerAlignmentWrapper.insertBefore(result, layerAlignmentWrapper.firstElementChild);\n\t\t}\n\t\telse {\n\t\t\t// New subs go below existing subs\n\t\t\tlayerAlignmentWrapper.appendChild(result);\n\t\t}\n\n\t\t// Workaround for IE\n\t\tconst dialogueAnimationStylesElement = result.getElementsByTagName(\"style\")[0];\n\t\tif (dialogueAnimationStylesElement !== undefined) {\n\t\t\tconst sheet = dialogueAnimationStylesElement.sheet as CSSStyleSheet;\n\t\t\tif (sheet.cssRules.length === 0) {\n\t\t\t\tsheet.cssText = dialogueAnimationStylesElement.textContent!;\n\t\t\t}\n\t\t}\n\n\t\tthis._currentSubs.set(dialogue, result);\n\t}\n\n\tprotected _onClockPlay(): void {\n\t\tsuper._onClockPlay();\n\n\t\tthis._removeAllSubs();\n\n\t\tthis._subsWrapper.style.display = \"\";\n\n\t\tthis._subsWrapper.classList.remove(\"paused\");\n\t}\n\n\tprotected _onClockTick(): void {\n\t\t// Remove dialogues that should be removed before adding new ones via super._onClockTick()\n\n\t\tconst currentTime = this.clock.currentTime;\n\n\t\tthis._currentSubs.forEach((sub: HTMLDivElement, dialogue: Dialogue) => {\n\t\t\tif (dialogue.start > currentTime || dialogue.end < currentTime || dialogue.containsTransformTag) {\n\t\t\t\tthis._currentSubs.delete(dialogue);\n\t\t\t\tthis._removeSub(sub);\n\t\t\t}\n\t\t});\n\n\t\tsuper._onClockTick();\n\t}\n\n\tprotected _onClockPause(): void {\n\t\tsuper._onClockPause();\n\n\t\tthis._subsWrapper.classList.add(\"paused\");\n\t}\n\n\tprotected _onClockStop(): void {\n\t\tsuper._onClockStop();\n\n\t\tthis._subsWrapper.style.display = \"none\";\n\t}\n\n\tprotected _onClockRateChange(): void {\n\t\tsuper._onClockRateChange();\n\n\t\t// Any dialogues which have been pre-rendered will need to be pre-rendered again.\n\t\tthis._preRenderedSubs.clear();\n\t}\n\n\tprotected _ready(): void {\n\t\tthis._dispatchEvent(\"ready\", []);\n\t}\n\n\t/**\n\t * @param {string} fontFamily\n\t * @param {!Promise.<*>} fontFetchPromise\n\t * @return {!Promise.<[number, number]>}\n\t */\n\tprivate _calculateFontMetricsAfterFetch(fontFamily: string, fontFetchPromise: Promise<any>): Promise<[number, number]> {\n\t\treturn fontFetchPromise.then(() => {\n\t\t\tconst fontSizeElement = this._fontSizeElement.cloneNode(true);\n\t\t\tthis._libjassSubsWrapper.appendChild(fontSizeElement);\n\t\t\treturn Promise_finally(calculateFontMetrics(fontFamily, this.settings.fallbackFonts, fontSizeElement), () => {\n\t\t\t\tthis._libjassSubsWrapper.removeChild(fontSizeElement);\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @param {!HTMLDivElement} sub\n\t */\n\tprivate _removeSub(sub: HTMLDivElement): void {\n\t\tsub.parentNode!.removeChild(sub);\n\t}\n\n\tprivate _removeAllSubs(): void {\n\t\tthis._currentSubs.forEach((sub: HTMLDivElement) => this._removeSub(sub));\n\t\tthis._currentSubs.clear();\n\t}\n\n\n\t// EventSource members\n\n\t/**\n\t * @type {!Map.<T, !Array.<Function>>}\n\t */\n\t_eventListeners: Map<string, Function[]> = new Map<string, Function[]>();\n\n\t/**\n\t * @type {function(number, !Function)}\n\t */\n\taddEventListener: (type: string, listener: Function) => void;\n\n\t/**\n\t * @type {function(number, Array.<*>)}\n\t */\n\t_dispatchEvent: (type: string, args: Object[]) => void;\n}\nmixin(WebRenderer, [EventSource]);\n\nexport interface PreRenderedSub {\n\t/** @type {!HTMLDivElement} */\n\tsub: HTMLDivElement;\n\n\t/** @type {!Map.<string, number>} */\n\tanimationDelays: Map<string, number>;\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Color } from \"../../parts\";\n\nimport { Dialogue } from \"../../types/dialogue\";\nimport { Style } from \"../../types/style\";\n\nimport { Map } from \"../../utility/map\";\n\nimport { RendererSettings } from \"../settings\";\n\nimport { AnimationCollection } from \"./animation-collection\";\nimport { fontSizeForLineHeight } from \"./font-size\";\nimport { WebRenderer } from \"./renderer\";\n\n/**\n * This class represents the style attribute of a span.\n * As a Dialogue's div is rendered, individual parts are added to span's, and this class is used to maintain the style attribute of those.\n *\n * @param {!libjass.renderers.NullRenderer} renderer The renderer that this set of styles is associated with\n * @param {!libjass.Dialogue} dialogue The Dialogue that this set of styles is associated with\n * @param {number} scaleX The horizontal scaling of the subtitles\n * @param {number} scaleY The vertical scaling of the subtitles\n * @param {!libjass.renderers.RendererSettings} settings The renderer settings\n * @param {!HTMLDivElement} fontSizeElement A <div> element to measure font sizes with\n * @param {!SVGDefsElement} svgDefsElement An SVG <defs> element to append filter definitions to\n * @param {!Map<string, [number, number]>} fontMetricsCache Font metrics cache\n */\nexport class SpanStyles {\n\tprivate _id: string;\n\tprivate _defaultStyle: Style;\n\n\tprivate _italic: boolean;\n\tprivate _bold: boolean | number;\n\tprivate _underline: boolean;\n\tprivate _strikeThrough: boolean;\n\n\tprivate _outlineWidth: number;\n\tprivate _outlineHeight: number;\n\n\tprivate _shadowDepthX: number;\n\tprivate _shadowDepthY: number;\n\n\tprivate _fontName: string;\n\tprivate _fontSize: number;\n\n\tprivate _fontScaleX: number;\n\tprivate _fontScaleY: number;\n\n\tprivate _letterSpacing: number;\n\n\tprivate _rotationX: number;\n\tprivate _rotationY: number;\n\tprivate _rotationZ: number;\n\n\tprivate _skewX: number;\n\tprivate _skewY: number;\n\n\tprivate _primaryColor: Color;\n\tprivate _secondaryColor: Color;\n\tprivate _outlineColor: Color;\n\tprivate _shadowColor: Color;\n\n\tprivate _primaryAlpha: number;\n\tprivate _secondaryAlpha: number;\n\tprivate _outlineAlpha: number;\n\tprivate _shadowAlpha: number;\n\n\tprivate _blur: number;\n\tprivate _gaussianBlur: number;\n\n\tprivate _nextFilterId: number = 0;\n\n\tconstructor(renderer: WebRenderer, dialogue: Dialogue, private _scaleX: number, private _scaleY: number, private _settings: RendererSettings, private _fontSizeElement: HTMLDivElement, private _svgDefsElement: SVGDefsElement, private _fontMetricsCache: Map<string, [number, number]>) {\n\t\tthis._id = `${ renderer.id }-${ dialogue.id }`;\n\t\tthis._defaultStyle = dialogue.style;\n\n\t\tthis.reset(null);\n\t}\n\n\t/**\n\t * Resets the styles to the defaults provided by the argument.\n\t *\n\t * @param {libjass.Style} newStyle The new defaults to reset the style to. If null, the styles are reset to the default style of the Dialogue.\n\t */\n\treset(newStyle: Style | undefined | null): void {\n\t\tif (newStyle === undefined || newStyle === null) {\n\t\t\tnewStyle = this._defaultStyle;\n\t\t}\n\n\t\tthis.italic = newStyle.italic;\n\t\tthis.bold = newStyle.bold;\n\t\tthis.underline = newStyle.underline;\n\t\tthis.strikeThrough = newStyle.strikeThrough;\n\n\t\tthis.outlineWidth = newStyle.outlineThickness;\n\t\tthis.outlineHeight = newStyle.outlineThickness;\n\n\t\tthis.shadowDepthX = newStyle.shadowDepth;\n\t\tthis.shadowDepthY = newStyle.shadowDepth;\n\n\t\tthis.fontName = newStyle.fontName;\n\t\tthis.fontSize = newStyle.fontSize;\n\n\t\tthis.fontScaleX = newStyle.fontScaleX;\n\t\tthis.fontScaleY = newStyle.fontScaleY;\n\n\t\tthis.letterSpacing = newStyle.letterSpacing;\n\n\t\tthis.rotationX = 0;\n\t\tthis.rotationY = 0;\n\t\tthis.rotationZ = newStyle.rotationZ;\n\n\t\tthis.skewX = 0;\n\t\tthis.skewY = 0;\n\n\t\tthis.primaryColor = newStyle.primaryColor;\n\t\tthis.secondaryColor = newStyle.secondaryColor;\n\t\tthis.outlineColor = newStyle.outlineColor;\n\t\tthis.shadowColor = newStyle.shadowColor;\n\n\t\tthis.primaryAlpha = newStyle.primaryColor.alpha;\n\t\tthis.secondaryAlpha = newStyle.secondaryColor.alpha;\n\t\tthis.outlineAlpha = newStyle.outlineColor.alpha;\n\t\tthis.shadowAlpha = newStyle.shadowColor.alpha;\n\n\t\tthis.blur = null as any as number;\n\t\tthis.gaussianBlur = null as any as number;\n\t}\n\n\t/**\n\t * Sets the style attribute on the given span element.\n\t *\n\t * @param {!HTMLSpanElement} span\n\t * @param {!AnimationCollection} animationCollection\n\t * @return {!HTMLSpanElement} The resulting <span> with the CSS styles applied. This may be a wrapper around the input <span> if the styles were applied using SVG filters.\n\t */\n\tsetStylesOnSpan(span: HTMLSpanElement, animationCollection: AnimationCollection): HTMLSpanElement {\n\t\tconst isTextOnlySpan = span.childNodes[0] instanceof Text;\n\n\t\tlet fontStyleOrWeight = \"\";\n\t\tif (this._italic) {\n\t\t\tfontStyleOrWeight += \"italic \";\n\t\t}\n\t\tif (this._bold === true) {\n\t\t\tfontStyleOrWeight += \"bold \";\n\t\t}\n\t\telse if (this._bold !== false) {\n\t\t\tfontStyleOrWeight += this._bold.toFixed(0) + \" \";\n\t\t}\n\n\t\tconst lineHeight = this._scaleY * (isTextOnlySpan ? this._fontScaleX : 1) * this._fontSize;\n\t\tconst fontSize = fontSizeForLineHeight(this._fontName, lineHeight, this._settings.fallbackFonts, this._fontSizeElement, this._fontMetricsCache);\n\n\t\tlet fonts = this._fontName;\n\n\t\t// Quote the font family unless it's a generic family, as those must never be quoted\n\t\tswitch (fonts) {\n\t\t\tcase \"cursive\":\n\t\t\tcase \"fantasy\":\n\t\t\tcase \"monospace\":\n\t\t\tcase \"sans-serif\":\n\t\t\tcase \"serif\":\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tfonts = `\"${ fonts }\"`;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (this._settings.fallbackFonts !== \"\") {\n\t\t\tfonts += `, ${ this._settings.fallbackFonts }`;\n\t\t}\n\n\t\tspan.style.font = `${ fontStyleOrWeight }${ fontSize.toFixed(3) }px/${ lineHeight.toFixed(3) }px ${ fonts }`;\n\n\t\tlet textDecoration = \"\";\n\t\tif (this._underline) {\n\t\t\ttextDecoration = \"underline\";\n\t\t}\n\t\tif (this._strikeThrough) {\n\t\t\ttextDecoration += \" line-through\";\n\t\t}\n\t\tspan.style.textDecoration = textDecoration.trim();\n\n\t\tlet transform = \"\";\n\t\tif (isTextOnlySpan) {\n\t\t\tif (this._fontScaleY !== this._fontScaleX) {\n\t\t\t\ttransform += `scaleY(${ (this._fontScaleY / this._fontScaleX).toFixed(3) }) `;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (this._fontScaleX !== 1) {\n\t\t\t\ttransform += `scaleX(${ this._fontScaleX }) `;\n\t\t\t}\n\t\t\tif (this._fontScaleY !== 1) {\n\t\t\t\ttransform += `scaleY(${ this._fontScaleY }) `;\n\t\t\t}\n\t\t}\n\t\tif (this._skewX !== 0 || this._skewY !== 0) {\n\t\t\ttransform += `matrix(1, ${ this._skewY }, ${ this._skewX }, 1, 0, 0) `;\n\t\t}\n\t\tif (transform !== \"\") {\n\t\t\tspan.style.webkitTransform = transform;\n\t\t\tspan.style.webkitTransformOrigin = \"50% 50%\";\n\t\t\tspan.style.transform = transform;\n\t\t\tspan.style.transformOrigin = \"50% 50%\";\n\t\t\tspan.style.display = \"inline-block\";\n\t\t}\n\n\t\tspan.style.letterSpacing = `${ (this._scaleX * this._letterSpacing).toFixed(3) }px`;\n\n\t\tconst outlineWidth = this._scaleX * this._outlineWidth;\n\t\tconst outlineHeight = this._scaleY * this._outlineHeight;\n\t\tconst shadowDepthX = this._scaleX * this._shadowDepthX;\n\t\tconst shadowDepthY = this._scaleY * this._shadowDepthY;\n\n\t\tlet primaryColor = this._primaryColor.withAlpha(this._primaryAlpha);\n\t\tlet outlineColor = this._outlineColor.withAlpha(this._outlineAlpha);\n\t\tlet shadowColor = this._shadowColor.withAlpha(this._shadowAlpha);\n\n\t\t// If we're in non-SVG mode and all colors have the same alpha, then set all colors to alpha === 1 and set the common alpha as the span's opacity property instead\n\t\tif (\n\t\t\t!this._settings.enableSvg &&\n\t\t\t((outlineWidth === 0 && outlineHeight === 0) || outlineColor.alpha === primaryColor.alpha) &&\n\t\t\t((this._shadowDepthX === 0 && this._shadowDepthY === 0) || shadowColor.alpha === primaryColor.alpha)\n\t\t) {\n\t\t\tprimaryColor = this._primaryColor.withAlpha(1);\n\t\t\toutlineColor = this._outlineColor.withAlpha(1);\n\t\t\tshadowColor = this._shadowColor.withAlpha(1);\n\n\t\t\tspan.style.opacity = this._primaryAlpha.toFixed(3);\n\t\t}\n\n\t\tspan.style.color = primaryColor.toString();\n\n\t\tif (this._settings.enableSvg) {\n\t\t\tthis._svg(\n\t\t\t\tspan,\n\t\t\t\toutlineWidth, outlineHeight, outlineColor,\n\t\t\t\tshadowDepthX, shadowDepthY, shadowColor\n\t\t\t);\n\t\t}\n\t\telse {\n\t\t\tthis._textShadow(\n\t\t\t\tspan,\n\t\t\t\toutlineWidth, outlineHeight, outlineColor,\n\t\t\t\tshadowDepthX, shadowDepthY, shadowColor\n\t\t\t);\n\t\t}\n\n\t\tif (this._rotationX !== 0 || this._rotationY !== 0) {\n\t\t\t// Perspective needs to be set on a \"transformable element\"\n\t\t\tspan.style.display = \"inline-block\";\n\t\t}\n\n\t\tspan.style.webkitAnimation = animationCollection.animationStyle;\n\t\tspan.style.animation = animationCollection.animationStyle;\n\n\t\treturn span;\n\t}\n\n\t/**\n\t * @return {!HTMLBRElement}\n\t */\n\tmakeNewLine(): HTMLBRElement {\n\t\tconst result = document.createElement(\"br\");\n\t\tresult.style.lineHeight = `${ (this._scaleY * this._fontSize).toFixed(3) }px`;\n\t\treturn result;\n\t}\n\n\t/**\n\t * @param {!HTMLSpanElement} span\n\t * @param {number} outlineWidth\n\t * @param {number} outlineHeight\n\t * @param {!libjass.parts.Color} outlineColor\n\t * @param {number} shadowDepthX\n\t * @param {number} shadowDepthY\n\t * @param {!libjass.parts.Color} shadowColor\n\t */\n\tprivate _svg(\n\t\tspan: HTMLSpanElement,\n\t\toutlineWidth: number, outlineHeight: number, outlineColor: Color,\n\t\tshadowDepthX: number, shadowDepthY: number, shadowColor: Color\n\t): void {\n\t\tconst filterElement = document.createElementNS(\"http://www.w3.org/2000/svg\", \"filter\");\n\n\t\tif (outlineWidth > 0 || outlineHeight > 0 || shadowDepthX > 0 || shadowDepthY > 0) {\n\t\t\t// Start with SourceAlpha. Leave the alpha as 0 if it's 0, and set it to 1 if it's greater than 0\n\t\t\tconst source = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feComponentTransfer\");\n\t\t\tfilterElement.appendChild(source);\n\t\t\tsource.in1.baseVal = \"SourceAlpha\";\n\t\t\tsource.result.baseVal = \"source\";\n\n\t\t\tconst sourceAlphaTransferNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feFuncA\");\n\t\t\tsource.appendChild(sourceAlphaTransferNode);\n\t\t\tsourceAlphaTransferNode.type.baseVal = SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR;\n\t\t\tsourceAlphaTransferNode.intercept.baseVal = 0;\n\n\t\t\t/* The alphas of all colored pixels of the SourceAlpha should be made as close to 1 as possible. This way the summed outlines below will be uniformly dark.\n\t\t\t * Multiply the pixels by 1 / primaryAlpha so that the primaryAlpha pixels become 1. A higher value would make the outline larger and too sharp,\n\t\t\t * leading to jagged outer edge and transparent space around the inner edge between itself and the SourceGraphic.\n\t\t\t */\n\t\t\tsourceAlphaTransferNode.slope.baseVal = (this._primaryAlpha === 0) ? 1 : (1 / this._primaryAlpha);\n\n\t\t\t/* Construct an elliptical border by merging together many rectangles. The border is creating using dilate morphology filters, but these only support\n\t\t\t * generating rectangles.   http://lists.w3.org/Archives/Public/public-fx/2012OctDec/0003.html\n\t\t\t */\n\n\t\t\t// Merge the individual outlines\n\t\t\tconst mergedOutlines = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMerge\");\n\t\t\tfilterElement.appendChild(mergedOutlines);\n\t\t\tmergedOutlines.result.baseVal = \"outline-alpha\";\n\n\t\t\tlet outlineNumber = 0;\n\n\t\t\tconst increment = (!this._settings.preciseOutlines && this._gaussianBlur > 0) ? this._gaussianBlur : 1;\n\n\t\t\t((addOutline: (x: number, y: number) => void) => {\n\t\t\t\tif (outlineWidth <= outlineHeight) {\n\t\t\t\t\tif (outlineWidth > 0) {\n\t\t\t\t\t\tlet x: number;\n\t\t\t\t\t\tfor (x = 0; x <= outlineWidth; x += increment) {\n\t\t\t\t\t\t\taddOutline(x, outlineHeight / outlineWidth * Math.sqrt(outlineWidth * outlineWidth - x * x));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (x !== outlineWidth + increment) {\n\t\t\t\t\t\t\taddOutline(outlineWidth, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\taddOutline(0, outlineHeight);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (outlineHeight > 0) {\n\t\t\t\t\t\tlet y: number;\n\t\t\t\t\t\tfor (y = 0; y <= outlineHeight; y += increment) {\n\t\t\t\t\t\t\taddOutline(outlineWidth / outlineHeight * Math.sqrt(outlineHeight * outlineHeight - y * y), y);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (y !== outlineHeight + increment) {\n\t\t\t\t\t\t\taddOutline(0, outlineHeight);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\taddOutline(outlineWidth, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})((x: number, y: number): void => {\n\t\t\t\tconst outlineId = `outline${ outlineNumber }`;\n\n\t\t\t\tconst outlineFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMorphology\");\n\t\t\t\tfilterElement.insertBefore(outlineFilter, mergedOutlines);\n\t\t\t\toutlineFilter.in1.baseVal = \"source\";\n\t\t\t\toutlineFilter.operator.baseVal = SVGFEMorphologyElement.SVG_MORPHOLOGY_OPERATOR_DILATE;\n\t\t\t\toutlineFilter.radiusX.baseVal = x;\n\t\t\t\toutlineFilter.radiusY.baseVal = y;\n\t\t\t\toutlineFilter.result.baseVal = outlineId;\n\n\t\t\t\tconst outlineReferenceNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMergeNode\");\n\t\t\t\tmergedOutlines.appendChild(outlineReferenceNode);\n\t\t\t\toutlineReferenceNode.in1.baseVal = outlineId;\n\n\t\t\t\toutlineNumber++;\n\t\t\t});\n\n\t\t\t((addOutline: (x: number, y: number) => void) => {\n\t\t\t\tif ((outlineWidth % 1) > 0) {\n\t\t\t\t\taddOutline(outlineWidth, 0);\n\t\t\t\t\taddOutline(-outlineWidth, 0);\n\t\t\t\t}\n\n\t\t\t\tif ((outlineHeight % 1) > 0) {\n\t\t\t\t\taddOutline(0, outlineHeight);\n\t\t\t\t\taddOutline(0, -outlineHeight);\n\t\t\t\t}\n\t\t\t})((x: number, y: number): void => {\n\t\t\t\tconst outlineId = `outline${ outlineNumber }`;\n\n\t\t\t\tconst outlineFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feOffset\");\n\t\t\t\tfilterElement.insertBefore(outlineFilter, mergedOutlines);\n\t\t\t\toutlineFilter.in1.baseVal = \"source\";\n\t\t\t\toutlineFilter.dx.baseVal = x;\n\t\t\t\toutlineFilter.dy.baseVal = y;\n\t\t\t\toutlineFilter.result.baseVal = outlineId;\n\n\t\t\t\tconst outlineReferenceNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMergeNode\");\n\t\t\t\tmergedOutlines.appendChild(outlineReferenceNode);\n\t\t\t\toutlineReferenceNode.in1.baseVal = outlineId;\n\n\t\t\t\toutlineNumber++;\n\t\t\t});\n\n\t\t\t// Color it with the outline color\n\t\t\tconst coloredOutline = createComponentTransferFilter(outlineColor);\n\t\t\tfilterElement.appendChild(coloredOutline);\n\t\t\tcoloredOutline.in1.baseVal = \"outline-alpha\";\n\n\t\t\t// Blur the merged outline\n\t\t\tif (this._gaussianBlur > 0) {\n\t\t\t\tconst gaussianBlurFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feGaussianBlur\");\n\t\t\t\tfilterElement.appendChild(gaussianBlurFilter);\n\n\t\t\t\t// Don't use setStdDeviation - cloneNode() clears it in Chrome\n\t\t\t\tgaussianBlurFilter.stdDeviationX.baseVal = this._gaussianBlur;\n\t\t\t\tgaussianBlurFilter.stdDeviationY.baseVal = this._gaussianBlur;\n\t\t\t}\n\t\t\tfor (let i = 0; i < this._blur; i++) {\n\t\t\t\tconst blurFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feConvolveMatrix\");\n\t\t\t\tfilterElement.appendChild(blurFilter);\n\t\t\t\tblurFilter.setAttribute(\"kernelMatrix\", \"1 2 1 2 4 2 1 2 1\");\n\t\t\t\tblurFilter.edgeMode.baseVal = SVGFEConvolveMatrixElement.SVG_EDGEMODE_NONE;\n\t\t\t}\n\n\t\t\t// Cut out the source, so only the exterior remains\n\t\t\tconst cutoutNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feComposite\");\n\t\t\tfilterElement.appendChild(cutoutNode);\n\t\t\tcutoutNode.in2.baseVal = \"source\";\n\t\t\tcutoutNode.operator.baseVal = SVGFECompositeElement.SVG_FECOMPOSITE_OPERATOR_OUT;\n\t\t\tcutoutNode.result.baseVal = \"outline-colored\";\n\n\t\t\tif (shadowDepthX > 0 || shadowDepthY > 0) {\n\t\t\t\tconst shadowFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feOffset\");\n\t\t\t\tfilterElement.appendChild(shadowFilter);\n\t\t\t\tshadowFilter.in1.baseVal = \"outline-alpha\";\n\t\t\t\tshadowFilter.dx.baseVal = shadowDepthX;\n\t\t\t\tshadowFilter.dy.baseVal = shadowDepthY;\n\n\t\t\t\t// Color it with the shadow color\n\t\t\t\tconst coloredShadow = createComponentTransferFilter(shadowColor);\n\t\t\t\tfilterElement.appendChild(coloredShadow);\n\n\t\t\t\tlet lastFilter: SVGFEComponentTransferElement | SVGFEGaussianBlurElement | SVGFEConvolveMatrixElement = coloredShadow;\n\n\t\t\t\t// Blur the shadow\n\t\t\t\tif (this._gaussianBlur > 0) {\n\t\t\t\t\tconst gaussianBlurFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feGaussianBlur\");\n\t\t\t\t\tfilterElement.appendChild(gaussianBlurFilter);\n\n\t\t\t\t\t// Don't use setStdDeviation - cloneNode() clears it in Chrome\n\t\t\t\t\tgaussianBlurFilter.stdDeviationX.baseVal = this._gaussianBlur;\n\t\t\t\t\tgaussianBlurFilter.stdDeviationY.baseVal = this._gaussianBlur;\n\n\t\t\t\t\tlastFilter = gaussianBlurFilter;\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < this._blur; i++) {\n\t\t\t\t\tconst blurFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feConvolveMatrix\");\n\t\t\t\t\tfilterElement.appendChild(blurFilter);\n\t\t\t\t\tblurFilter.setAttribute(\"kernelMatrix\", \"1 2 1 2 4 2 1 2 1\");\n\t\t\t\t\tblurFilter.edgeMode.baseVal = SVGFEConvolveMatrixElement.SVG_EDGEMODE_NONE;\n\n\t\t\t\t\tlastFilter = blurFilter;\n\t\t\t\t}\n\n\t\t\t\tlastFilter.result.baseVal = \"shadow\";\n\t\t\t}\n\n\t\t\t// Merge the main text, outline and shadow\n\t\t\tconst mergedResult = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMerge\");\n\t\t\tfilterElement.appendChild(mergedResult);\n\n\t\t\tif (shadowDepthX > 0 || shadowDepthY > 0) {\n\t\t\t\tconst shadowReferenceNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMergeNode\");\n\t\t\t\tmergedResult.appendChild(shadowReferenceNode);\n\t\t\t\tshadowReferenceNode.in1.baseVal = \"shadow\";\n\t\t\t}\n\n\t\t\tconst outlineReferenceNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMergeNode\");\n\t\t\tmergedResult.appendChild(outlineReferenceNode);\n\t\t\toutlineReferenceNode.in1.baseVal = \"outline-colored\";\n\n\t\t\tconst sourceGraphicReferenceNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMergeNode\");\n\t\t\tmergedResult.appendChild(sourceGraphicReferenceNode);\n\t\t\tsourceGraphicReferenceNode.in1.baseVal = \"SourceGraphic\";\n\t\t}\n\t\telse {\n\t\t\t// Blur the source graphic directly\n\t\t\tif (this._gaussianBlur > 0) {\n\t\t\t\tconst gaussianBlurFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feGaussianBlur\");\n\t\t\t\tfilterElement.appendChild(gaussianBlurFilter);\n\n\t\t\t\t// Don't use setStdDeviation - cloneNode() clears it in Chrome\n\t\t\t\tgaussianBlurFilter.stdDeviationX.baseVal = this._gaussianBlur;\n\t\t\t\tgaussianBlurFilter.stdDeviationY.baseVal = this._gaussianBlur;\n\t\t\t}\n\t\t\tfor (let i = 0; i < this._blur; i++) {\n\t\t\t\tconst blurFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feConvolveMatrix\");\n\t\t\t\tfilterElement.appendChild(blurFilter);\n\t\t\t\tblurFilter.setAttribute(\"kernelMatrix\", \"1 2 1 2 4 2 1 2 1\");\n\t\t\t\tblurFilter.edgeMode.baseVal = SVGFEConvolveMatrixElement.SVG_EDGEMODE_NONE;\n\t\t\t}\n\t\t}\n\n\t\tif (filterElement.childElementCount > 0) {\n\t\t\tconst filterId = `libjass-svg-filter-${ this._id }-${ this._nextFilterId++ }`;\n\n\t\t\tthis._svgDefsElement.appendChild(filterElement);\n\t\t\tfilterElement.id = filterId;\n\t\t\tfilterElement.x.baseVal.valueAsString = \"-50%\";\n\t\t\tfilterElement.width.baseVal.valueAsString = \"200%\";\n\t\t\tfilterElement.y.baseVal.valueAsString = \"-50%\";\n\t\t\tfilterElement.height.baseVal.valueAsString = \"200%\";\n\n\t\t\tconst filterProperty = `url(\"#${ filterId }\")`;\n\t\t\tspan.style.webkitFilter = filterProperty;\n\t\t\tspan.style.filter = filterProperty;\n\t\t}\n\t}\n\n\t/**\n\t * @param {!HTMLSpanElement} span\n\t * @param {number} outlineWidth\n\t * @param {number} outlineHeight\n\t * @param {!libjass.parts.Color} outlineColor\n\t * @param {number} shadowDepthX\n\t * @param {number} shadowDepthY\n\t * @param {!libjass.parts.Color} shadowColor\n\t */\n\tprivate _textShadow(\n\t\tspan: HTMLSpanElement,\n\t\toutlineWidth: number, outlineHeight: number, outlineColor: Color,\n\t\tshadowDepthX: number, shadowDepthY: number, shadowColor: Color\n\t): void {\n\t\tif (outlineWidth > 0 || outlineHeight > 0) {\n\t\t\tlet outlineCssString = \"\";\n\t\t\tlet shadowCssString = \"\";\n\n\t\t\t((addOutline: (x: number, y: number) => void) => {\n\t\t\t\tfor (let x = 0; x <= outlineWidth; x++) {\n\t\t\t\t\tconst maxY = (outlineWidth === 0) ? outlineHeight : outlineHeight * Math.sqrt(1 - ((x * x) / (outlineWidth * outlineWidth)));\n\t\t\t\t\tfor (let y = 0; y <= maxY; y++) {\n\t\t\t\t\t\taddOutline(x, y);\n\n\t\t\t\t\t\tif (x !== 0) {\n\t\t\t\t\t\t\taddOutline(-x, y);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (y !== 0) {\n\t\t\t\t\t\t\taddOutline(x, -y);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (x !== 0 && y !== 0) {\n\t\t\t\t\t\t\taddOutline(-x, -y);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ((outlineWidth % 1) > 0) {\n\t\t\t\t\taddOutline(outlineWidth, 0);\n\t\t\t\t\taddOutline(-outlineWidth, 0);\n\t\t\t\t}\n\n\t\t\t\tif ((outlineHeight % 1) > 0) {\n\t\t\t\t\taddOutline(0, outlineHeight);\n\t\t\t\t\taddOutline(0, -outlineHeight);\n\t\t\t\t}\n\t\t\t})((x: number, y: number): void => {\n\t\t\t\toutlineCssString += `, ${ outlineColor.toString() } ${ x.toFixed(3) }px ${ y.toFixed(3) }px ${ this._gaussianBlur.toFixed(3) }px`;\n\n\t\t\t\tif (this._shadowDepthX !== 0 || this._shadowDepthY !== 0) {\n\t\t\t\t\tshadowCssString += `, ${ shadowColor.toString() } ${ (x + shadowDepthX).toFixed(3) }px ${ (y + shadowDepthY).toFixed(3) }px ${ this._gaussianBlur.toFixed(3) }px`;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tspan.style.textShadow = (outlineCssString + shadowCssString).substr(\", \".length);\n\t\t}\n\t\telse if (this._shadowDepthX !== 0 || this._shadowDepthY !== 0) {\n\t\t\tconst shadowCssString = `${ shadowColor.toString() } ${ shadowDepthX.toFixed(3) }px ${ shadowDepthY.toFixed(3) }px 0px`;\n\t\t\tif (span.style.textShadow === \"\") {\n\t\t\t\tspan.style.textShadow = shadowCssString;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tspan.style.textShadow += \", \" + shadowCssString;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Sets the italic property. null defaults it to the default style's value.\n\t *\n\t * @type {?boolean}\n\t */\n\tset italic(value: boolean) {\n\t\tthis._italic = valueOrDefault(value, this._defaultStyle.italic);\n\t}\n\n\t/**\n\t * Sets the bold property. null defaults it to the default style's value.\n\t *\n\t * @type {(?boolean|?number)}\n\t */\n\tset bold(value: boolean | number | null) {\n\t\tthis._bold = valueOrDefault(value, this._defaultStyle.bold);\n\t}\n\n\t/**\n\t * Sets the underline property. null defaults it to the default style's value.\n\t *\n\t * @type {?boolean}\n\t */\n\tset underline(value: boolean) {\n\t\tthis._underline = valueOrDefault(value, this._defaultStyle.underline);\n\t}\n\n\t/**\n\t * Sets the strike-through property. null defaults it to the default style's value.\n\t *\n\t * @type {?boolean}\n\t */\n\tset strikeThrough(value: boolean) {\n\t\tthis._strikeThrough = valueOrDefault(value, this._defaultStyle.strikeThrough);\n\t}\n\n\t/**\n\t * Gets the outline width property.\n\t *\n\t * @type {number}\n\t */\n\tget outlineWidth(): number {\n\t\treturn this._outlineWidth;\n\t}\n\n\t/**\n\t * Sets the outline width property. null defaults it to the style's original outline width value.\n\t *\n\t * @type {?number}\n\t */\n\tset outlineWidth(value: number) {\n\t\tthis._outlineWidth = valueOrDefault(value, this._defaultStyle.outlineThickness);\n\t}\n\n\t/**\n\t * Gets the outline height property.\n\t *\n\t * @type {number}\n\t */\n\tget outlineHeight(): number {\n\t\treturn this._outlineHeight;\n\t}\n\n\t/**\n\t * Sets the outline height property. null defaults it to the style's original outline height value.\n\t *\n\t * @type {?number}\n\t */\n\tset outlineHeight(value: number) {\n\t\tthis._outlineHeight = valueOrDefault(value, this._defaultStyle.outlineThickness);\n\t}\n\n\t/**\n\t * Gets the shadow width property.\n\t *\n\t * @type {number}\n\t */\n\tget shadowDepthX(): number {\n\t\treturn this._shadowDepthX;\n\t}\n\n\t/**\n\t * Sets the shadow width property. null defaults it to the style's original shadow depth value.\n\t *\n\t * @type {?number}\n\t */\n\tset shadowDepthX(value: number) {\n\t\tthis._shadowDepthX = valueOrDefault(value, this._defaultStyle.shadowDepth);\n\t}\n\n\t/**\n\t * Gets the shadow height property.\n\t *\n\t * @type {number}\n\t */\n\tget shadowDepthY(): number {\n\t\treturn this._shadowDepthY;\n\t}\n\n\t/**\n\t * Sets the shadow height property. null defaults it to the style's original shadow depth value.\n\t *\n\t * @type {?number}\n\t */\n\tset shadowDepthY(value: number) {\n\t\tthis._shadowDepthY = valueOrDefault(value, this._defaultStyle.shadowDepth);\n\t}\n\n\t/**\n\t * Gets the blur property.\n\t *\n\t * @type {number}\n\t */\n\tget blur(): number {\n\t\treturn this._blur;\n\t}\n\n\t/**\n\t * Sets the blur property. null defaults it to 0.\n\t *\n\t * @type {?number}\n\t */\n\tset blur(value: number) {\n\t\tthis._blur = valueOrDefault<number>(value, 0);\n\t}\n\n\t/**\n\t * Gets the Gaussian blur property.\n\t *\n\t * @type {number}\n\t */\n\tget gaussianBlur(): number {\n\t\treturn this._gaussianBlur;\n\t}\n\n\t/**\n\t * Sets the Gaussian blur property. null defaults it to 0.\n\t *\n\t * @type {?number}\n\t */\n\tset gaussianBlur(value: number) {\n\t\tthis._gaussianBlur = valueOrDefault<number>(value, 0);\n\t}\n\n\t/**\n\t * Sets the font name property. null defaults it to the default style's value.\n\t *\n\t * @type {?string}\n\t */\n\tset fontName(value: string | null) {\n\t\tthis._fontName = valueOrDefault(value, this._defaultStyle.fontName);\n\t}\n\n\t/**\n\t * Gets the font size property.\n\t *\n\t * @type {number}\n\t */\n\tget fontSize(): number {\n\t\treturn this._fontSize;\n\t}\n\n\t/**\n\t * Sets the font size property. null defaults it to the default style's value.\n\t *\n\t * @type {?number}\n\t */\n\tset fontSize(value: number) {\n\t\tthis._fontSize = valueOrDefault(value, this._defaultStyle.fontSize);\n\t}\n\n\t/**\n\t * Gets the horizontal font scaling property.\n\t *\n\t * @type {number}\n\t */\n\tget fontScaleX(): number {\n\t\treturn this._fontScaleX;\n\t}\n\n\t/**\n\t * Sets the horizontal font scaling property. null defaults it to the default style's value.\n\t *\n\t * @type {?number}\n\t */\n\tset fontScaleX(value: number) {\n\t\tthis._fontScaleX = valueOrDefault(value, this._defaultStyle.fontScaleX);\n\t}\n\n\t/**\n\t * Gets the vertical font scaling property.\n\t *\n\t * @type {number}\n\t */\n\tget fontScaleY(): number {\n\t\treturn this._fontScaleY;\n\t}\n\n\t/**\n\t * Sets the vertical font scaling property. null defaults it to the default style's value.\n\t *\n\t * @type {?number}\n\t */\n\tset fontScaleY(value: number) {\n\t\tthis._fontScaleY = valueOrDefault(value, this._defaultStyle.fontScaleY);\n\t}\n\n\t/**\n\t * Gets the letter spacing property.\n\t *\n\t * @type {number}\n\t */\n\tget letterSpacing(): number {\n\t\treturn this._letterSpacing;\n\t}\n\n\t/**\n\t * Sets the letter spacing property. null defaults it to the default style's value.\n\t *\n\t * @type {?number}\n\t */\n\tset letterSpacing(value: number) {\n\t\tthis._letterSpacing = valueOrDefault(value, this._defaultStyle.letterSpacing);\n\t}\n\n\t/**\n\t * Gets the X-axis rotation property.\n\t *\n\t * @type {number}\n\t */\n\tget rotationX(): number {\n\t\treturn this._rotationX;\n\t}\n\n\t/**\n\t * Sets the X-axis rotation property.\n\t *\n\t * @type {?number}\n\t */\n\tset rotationX(value: number) {\n\t\tthis._rotationX = valueOrDefault<number>(value, 0);\n\t}\n\n\t/**\n\t * Gets the Y-axis rotation property.\n\t *\n\t * @type {number}\n\t */\n\tget rotationY(): number {\n\t\treturn this._rotationY;\n\t}\n\n\t/**\n\t * Sets the Y-axis rotation property.\n\t *\n\t * @type {?number}\n\t */\n\tset rotationY(value: number) {\n\t\tthis._rotationY = valueOrDefault<number>(value, 0);\n\t}\n\n\t/**\n\t * Gets the Z-axis rotation property.\n\t *\n\t * @type {number}\n\t */\n\tget rotationZ(): number {\n\t\treturn this._rotationZ;\n\t}\n\n\t/**\n\t * Sets the Z-axis rotation property.\n\t *\n\t * @type {?number}\n\t */\n\tset rotationZ(value: number) {\n\t\tthis._rotationZ = valueOrDefault(value, this._defaultStyle.rotationZ);\n\t}\n\n\t/**\n\t * Gets the X-axis skew property.\n\t *\n\t * @type {number}\n\t */\n\tget skewX(): number {\n\t\treturn this._skewX;\n\t}\n\n\t/**\n\t * Sets the X-axis skew property.\n\t *\n\t * @type {?number}\n\t */\n\tset skewX(value: number) {\n\t\tthis._skewX = valueOrDefault<number>(value, 0);\n\t}\n\n\t/**\n\t * Gets the Y-axis skew property.\n\t *\n\t * @type {number}\n\t */\n\tget skewY(): number {\n\t\treturn this._skewY;\n\t}\n\n\t/**\n\t * Sets the Y-axis skew property.\n\t *\n\t * @type {?number}\n\t */\n\tset skewY(value: number) {\n\t\tthis._skewY = valueOrDefault<number>(value, 0);\n\t}\n\n\t/**\n\t * Gets the primary color property.\n\t *\n\t * @type {!libjass.Color}\n\t */\n\tget primaryColor(): Color {\n\t\treturn this._primaryColor;\n\t}\n\n\t/**\n\t * Sets the primary color property. null defaults it to the default style's value.\n\t *\n\t * @type {libjass.Color}\n\t */\n\tset primaryColor(value: Color) {\n\t\tthis._primaryColor = valueOrDefault(value, this._defaultStyle.primaryColor);\n\t}\n\n\t/**\n\t * Gets the secondary color property.\n\t *\n\t * @type {!libjass.Color}\n\t */\n\tget secondaryColor(): Color {\n\t\treturn this._secondaryColor;\n\t}\n\n\t/**\n\t * Sets the secondary color property. null defaults it to the default style's value.\n\t *\n\t * @type {libjass.Color}\n\t */\n\tset secondaryColor(value: Color) {\n\t\tthis._secondaryColor = valueOrDefault(value, this._defaultStyle.secondaryColor);\n\t}\n\n\t/**\n\t * Gets the outline color property.\n\t *\n\t * @type {!libjass.Color}\n\t */\n\tget outlineColor(): Color {\n\t\treturn this._outlineColor;\n\t}\n\n\t/**\n\t * Sets the outline color property. null defaults it to the default style's value.\n\t *\n\t * @type {libjass.Color}\n\t */\n\tset outlineColor(value: Color) {\n\t\tthis._outlineColor = valueOrDefault(value, this._defaultStyle.outlineColor);\n\t}\n\n\t/**\n\t * Gets the shadow color property.\n\t *\n\t * @type {!libjass.Color}\n\t */\n\tget shadowColor(): Color {\n\t\treturn this._shadowColor;\n\t}\n\n\t/**\n\t * Sets the shadow color property. null defaults it to the default style's value.\n\t *\n\t * @type {libjass.Color}\n\t */\n\tset shadowColor(value: Color) {\n\t\tthis._shadowColor = valueOrDefault(value, this._defaultStyle.shadowColor);\n\t}\n\n\t/**\n\t * Gets the primary alpha property.\n\t *\n\t * @type {number}\n\t */\n\tget primaryAlpha(): number {\n\t\treturn this._primaryAlpha;\n\t}\n\n\t/**\n\t * Sets the primary alpha property.\n\t *\n\t * @type {?number}\n\t */\n\tset primaryAlpha(value: number) {\n\t\tthis._primaryAlpha = valueOrDefault(value, this._defaultStyle.primaryColor.alpha);\n\t}\n\n\t/**\n\t * Gets the secondary alpha property.\n\t *\n\t * @type {number}\n\t */\n\tget secondaryAlpha(): number {\n\t\treturn this._secondaryAlpha;\n\t}\n\n\t/**\n\t * Sets the secondary alpha property.\n\t *\n\t * @type {?number}\n\t */\n\tset secondaryAlpha(value: number) {\n\t\tthis._secondaryAlpha = valueOrDefault(value, this._defaultStyle.secondaryColor.alpha);\n\t}\n\n\t/**\n\t * Gets the outline alpha property.\n\t *\n\t * @type {number}\n\t */\n\tget outlineAlpha(): number {\n\t\treturn this._outlineAlpha;\n\t}\n\n\t/**\n\t * Sets the outline alpha property.\n\t *\n\t * @type {?number}\n\t */\n\tset outlineAlpha(value: number) {\n\t\tthis._outlineAlpha = valueOrDefault(value, this._defaultStyle.outlineColor.alpha);\n\t}\n\n\t/**\n\t * Gets the shadow alpha property.\n\t *\n\t * @type {number}\n\t */\n\tget shadowAlpha(): number {\n\t\treturn this._shadowAlpha;\n\t}\n\n\t/**\n\t * Sets the shadow alpha property.\n\t *\n\t * @type {?number}\n\t */\n\tset shadowAlpha(value: number) {\n\t\tthis._shadowAlpha = valueOrDefault(value, this._defaultStyle.shadowColor.alpha);\n\t}\n}\n\n/**\n * @param {!libjass.parts.Color} color\n * @return {!SVGFEComponentTransferElement}\n */\nfunction createComponentTransferFilter(color: Color): SVGFEComponentTransferElement {\n\tconst result = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feComponentTransfer\");\n\n\tconst redTransferNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feFuncR\");\n\tresult.appendChild(redTransferNode);\n\tredTransferNode.type.baseVal = SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR;\n\tredTransferNode.slope.baseVal = 0;\n\tredTransferNode.intercept.baseVal = color.red / 255;\n\n\tconst greenTransferNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feFuncG\");\n\tresult.appendChild(greenTransferNode);\n\tgreenTransferNode.type.baseVal = SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR;\n\tgreenTransferNode.slope.baseVal = 0;\n\tgreenTransferNode.intercept.baseVal = color.green / 255;\n\n\tconst blueTransferNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feFuncB\");\n\tresult.appendChild(blueTransferNode);\n\tblueTransferNode.type.baseVal = SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR;\n\tblueTransferNode.slope.baseVal = 0;\n\tblueTransferNode.intercept.baseVal = color.blue / 255;\n\n\tconst alphaTransferNode = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feFuncA\");\n\tresult.appendChild(alphaTransferNode);\n\talphaTransferNode.type.baseVal = SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR;\n\talphaTransferNode.slope.baseVal = color.alpha;\n\talphaTransferNode.intercept.baseVal = 0;\n\n\treturn result;\n}\n\n/**\n * @param {?T} newValue\n * @param {!T} defaultValue\n * @return {!T}\n */\nfunction valueOrDefault<T>(newValue: T | null, defaultValue: T): T {\n\treturn ((newValue !== null) ? newValue : defaultValue);\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Map } from \"../../utility/map\";\nimport { Promise } from \"../../utility/promise\";\n\n/**\n * @param {string} fontFamily\n * @param {number} fontSize\n * @param {string} fallbackFonts\n * @param {!HTMLDivElement} fontSizeElement\n */\nfunction prepareFontSizeElement(fontFamily: string, fontSize: number, fallbackFonts: string, fontSizeElement: HTMLDivElement): void {\n\tlet fonts = `\"${ fontFamily }\"`;\n\tif (fallbackFonts !== \"\") {\n\t\tfonts += `, ${ fallbackFonts }`;\n\t}\n\n\tfontSizeElement.style.fontFamily = fonts;\n\tfontSizeElement.style.fontSize = `${ fontSize }px`;\n}\n\n/**\n * @param {string} fontFamily\n * @param {number} fontSize\n * @param {string} fallbackFonts\n * @param {!HTMLDivElement} fontSizeElement\n * @return {!Promise.<number>}\n */\nfunction lineHeightForFontSize(fontFamily: string, fontSize: number, fallbackFonts: string, fontSizeElement: HTMLDivElement): Promise<number> {\n\tprepareFontSizeElement(fontFamily, fontSize, fallbackFonts, fontSizeElement);\n\n\treturn new Promise(resolve => setTimeout(() => resolve(fontSizeElement.offsetHeight), 1000));\n}\n\n/**\n * @param {string} fontFamily\n * @param {number} fontSize\n * @param {string} fallbackFonts\n * @param {!HTMLDivElement} fontSizeElement\n * @return {number}\n */\nfunction lineHeightForFontSizeSync(fontFamily: string, fontSize: number, fallbackFonts: string, fontSizeElement: HTMLDivElement): number {\n\tprepareFontSizeElement(fontFamily, fontSize, fallbackFonts, fontSizeElement);\n\n\treturn fontSizeElement.offsetHeight;\n}\n\n/**\n * @param {number} lowerLineHeight\n * @param {number} upperLineHeight\n * @return {[number, number]}\n */\nfunction fontMetricsFromLineHeights(lowerLineHeight: number, upperLineHeight: number): [number, number] {\n\treturn [lowerLineHeight, (360 - 180) / (upperLineHeight - lowerLineHeight)];\n}\n\n/**\n * Calculates font metrics for the given font family.\n *\n * @param {string} fontFamily\n * @param {string} fallbackFonts\n * @param {!HTMLDivElement} fontSizeElement\n * @return {!Promise.<[number, number]>}\n */\nexport function calculateFontMetrics(fontFamily: string, fallbackFonts: string, fontSizeElement: HTMLDivElement): Promise<[number, number]> {\n\treturn lineHeightForFontSize(fontFamily, 180, fallbackFonts, fontSizeElement).then(lowerLineHeight =>\n\t\tlineHeightForFontSize(fontFamily, 360, fallbackFonts, fontSizeElement).then(upperLineHeight =>\n\t\t\tfontMetricsFromLineHeights(lowerLineHeight, upperLineHeight)\n\t\t)\n\t);\n}\n\n/**\n * @param {number} lineHeight\n * @param {number} lowerLineHeight\n * @param {number} factor\n * @return {number}\n */\nfunction fontSizeFromMetrics(lineHeight: number, lowerLineHeight: number, factor: number): number {\n\treturn 180 + (lineHeight - lowerLineHeight) * factor;\n}\n\n/**\n * Uses linear interpolation to calculate the CSS font size that would give the specified line height for the specified font family.\n *\n * WARNING: If fontMetricsCache doesn't already contain a cached value for this font family, and it is not a font already installed on the user's device, then this function\n * may return wrong values. To avoid this, make sure to preload the font using the {@link libjass.renderers.RendererSettings.fontMap} property when constructing the renderer.\n *\n * @param {string} fontFamily\n * @param {number} lineHeight\n * @param {string} fallbackFonts\n * @param {!HTMLDivElement} fontSizeElement\n * @param {!Map.<string, [number, number]>} fontMetricsCache\n * @return {number}\n */\nexport function fontSizeForLineHeight(fontFamily: string, lineHeight: number, fallbackFonts: string, fontSizeElement: HTMLDivElement, fontMetricsCache: Map<string, [number, number]>): number {\n\tlet existingMetrics = fontMetricsCache.get(fontFamily);\n\tif (existingMetrics === undefined) {\n\t\tconst lowerLineHeight = lineHeightForFontSizeSync(fontFamily, 180, fallbackFonts, fontSizeElement);\n\t\tconst upperLineHeight = lineHeightForFontSizeSync(fontFamily, 360, fallbackFonts, fontSizeElement);\n\t\tfontMetricsCache.set(fontFamily, existingMetrics = fontMetricsFromLineHeights(lowerLineHeight, upperLineHeight));\n\t}\n\n\tconst [lowerLineHeight, factor] = existingMetrics;\n\treturn fontSizeFromMetrics(lineHeight, lowerLineHeight, factor);\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as parts from \"../../parts\";\n\n/**\n * This class represents an ASS drawing - a set of drawing instructions between {\\p} tags.\n *\n * @param {number} outputScaleX\n * @param {number} outputScaleY\n */\nexport class DrawingStyles {\n\tprivate _scale: number = 1;\n\tprivate _baselineOffset: number = 0;\n\n\tconstructor(private _outputScaleX: number, private _outputScaleY: number) { }\n\n\t/**\n\t * @type {number}\n\t */\n\tset scale(value: number) {\n\t\tthis._scale = value;\n\t}\n\n\t/**\n\t * @type {number}\n\t */\n\tset baselineOffset(value: number) {\n\t\tthis._baselineOffset = value;\n\t}\n\n\t/**\n\t * Converts this drawing to an <svg> element.\n\t *\n\t * @param {!libjass.parts.DrawingInstructions} drawingInstructions\n\t * @param {!libjass.parts.Color} fillColor\n\t * @return {!SVGSVGElement}\n\t */\n\ttoSVG(drawingInstructions: parts.DrawingInstructions, fillColor: parts.Color): SVGSVGElement {\n\t\tconst svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n\t\tsvg.setAttribute(\"version\", \"1.1\");\n\n\t\tif (drawingInstructions.instructions.length === 0) {\n\t\t\treturn svg;\n\t\t}\n\n\t\tconst scaleFactor = Math.pow(2, this._scale - 1);\n\t\tconst scaleX = this._outputScaleX / scaleFactor;\n\t\tconst scaleY = this._outputScaleY / scaleFactor;\n\n\t\tconst path = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n\t\tlet pathString = \"\";\n\n\t\tlet bboxMinX = Infinity;\n\t\tlet bboxMaxX = -Infinity;\n\t\tlet bboxMinY = Infinity;\n\t\tlet bboxMaxY = -Infinity;\n\n\t\tfor (const instruction of drawingInstructions.instructions) {\n\t\t\tif (instruction instanceof parts.drawing.MoveInstruction) {\n\t\t\t\tpathString += ` M ${ instruction.x.toFixed(3) } ${ (instruction.y + this._baselineOffset).toFixed(3) }`;\n\n\t\t\t\tbboxMinX = Math.min(bboxMinX, instruction.x);\n\t\t\t\tbboxMaxX = Math.max(bboxMaxX, instruction.x);\n\t\t\t\tbboxMinY = Math.min(bboxMinY, instruction.y + this._baselineOffset);\n\t\t\t\tbboxMaxY = Math.max(bboxMaxY, instruction.y + this._baselineOffset);\n\t\t\t}\n\t\t\telse if (instruction instanceof parts.drawing.LineInstruction) {\n\t\t\t\tpathString += ` L ${ instruction.x.toFixed(3) } ${ (instruction.y + this._baselineOffset).toFixed(3) }`;\n\n\t\t\t\tbboxMinX = Math.min(bboxMinX, instruction.x);\n\t\t\t\tbboxMaxX = Math.max(bboxMaxX, instruction.x);\n\t\t\t\tbboxMinY = Math.min(bboxMinY, instruction.y + this._baselineOffset);\n\t\t\t\tbboxMaxY = Math.max(bboxMaxY, instruction.y + this._baselineOffset);\n\t\t\t}\n\t\t\telse if (instruction instanceof parts.drawing.CubicBezierCurveInstruction) {\n\t\t\t\tpathString += ` C ${ instruction.x1.toFixed(3) } ${ (instruction.y1 + this._baselineOffset).toFixed(3) } ${ instruction.x2.toFixed(3) } ${ (instruction.y2 + this._baselineOffset).toFixed(3) } ${ instruction.x3.toFixed(3) } ${ (instruction.y3 + this._baselineOffset).toFixed(3) }`;\n\n\t\t\t\tbboxMinX = Math.min(bboxMinX, instruction.x1, instruction.x2, instruction.x3);\n\t\t\t\tbboxMaxX = Math.max(bboxMaxX, instruction.x1, instruction.x2, instruction.x3);\n\t\t\t\tbboxMinY = Math.min(bboxMinY, instruction.y1 + this._baselineOffset, instruction.y2 + this._baselineOffset, instruction.y3 + this._baselineOffset);\n\t\t\t\tbboxMaxY = Math.max(bboxMaxY, instruction.y1 + this._baselineOffset, instruction.y2 + this._baselineOffset, instruction.y3 + this._baselineOffset);\n\t\t\t}\n\t\t}\n\n\t\tbboxMinX *= scaleX;\n\t\tbboxMaxX *= scaleX;\n\t\tbboxMinY *= scaleY;\n\t\tbboxMaxY *= scaleY;\n\n\t\tconst bboxWidth = bboxMaxX - bboxMinX;\n\t\tconst bboxHeight = bboxMaxY - bboxMinY;\n\n\t\tsvg.width.baseVal.valueAsString = `${ bboxWidth.toFixed(3) }px`;\n\t\tsvg.height.baseVal.valueAsString = `${ bboxHeight.toFixed(3) }px`;\n\n\t\t// svg.viewBox.baseVal is null in atleast FF. See https://bugzilla.mozilla.org/show_bug.cgi?id=888307 which justifies it with SVG 1.2 spec.\n\t\tsvg.setAttribute(\"viewBox\", `${ bboxMinX } ${ bboxMinY } ${ bboxWidth } ${ bboxHeight }`);\n\n\t\tsvg.style.position = \"relative\";\n\t\tsvg.style.left = `${ bboxMinX.toFixed(3) }px`;\n\t\tsvg.style.top = `${ bboxMinY.toFixed(3) }px`;\n\n\t\tconst g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n\t\tsvg.appendChild(g);\n\t\tg.setAttribute(\"transform\", `scale(${ scaleX.toFixed(3) } ${ scaleY.toFixed(3) })`);\n\n\t\tg.appendChild(path);\n\t\tpath.setAttribute(\"d\", pathString);\n\t\tpath.setAttribute(\"fill\", fillColor.toString());\n\n\t\treturn svg;\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Keyframe } from \"./keyframe\";\n\nimport { NullRenderer } from \"../null\";\n\nimport { Map } from \"../../utility/map\";\n\n/**\n * This class represents a collection of animations. Each animation contains one or more keyframes.\n * The collection can then be converted to a CSS3 representation.\n *\n * @param {!libjass.renderers.NullRenderer} renderer The renderer that this collection is associated with\n * @param {!HTMLStyleElement} style A <style> element to insert the animation rules into\n */\nexport class AnimationCollection {\n\tprivate static _nextId: number = 0;\n\n\tprivate _id: string;\n\tprivate _rate: number;\n\n\tprivate _animationStyle: string = \"\";\n\tprivate _animationDelays: Map<string, number> = new Map<string, number>();\n\tprivate _numAnimations: number = 0;\n\n\tconstructor(renderer: NullRenderer, private _style: HTMLStyleElement) {\n\t\tthis._id = `${ renderer.id }-${ AnimationCollection._nextId++ }`;\n\t\tthis._rate = renderer.clock.rate;\n\t}\n\n\t/**\n\t * This string should be set as the \"animation\" CSS property of the target element.\n\t *\n\t * @type {string}\n\t */\n\tget animationStyle(): string {\n\t\treturn this._animationStyle;\n\t}\n\n\t/**\n\t * This array should be used to set the \"animation-delay\" CSS property of the target element.\n\t *\n\t * @type {!Array.<number>}\n\t */\n\tget animationDelays(): Map<string, number> {\n\t\treturn this._animationDelays;\n\t}\n\n\t/**\n\t * Add an animation to this collection. The given keyframes together make one animation.\n\t *\n\t * @param {string} timingFunction One of the acceptable values for the \"animation-timing-function\" CSS property\n\t * @param {!Array.<!libjass.renderers.Keyframe>} keyframes\n\t */\n\tadd(timingFunction: string, keyframes: Keyframe[]): void {\n\t\tlet start: number | null = null;\n\t\tlet end: number | null = null;\n\n\t\tfor (const keyframe of keyframes) {\n\t\t\tif (start === null) {\n\t\t\t\tstart = keyframe.time;\n\t\t\t}\n\n\t\t\tend = keyframe.time;\n\t\t}\n\n\t\tif (start === null || end === null) {\n\t\t\tthrow new Error(\"Atleast one keyframe must be provided.\");\n\t\t}\n\n\t\tlet ruleCssText = \"\";\n\n\t\tfor (const keyframe of keyframes) {\n\t\t\truleCssText +=\n`\t${ (100 * ((end - start === 0) ? 1 : ((keyframe.time - start) / (end - start)))).toFixed(3) }% {\n`;\n\n\t\t\tkeyframe.properties.forEach((value, name) => {\n\t\t\t\truleCssText +=\n`\t\t${ name }: ${ value };\n`;\n\t\t\t});\n\n\t\t\truleCssText +=\n`\t}\n`;\n\t\t}\n\n\t\tconst animationName = `animation-${ this._id }-${ this._numAnimations++ }`;\n\n\t\tthis._style.appendChild(document.createTextNode(\n`@-webkit-keyframes ${ animationName } {\n${ ruleCssText }\n}`));\n\n\t\tthis._style.appendChild(document.createTextNode(\n`@keyframes ${ animationName } {\n${ ruleCssText }\n}`));\n\n\t\tif (this._animationStyle !== \"\") {\n\t\t\tthis._animationStyle += \",\";\n\t\t}\n\n\t\tthis._animationStyle += `${ animationName } ${ ((end - start) / this._rate).toFixed(3) }s ${ timingFunction }`;\n\t\tthis._animationDelays.set(animationName, start);\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Map } from \"../../utility/map\";\n\n/**\n * This class represents a single keyframe. It has a list of CSS properties (names and values) associated with a point in time. Multiple keyframes make up an animation.\n *\n * @param {number} time\n * @param {!Map.<string, string>} properties\n */\nexport class Keyframe {\n\tconstructor(private _time: number, private _properties: Map<string, string>) { }\n\n\t/**\n\t * @type {number}\n\t */\n\tget time(): number {\n\t\treturn this._time;\n\t}\n\n\t/**\n\t * @type {!Map.<string, string>}\n\t */\n\tget properties(): Map<string, string> {\n\t\treturn this._properties;\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { debugMode, verboseMode } from \"../settings\";\n\nimport { ASS } from \"../types/ass\";\nimport { Dialogue } from \"../types/dialogue\";\n\nimport { Clock, ClockEvent } from \"./clocks/base\";\n\nimport { RendererSettings } from \"./settings\";\n\n/**\n * A renderer implementation that doesn't output anything.\n *\n * @param {!libjass.ASS} ass\n * @param {!libjass.renderers.Clock} clock\n * @param {libjass.renderers.RendererSettings} settings\n */\nexport class NullRenderer {\n\tprivate static _lastRendererId: number = -1;\n\n\tprivate _id: number;\n\n\tprivate _settings: RendererSettings;\n\n\tconstructor(private _ass: ASS, private _clock: Clock, settings?: RendererSettings) {\n\t\tthis._id = ++NullRenderer._lastRendererId;\n\n\t\tthis._settings = RendererSettings.from(settings);\n\n\t\tthis._clock.addEventListener(ClockEvent.Play, () => this._onClockPlay());\n\t\tthis._clock.addEventListener(ClockEvent.Tick, () => this._onClockTick());\n\t\tthis._clock.addEventListener(ClockEvent.Pause, () => this._onClockPause());\n\t\tthis._clock.addEventListener(ClockEvent.Stop, () => this._onClockStop());\n\t\tthis._clock.addEventListener(ClockEvent.RateChange, () => this._onClockRateChange());\n\t}\n\n\t/**\n\t * The unique ID of this renderer. Auto-generated.\n\t *\n\t * @type {number}\n\t */\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\t/**\n\t * @type {!libjass.ASS}\n\t */\n\tget ass(): ASS {\n\t\treturn this._ass;\n\t}\n\n\t/**\n\t * @type {!libjass.renderers.Clock}\n\t */\n\tget clock(): Clock {\n\t\treturn this._clock;\n\t}\n\n\t/**\n\t * @type {!libjass.renderers.RendererSettings}\n\t */\n\tget settings(): RendererSettings {\n\t\treturn this._settings;\n\t}\n\n\t/**\n\t * Pre-render a dialogue. This is a no-op for this type.\n\t *\n\t * @param {!libjass.Dialogue} dialogue\n\t */\n\tpreRender(dialogue: Dialogue): void { }\n\n\t/**\n\t * Draw a dialogue. This is a no-op for this type.\n\t *\n\t * @param {!libjass.Dialogue} dialogue\n\t */\n\tdraw(dialogue: Dialogue): void { }\n\n\t/**\n\t * Enable the renderer.\n\t *\n\t * @return {boolean} True if the renderer is now enabled, false if it was already enabled.\n\t */\n\tenable(): boolean {\n\t\treturn this._clock.enable();\n\t}\n\n\t/**\n\t * Disable the renderer.\n\t *\n\t * @return {boolean} True if the renderer is now disabled, false if it was already disabled.\n\t */\n\tdisable(): boolean {\n\t\treturn this._clock.disable();\n\t}\n\n\t/**\n\t * Toggle the renderer.\n\t */\n\ttoggle(): void {\n\t\tthis._clock.toggle();\n\t}\n\n\t/**\n\t * Enable or disable the renderer.\n\t *\n\t * @param {boolean} enabled If true, the renderer is enabled, otherwise it's disabled.\n\t * @return {boolean} True if the renderer is now in the given state, false if it was already in that state.\n\t */\n\tsetEnabled(enabled: boolean): boolean {\n\t\treturn this._clock.setEnabled(enabled);\n\t}\n\n\t/**\n\t * @type {boolean}\n\t */\n\tget enabled(): boolean {\n\t\treturn this._clock.enabled;\n\t}\n\n\t/**\n\t * Runs when the clock is enabled, or starts playing, or is resumed from pause.\n\t */\n\tprotected _onClockPlay(): void {\n\t\tif (verboseMode) {\n\t\t\tconsole.log(\"NullRenderer._onClockPlay\");\n\t\t}\n\t}\n\n\t/**\n\t * Runs when the clock's current time changed. This might be a result of either regular playback or seeking.\n\t */\n\tprotected _onClockTick(): void {\n\t\tconst currentTime = this._clock.currentTime;\n\n\t\tif (verboseMode) {\n\t\t\tconsole.log(`NullRenderer._onClockTick: currentTime = ${ currentTime }`);\n\t\t}\n\n\t\tfor (const dialogue of this._ass.dialogues) {\n\t\t\ttry {\n\t\t\t\tif (dialogue.end > currentTime) {\n\t\t\t\t\tif (dialogue.start <= currentTime) {\n\t\t\t\t\t\t// This dialogue is visible right now. Draw it.\n\t\t\t\t\t\tthis.draw(dialogue);\n\t\t\t\t\t}\n\t\t\t\t\telse if (dialogue.start <= (currentTime + this._settings.preRenderTime)) {\n\t\t\t\t\t\t// This dialogue will be visible soon. Pre-render it.\n\t\t\t\t\t\tthis.preRender(dialogue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (ex) {\n\t\t\t\tif (debugMode) {\n\t\t\t\t\tconsole.error(`Rendering dialogue ${ dialogue.id } failed.`, ex);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Runs when the clock is paused.\n\t */\n\tprotected _onClockPause(): void {\n\t\tif (verboseMode) {\n\t\t\tconsole.log(\"NullRenderer._onClockPause\");\n\t\t}\n\t}\n\n\t/**\n\t * Runs when the clock is disabled.\n\t */\n\tprotected _onClockStop(): void {\n\t\tif (verboseMode) {\n\t\t\tconsole.log(\"NullRenderer._onClockStop\");\n\t\t}\n\t}\n\n\t/**\n\t * Runs when the clock changes its rate.\n\t */\n\tprotected _onClockRateChange(): void {\n\t\tif (verboseMode) {\n\t\t\tconsole.log(\"NullRenderer._onClockRateChange\");\n\t\t}\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Attachment } from \"../types/attachment\";\n\nimport { Map } from \"../utility/map\";\nimport { Set } from \"../utility/set\";\n\ntype DataReader = { dataView: DataView; position: number; };\n\nenum DataType {\n\tChar,\n\tUint16,\n\tUint32,\n}\n\ntype StructMemberDefinition = { type: DataType; field: string; };\n\nconst fieldDecorators = new Map<DataType, (proto: any, field: string) => void>();\n\n@struct\nclass OffsetTable {\n\t/** @type {function(!{ dataView: DataView, position: number }): OffsetTable} */\n\tstatic read: (reader: DataReader) => OffsetTable;\n\n\t/** @type {number} */ @field(DataType.Uint16) majorVersion: number;\n\t/** @type {number} */ @field(DataType.Uint16) minorVersion: number;\n\t/** @type {number} */ @field(DataType.Uint16) numTables: number;\n\t/** @type {number} */ @field(DataType.Uint16) searchRange: number;\n\t/** @type {number} */ @field(DataType.Uint16) entrySelector: number;\n\t/** @type {number} */ @field(DataType.Uint16) rangeShift: number;\n}\n\n@struct\nclass TableRecord {\n\t/** @type {function(!{ dataView: DataView, position: number }): TableRecord} */\n\tstatic read: (reader: DataReader) => TableRecord;\n\n\t/** @type {string} */ @field(DataType.Char) c1: string;\n\t/** @type {string} */ @field(DataType.Char) c2: string;\n\t/** @type {string} */ @field(DataType.Char) c3: string;\n\t/** @type {string} */ @field(DataType.Char) c4: string;\n\t/** @type {number} */ @field(DataType.Uint32) checksum: number;\n\t/** @type {number} */ @field(DataType.Uint32) offset: number;\n\t/** @type {number} */ @field(DataType.Uint32) length: number;\n}\n\n@struct\nclass NameTableHeader {\n\t/** @type {function(!{ dataView: DataView, position: number }): NameTableHeader} */\n\tstatic read: (reader: DataReader) => NameTableHeader;\n\n\t/** @type {number} */ @field(DataType.Uint16) formatSelector: number;\n\t/** @type {number} */ @field(DataType.Uint16) count: number;\n\t/** @type {number} */ @field(DataType.Uint16) stringOffset: number;\n}\n\n@struct\nclass NameRecord {\n\t/** @type {function(!{ dataView: DataView, position: number }): NameRecord} */\n\tstatic read: (reader: DataReader) => NameRecord;\n\n\t/** @type {number} */ @field(DataType.Uint16) platformId: number;\n\t/** @type {number} */ @field(DataType.Uint16) encodingId: number;\n\t/** @type {number} */ @field(DataType.Uint16) languageId: number;\n\t/** @type {number} */ @field(DataType.Uint16) nameId: number;\n\t/** @type {number} */ @field(DataType.Uint16) length: number;\n\t/** @type {number} */ @field(DataType.Uint16) offset: number;\n}\n\n/**\n * Gets all the font names from the given font attachment.\n *\n * @param {!libjass.Attachment} attachment\n * @return {!libjass.Set.<string>}\n */\nexport function getTtfNames(attachment: Attachment): Set<string> {\n\tconst decoded = atob(attachment.contents);\n\n\tconst bytes = new Uint8Array(new ArrayBuffer(decoded.length));\n\n\tfor (let i = 0; i < decoded.length; i++) {\n\t\tbytes[i] = decoded.charCodeAt(i);\n\t}\n\n\tconst reader = { dataView: new DataView(bytes.buffer), position: 0 };\n\n\tconst offsetTable = OffsetTable.read(reader);\n\tlet nameTableRecord: TableRecord | null = null;\n\tfor (let i = 0; i < offsetTable.numTables; i++) {\n\t\tconst tableRecord = TableRecord.read(reader);\n\t\tif (tableRecord.c1 + tableRecord.c2 + tableRecord.c3 + tableRecord.c4 === \"name\") {\n\t\t\tnameTableRecord = tableRecord;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (nameTableRecord === null) {\n\t\tthrow new Error('Could not find \"name\" table record.');\n\t}\n\n\treader.position = nameTableRecord.offset;\n\tconst nameTableHeader = NameTableHeader.read(reader);\n\n\tconst result = new Set<string>();\n\tfor (let i = 0; i < nameTableHeader.count; i++) {\n\t\tconst nameRecord = NameRecord.read(reader);\n\n\t\tswitch (nameRecord.nameId) {\n\t\t\tcase 1:\n\t\t\tcase 4:\n\t\t\tcase 6:\n\t\t\t\tconst recordOffset = nameTableRecord.offset + nameTableHeader.stringOffset + nameRecord.offset;\n\t\t\t\tconst nameBytes = bytes.subarray(recordOffset, recordOffset + nameRecord.length);\n\n\t\t\t\tswitch (nameRecord.platformId) {\n\t\t\t\t\tcase 1: {\n\t\t\t\t\t\tlet name = \"\";\n\n\t\t\t\t\t\tfor (let j = 0; j < nameBytes.length; j++) {\n\t\t\t\t\t\t\tname += String.fromCharCode(nameBytes[j]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult.add(name);\n\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 3: {\n\t\t\t\t\t\tlet name = \"\";\n\n\t\t\t\t\t\tfor (let j = 0; j < nameBytes.length; j += 2) {\n\t\t\t\t\t\t\tname += String.fromCharCode((nameBytes[j] << 8) + nameBytes[j + 1]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult.add(name);\n\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn result;\n}\n\n/**\n * @param {!function(new(): T)} clazz\n * @return {!function(new(): T)}\n */\nfunction struct<T>(clazz: { new (): T; read(reader: DataReader): T; }): { new (): T; read(reader: DataReader): T; } {\n\tconst fields: StructMemberDefinition[] = (clazz as any).__fields;\n\n\tclazz.read = (reader: DataReader) => {\n\t\tconst result: any = new clazz();\n\n\t\tfor (const field of fields) {\n\t\t\tlet value: any;\n\t\t\tswitch (field.type) {\n\t\t\t\tcase DataType.Char:\n\t\t\t\t\tvalue = String.fromCharCode(reader.dataView.getInt8(reader.position));\n\t\t\t\t\treader.position += 1;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase DataType.Uint16:\n\t\t\t\t\tvalue = reader.dataView.getUint16(reader.position);\n\t\t\t\t\treader.position += 2;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase DataType.Uint32:\n\t\t\t\t\tvalue = reader.dataView.getUint32(reader.position);\n\t\t\t\t\treader.position += 4;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tresult[field.field] = value;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\treturn clazz;\n}\n\n/**\n * @param {number} type\n * @return {function(T, string)}\n */\nfunction field<T>(type: DataType): (proto: T, field: string) => void {\n\tlet existingDecorator = fieldDecorators.get(type);\n\tif (existingDecorator === undefined) {\n\t\texistingDecorator = (proto: T, field: string) => {\n\t\t\tconst ctor: { __fields?: StructMemberDefinition[] } = proto.constructor;\n\t\t\tif (ctor.__fields === undefined) {\n\t\t\t\tctor.__fields = [];\n\t\t\t}\n\n\t\t\tctor.__fields.push({ type, field });\n\t\t};\n\n\t\tfieldDecorators.set(type, existingDecorator);\n\t}\n\n\treturn existingDecorator;\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { debugMode } from \"../settings\";\nimport { Map } from \"../utility/map\";\n\n/**\n * Settings for the renderer.\n */\nexport class RendererSettings {\n\t/**\n\t * A convenience method to create a font map from a <style> or <link> element that contains @font-face rules. There should be one @font-face rule for each font name, mapping to a font file URL.\n\t *\n\t * For example:\n\t *\n\t *     @font-face {\n\t *         font-family: \"Helvetica\";\n\t *         src: url(\"/fonts/helvetica.ttf\"), local(\"Arial\");\n\t *     }\n\t *\n\t * More complicated @font-face syntax like format() or multi-line src are not supported.\n\t *\n\t * @param {!LinkStyle} linkStyle\n\t * @return {!Map.<string, string>}\n\t */\n\tstatic makeFontMapFromStyleElement(linkStyle: LinkStyle): Map<string, string> {\n\t\tconst fontMap = new Map<string, string>();\n\n\t\tconst styleSheet = linkStyle.sheet as CSSStyleSheet;\n\t\tfor (let i = 0; i < styleSheet.cssRules.length; i++) {\n\t\t\tconst rule = styleSheet.cssRules[i];\n\n\t\t\tif (isFontFaceRule(rule)) {\n\t\t\t\tconst name = rule.style.getPropertyValue(\"font-family\").match(/^[\"']?(.*?)[\"']?$/)![1];\n\n\t\t\t\tlet src = rule.style.getPropertyValue(\"src\");\n\t\t\t\tif (!src) {\n\t\t\t\t\tsrc = rule.cssText.split(\"\\n\")\n\t\t\t\t\t\t.map(line => line.match(/src:\\s*([^;]+?)\\s*;/))\n\t\t\t\t\t\t.filter((matches): matches is RegExpMatchArray => matches !== null)\n\t\t\t\t\t\t.map(matches => matches[1])[0];\n\t\t\t\t}\n\n\t\t\t\tfontMap.set(name, src);\n\t\t\t}\n\t\t}\n\n\t\treturn fontMap;\n\t}\n\n\t/**\n\t * Converts an arbitrary object into a {@link libjass.renderers.RendererSettings} object.\n\t *\n\t * @param {*} object\n\t * @return {!libjass.renderers.RendererSettings}\n\t */\n\tstatic from(object?: any): RendererSettings {\n\t\tif (object === undefined || object === null) {\n\t\t\tobject = {};\n\t\t}\n\n\t\tconst {\n\t\t\tfontMap = null,\n\t\t\tpreRenderTime = 5,\n\t\t\tpreciseOutlines = false,\n\t\t\tenableSvg = testSupportsSvg(),\n\t\t\tfallbackFonts = 'Arial, Helvetica, sans-serif, \"Segoe UI Symbol\"',\n\t\t\tuseAttachedFonts = false,\n\t\t} = object as RendererSettings;\n\n\t\tconst result = new RendererSettings();\n\t\tresult.fontMap = fontMap;\n\t\tresult.preRenderTime = preRenderTime;\n\t\tresult.preciseOutlines = preciseOutlines;\n\t\tresult.enableSvg = enableSvg;\n\t\tresult.fallbackFonts = fallbackFonts;\n\t\tresult.useAttachedFonts = useAttachedFonts;\n\n\t\treturn result;\n\t}\n\n\t/**\n\t * A map of font name to one or more URLs of that font. If provided, the fonts in this map are pre-loaded by the WebRenderer when it's created.\n\t *\n\t * The key of each entry of the map is the font name used in the ASS script. There are three choices for the value:\n\t *\n\t * - A single string that you would use for the src attribute of a @font-face rule. Eg: `'url(\"/fonts.foo.ttf\"), url(\"/fonts/foo-fallback.ttf\"), local(\"Arial.ttf\")'`\n\t *\n\t * - An array of the individual sources that you would use for the src attribute of a @font-face rule. Eg: `['url(\"/fonts.foo.ttf\")', 'url(\"/fonts/foo-fallback.ttf\")', 'local(\"Arial\")']`\n\t *\n\t * - An array of URLs. Eg: `[\"/fonts.foo.ttf\", \"/fonts/foo-fallback.ttf\"]`\n\t *\n\t * Only the first and second forms allow you to use local fonts. The third form only allows you to use remote fonts.\n\t *\n\t * If you have a <style> or <link> element on the page containing @font-face rules, you can use the {@link libjass.renderers.RendererSettings.makeFontMapFromStyleElement}\n\t * convenience method to create a font map.\n\t *\n\t * Defaults to null.\n\t *\n\t * @type {Map.<string, (string|!Array.<string>)>}\n\t */\n\tfontMap: Map<string, string | string[]> | null;\n\n\t/**\n\t * Subtitles will be pre-rendered for this amount of time (seconds).\n\t *\n\t * Defaults to 5.\n\t *\n\t * @type {number}\n\t */\n\tpreRenderTime: number;\n\n\t/**\n\t * Subtitle outlines will be rendered in full detail. When false, the value of blur is used to draw less outlines for better performance and (hopefully) similar output.\n\t *\n\t * Defaults to false.\n\t *\n\t * @type {boolean}\n\t */\n\tpreciseOutlines: boolean;\n\n\t/**\n\t * Outlines and blur are implemented using SVG filters by default. When false, they will be rendered using alternative means.\n\t *\n\t * IE 11 and below do not support SVG filters on HTML elements so this should be set to false there. See http://caniuse.com/svg-html for details.\n\t *\n\t * Defaults to true.\n\t *\n\t * @type {boolean}\n\t */\n\tenableSvg: boolean;\n\n\t/**\n\t * Comma-separated list of fonts to be used when font specified in ASS Styles not loaded.\n\t *\n\t * The value should be a valid CSS font-family property (i.e. comma-separated and individual names in quotes if necessary). Use empty string to disable fallback.\n\t *\n\t * Defaults to 'Arial, Helvetica, sans-serif, \"Segoe UI Symbol\"'.\n\t *\n\t * @type {string}\n\t */\n\tfallbackFonts: string;\n\n\t/**\n\t * If true, attached TTF fonts in the ASS script will be used. The font is loaded as a data: URI. Requires ES6 typed arrays (ArrayBuffer, DataView, Uint8Array, etc).\n\t *\n\t * The font is naively parsed to extract the strings that will be used as the font family. Do not use this option with untrusted fonts or scripts.\n\t *\n\t * Defaults to false.\n\t *\n\t * @type {boolean}\n\t */\n\tuseAttachedFonts: boolean;\n}\n\n/**\n * @param {!CSSRule} rule\n * @return {boolean}\n */\nfunction isFontFaceRule(rule: CSSRule): rule is CSSFontFaceRule {\n\treturn rule.type === CSSRule.FONT_FACE_RULE;\n}\n\n/**\n * Returns true if this environment may support SVG filter effects. May return false positives.\n *\n * @return {boolean}\n */\nfunction testSupportsSvg(): boolean {\n\tif (debugMode) {\n\t\tconsole.log(\"Testing whether SVG filter effects are supported.\");\n\t}\n\n\tif (typeof document === \"undefined\") {\n\t\tif (debugMode) {\n\t\t\tconsole.log(\"This doesn't look like a browser. Assuming it doesn't support SVG filter effects.\");\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tconst morphologyFilter = document.createElementNS(\"http://www.w3.org/2000/svg\", \"feMorphology\");\n\n\t// https://connect.microsoft.com/IE/feedback/details/2375800\n\ttry {\n\t\tmorphologyFilter.radiusX.baseVal = 1;\n\t}\n\tcatch (ex) {\n\t\tif (debugMode) {\n\t\t\tif (ex instanceof DOMException) {\n\t\t\t\tconst domException = ex as DOMException;\n\t\t\t\tif (domException.code === DOMException.NO_MODIFICATION_ALLOWED_ERR) {\n\t\t\t\t\tconsole.log(\"Setting SVGFEMorphologyElement.radiusX.baseVal threw NoModificationAllowedError. This browser doesn't support SVG DOM correctly.\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.log(`Setting SVGFEMorphologyElement.radiusX.baseVal threw unexpected DOMException code ${ domException.code }. This browser doesn't support SVG DOM correctly.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.log(`Setting SVGFEMorphologyElement.radiusX.baseVal threw unexpected exception ${ ex }. This browser doesn't support SVG SVG DOM correctly.`);\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t// https://connect.microsoft.com/IE/feedback/details/2375757\n\tmorphologyFilter.setAttribute(\"radius\", \"1\");\n\tif (morphologyFilter.cloneNode().getAttribute(\"radius\") !== \"1\") {\n\t\tif (debugMode) {\n\t\t\tconsole.log(\"SVGFEMorphologyElement's radius attribute was corrupted when cloned. This browser doesn't support SVG DOM correctly.\");\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tif (debugMode) {\n\t\tconsole.log(\"This browser may support SVG filter effects.\");\n\t}\n\n\treturn true;\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AutoClock } from \"./auto\";\nimport { Clock, ClockEvent } from \"./base\";\n\n/**\n * An implementation of libjass.renderers.Clock that generates {@link libjass.renderers.ClockEvent}s according to the state of a <video> element.\n *\n * @param {!HTMLVideoElement} video\n */\nexport class VideoClock implements Clock {\n\tprivate _autoClock: AutoClock;\n\n\tconstructor(video: HTMLVideoElement) {\n\t\tthis._autoClock = new AutoClock(() => video.currentTime, 100);\n\t\tvideo.addEventListener(\"playing\", () => this._autoClock.play(), false);\n\t\tvideo.addEventListener(\"pause\", () => this._autoClock.pause(), false);\n\t\tvideo.addEventListener(\"seeking\", () => this._autoClock.seeking(), false);\n\t\tvideo.addEventListener(\"ratechange\", () => this._autoClock.setRate(video.playbackRate), false);\n\t}\n\n\t/**\n\t * @type {number}\n\t */\n\tget currentTime(): number {\n\t\treturn this._autoClock.currentTime;\n\t}\n\n\t/**\n\t * @type {boolean}\n\t */\n\tget enabled(): boolean {\n\t\treturn this._autoClock.enabled;\n\t}\n\n\t/**\n\t * @type {boolean}\n\t */\n\tget paused(): boolean {\n\t\treturn this._autoClock.paused;\n\t}\n\n\t/**\n\t * Gets the rate of the clock - how fast the clock ticks compared to real time.\n\t *\n\t * @type {number}\n\t */\n\tget rate(): number {\n\t\treturn this._autoClock.rate;\n\t}\n\n\t/**\n\t * Enable the clock.\n\t *\n\t * @return {boolean} True if the clock is now enabled, false if it was already enabled.\n\t */\n\tenable(): boolean {\n\t\treturn this._autoClock.enable();\n\t}\n\n\t/**\n\t * Disable the clock.\n\t *\n\t * @return {boolean} True if the clock is now disabled, false if it was already disabled.\n\t */\n\tdisable(): boolean {\n\t\treturn this._autoClock.disable();\n\t}\n\n\t/**\n\t * Toggle the clock.\n\t */\n\ttoggle(): void {\n\t\tif (this._autoClock.enabled) {\n\t\t\tthis.disable();\n\t\t}\n\t\telse {\n\t\t\tthis.enable();\n\t\t}\n\t}\n\n\t/**\n\t * Enable or disable the clock.\n\t *\n\t * @param {boolean} enabled If true, the clock is enabled, otherwise it's disabled.\n\t * @return {boolean} True if the clock is now in the given state, false if it was already in that state.\n\t */\n\tsetEnabled(enabled: boolean): boolean {\n\t\tif (enabled) {\n\t\t\treturn this.enable();\n\t\t}\n\t\telse {\n\t\t\treturn this.disable();\n\t\t}\n\t}\n\n\t/**\n\t * @param {number} type\n\t * @param {!Function} listener\n\t */\n\taddEventListener(type: ClockEvent, listener: Function): void {\n\t\tthis._autoClock.addEventListener(type, listener);\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { debugMode } from \"../../settings\";\n\nimport { Clock, ClockEvent } from \"./base\";\nimport { ManualClock } from \"./manual\";\n\n/**\n * An implementation of {@link libjass.renderers.Clock} that automatically ticks and generates {@link libjass.renderers.ClockEvent}s according to the state of an external driver.\n *\n * For example, if you're using libjass to render subtitles on a canvas with your own video controls, these video controls will function as the driver to this AutoClock.\n * It would call {@link libjass.renderers.AutoClock.play}, {@link libjass.renderers.AutoClock.pause}, etc. when the user pressed the corresponding video controls.\n *\n * The difference from ManualClock is that AutoClock does not require the driver to call something like {@link libjass.renderers.ManualClock.tick}. Instead it keeps its\n * own time with a high-resolution requestAnimationFrame-based timer.\n *\n * If using libjass with a <video> element, consider using {@link libjass.renderers.VideoClock} that uses the video element as a driver.\n *\n * @param {function():number} getCurrentTime A callback that will be invoked to get the current time of the external driver.\n * @param {number} autoPauseAfter If two calls to getCurrentTime are more than autoPauseAfter milliseconds apart but return the same time, then the external driver will be\n * considered to have paused.\n */\nexport class AutoClock implements Clock {\n\tprivate _manualClock: ManualClock = new ManualClock();\n\n\tprivate _nextAnimationFrameRequestId: number | null = null;\n\n\tprivate _lastKnownExternalTime: number | null = null;\n\tprivate _lastKnownExternalTimeObtainedAt: number = 0;\n\n\tconstructor(private _getCurrentTime: () => number, private _autoPauseAfter: number) { }\n\n\t/**\n\t * Tells the clock to start generating ticks.\n\t */\n\tplay(): void {\n\t\tif (!this._manualClock.enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startTicking();\n\n\t\tthis._manualClock.play();\n\t}\n\n\t/**\n\t * Tells the clock to pause.\n\t */\n\tpause(): void {\n\t\tif (!this._manualClock.enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._nextAnimationFrameRequestId === null) {\n\t\t\tif (debugMode) {\n\t\t\t\tconsole.warn(\"AutoClock.pause: Abnormal state detected. AutoClock._nextAnimationFrameRequestId should not have been null.\");\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._stopTicking();\n\n\t\tthis._manualClock.pause();\n\t}\n\n\t/**\n\t * Tells the clock that the external driver is seeking.\n\t */\n\tseeking(): void {\n\t\tthis._manualClock.seek(this._getCurrentTime());\n\t}\n\n\t// Clock members\n\n\t/**\n\t * @type {number}\n\t */\n\tget currentTime(): number {\n\t\treturn this._manualClock.currentTime;\n\t}\n\n\t/**\n\t * @type {boolean}\n\t */\n\tget enabled(): boolean {\n\t\treturn this._manualClock.enabled;\n\t}\n\n\t/**\n\t * @type {boolean}\n\t */\n\tget paused(): boolean {\n\t\treturn this._manualClock.paused;\n\t}\n\n\t/**\n\t * Gets the rate of the clock - how fast the clock ticks compared to real time.\n\t *\n\t * @type {number}\n\t */\n\tget rate(): number {\n\t\treturn this._manualClock.rate;\n\t}\n\n\t/**\n\t * Sets the rate of the clock - how fast the clock ticks compared to real time.\n\t *\n\t * @param {number} rate The new rate of the clock.\n\t */\n\tsetRate(rate: number): void {\n\t\tthis._manualClock.setRate(rate);\n\t}\n\n\t/**\n\t * Enable the clock.\n\t *\n\t * @return {boolean} True if the clock is now enabled, false if it was already enabled.\n\t */\n\tenable(): boolean {\n\t\tif (!this._manualClock.enable()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._startTicking();\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Disable the clock.\n\t *\n\t * @return {boolean} True if the clock is now disabled, false if it was already disabled.\n\t */\n\tdisable(): boolean {\n\t\tif (!this._manualClock.disable()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._stopTicking();\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Toggle the clock.\n\t */\n\ttoggle(): void {\n\t\tif (this._manualClock.enabled) {\n\t\t\tthis.disable();\n\t\t}\n\t\telse {\n\t\t\tthis.enable();\n\t\t}\n\t}\n\n\t/**\n\t * Enable or disable the clock.\n\t *\n\t * @param {boolean} enabled If true, the clock is enabled, otherwise it's disabled.\n\t * @return {boolean} True if the clock is now in the given state, false if it was already in that state.\n\t */\n\tsetEnabled(enabled: boolean): boolean {\n\t\tif (enabled) {\n\t\t\treturn this.enable();\n\t\t}\n\t\telse {\n\t\t\treturn this.disable();\n\t\t}\n\t}\n\n\t/**\n\t * @param {number} type\n\t * @param {!Function} listener\n\t */\n\taddEventListener(type: ClockEvent, listener: Function): void {\n\t\tthis._manualClock.addEventListener(type, listener);\n\t};\n\n\t/**\n\t * @param {number} timeStamp\n\t */\n\tprivate _onTimerTick(timeStamp: number): void {\n\t\tif (!this._manualClock.enabled) {\n\t\t\tif (debugMode) {\n\t\t\t\tconsole.warn(\"AutoClock._onTimerTick: Called when disabled.\");\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentTime = this._manualClock.currentTime;\n\t\tconst currentExternalTime = this._getCurrentTime();\n\n\t\tif (!this._manualClock.paused) {\n\t\t\tif (this._lastKnownExternalTime !== null && currentExternalTime === this._lastKnownExternalTime) {\n\t\t\t\tif (timeStamp - this._lastKnownExternalTimeObtainedAt > this._autoPauseAfter) {\n\t\t\t\t\tthis._lastKnownExternalTimeObtainedAt = 0;\n\t\t\t\t\tthis._manualClock.seek(currentExternalTime);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._manualClock.tick((timeStamp - this._lastKnownExternalTimeObtainedAt) / 1000 * this._manualClock.rate + this._lastKnownExternalTime);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._lastKnownExternalTime = currentExternalTime;\n\t\t\t\tthis._lastKnownExternalTimeObtainedAt = timeStamp;\n\t\t\t\tthis._manualClock.tick(currentExternalTime);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (currentTime !== currentExternalTime) {\n\t\t\t\tthis._lastKnownExternalTime = currentExternalTime;\n\t\t\t\tthis._lastKnownExternalTimeObtainedAt = timeStamp;\n\t\t\t\tthis._manualClock.tick(currentExternalTime);\n\t\t\t}\n\t\t}\n\n\t\tthis._nextAnimationFrameRequestId = requestAnimationFrame(timeStamp => this._onTimerTick(timeStamp));\n\t}\n\n\tprivate _startTicking(): void {\n\t\tif (this._nextAnimationFrameRequestId === null) {\n\t\t\tthis._nextAnimationFrameRequestId = requestAnimationFrame(timeStamp => this._onTimerTick(timeStamp));\n\t\t}\n\t}\n\n\tprivate _stopTicking(): void {\n\t\tif (this._nextAnimationFrameRequestId !== null) {\n\t\t\tcancelAnimationFrame(this._nextAnimationFrameRequestId);\n\t\t\tthis._nextAnimationFrameRequestId = null;\n\t\t}\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Map } from \"../../utility/map\";\nimport { mixin } from \"../../utility/mixin\";\n\nimport { Clock, ClockEvent, EventSource } from \"./base\";\n\n/**\n * An implementation of {@link libjass.renderers.Clock} that allows user script to manually trigger {@link libjass.renderers.ClockEvent}s.\n */\nexport class ManualClock implements Clock, EventSource<ClockEvent> {\n\tprivate _currentTime: number = -1;\n\tprivate _rate: number = 1;\n\n\tprivate _enabled: boolean = true;\n\tprivate _paused: boolean = true;\n\n\t/**\n\t * Trigger a {@link libjass.renderers.ClockEvent.Play}\n\t */\n\tplay(): void {\n\t\tif (!this._enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._paused) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._paused = false;\n\n\t\tthis._dispatchEvent(ClockEvent.Play, []);\n\t}\n\n\t/**\n\t * Trigger a {@link libjass.renderers.ClockEvent.Tick} with the given time.\n\t *\n\t * @param {number} currentTime\n\t */\n\ttick(currentTime: number): void {\n\t\tif (!this._enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._currentTime === currentTime) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.play();\n\n\t\tthis._currentTime = currentTime;\n\t\tthis._dispatchEvent(ClockEvent.Tick, []);\n\t}\n\n\t/**\n\t * Seek to the given time. Unlike {@link libjass.renderers.ManualClock.tick} this is used to represent a discontinuous jump, such as the user seeking\n\t * via the video element's position bar.\n\t *\n\t * @param {number} time\n\t */\n\tseek(time: number): void {\n\t\tif (!this._enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.pause();\n\n\t\tif (this._currentTime === time) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.stop();\n\n\t\tthis.tick(time);\n\n\t\tthis.pause();\n\t}\n\n\t/**\n\t * Trigger a {@link libjass.renderers.ClockEvent.Pause}\n\t */\n\tpause(): void {\n\t\tif (!this._enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._paused) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._paused = true;\n\n\t\tthis._dispatchEvent(ClockEvent.Pause, []);\n\t}\n\n\t/**\n\t * Trigger a {@link libjass.renderers.ClockEvent.Stop}\n\t */\n\tstop(): void {\n\t\tthis._dispatchEvent(ClockEvent.Stop, []);\n\t}\n\n\t// Clock members\n\n\t/**\n\t * @type {number}\n\t */\n\tget currentTime(): number {\n\t\treturn this._currentTime;\n\t}\n\n\t/**\n\t * @type {boolean}\n\t */\n\tget enabled(): boolean {\n\t\treturn this._enabled;\n\t}\n\n\t/**\n\t * @type {boolean}\n\t */\n\tget paused(): boolean {\n\t\treturn this._paused;\n\t}\n\n\t/**\n\t * Gets the rate of the clock - how fast the clock ticks compared to real time.\n\t *\n\t * @type {number}\n\t */\n\tget rate(): number {\n\t\treturn this._rate;\n\t}\n\n\t/**\n\t * Sets the rate of the clock - how fast the clock ticks compared to real time.\n\t *\n\t * @param {number} rate The new rate of the clock.\n\t */\n\tsetRate(rate: number): void {\n\t\tif (this._rate === rate) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._rate = rate;\n\n\t\tthis._dispatchEvent(ClockEvent.RateChange, []);\n\t}\n\n\t/**\n\t * Enable the clock.\n\t *\n\t * @return {boolean} True if the clock is now enabled, false if it was already enabled.\n\t */\n\tenable(): boolean {\n\t\tif (this._enabled) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis._enabled = true;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Disable the clock.\n\t *\n\t * @return {boolean} True if the clock is now disabled, false if it was already disabled.\n\t */\n\tdisable(): boolean {\n\t\tif (!this._enabled) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.pause();\n\n\t\tthis.stop();\n\n\t\tthis._enabled = false;\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Toggle the clock.\n\t */\n\ttoggle(): void {\n\t\tif (this._enabled) {\n\t\t\tthis.disable();\n\t\t}\n\t\telse {\n\t\t\tthis.enable();\n\t\t}\n\t}\n\n\t/**\n\t * Enable or disable the clock.\n\t *\n\t * @param {boolean} enabled If true, the clock is enabled, otherwise it's disabled.\n\t * @return {boolean} True if the clock is now in the given state, false if it was already in that state.\n\t */\n\tsetEnabled(enabled: boolean): boolean {\n\t\tif (enabled) {\n\t\t\treturn this.enable();\n\t\t}\n\t\telse {\n\t\t\treturn this.disable();\n\t\t}\n\t}\n\n\t// EventSource members\n\n\t/**\n\t * @type {!Map.<T, !Array.<Function>>}\n\t */\n\t_eventListeners: Map<ClockEvent, Function[]> = new Map<ClockEvent, Function[]>();\n\n\t/**\n\t * @type {function(number, !Function)}\n\t */\n\taddEventListener: (type: ClockEvent, listener: Function) => void;\n\n\t/**\n\t * @type {function(number, Array.<*>)}\n\t */\n\t_dispatchEvent: (type: ClockEvent, args: Object[]) => void;\n}\nmixin(ManualClock, [EventSource]);\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Adds properties of the given mixins' prototypes to the given class's prototype.\n *\n * @param {!*} clazz\n * @param {!Array.<*>} mixins\n */\nexport function mixin(clazz: any, mixins: any[]): void {\n\tfor (const mixin of mixins) {\n\t\tfor (const name of Object.getOwnPropertyNames(mixin.prototype)) {\n\t\t\tclazz.prototype[name] = mixin.prototype[name];\n\t\t}\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Map } from \"../../utility/map\";\n\n/**\n * A mixin class that represents an event source.\n */\nexport class EventSource<T> {\n\t/**\n\t * A map from event type to an array of all the listeners registered for that event type.\n\t *\n\t * @type {!Map.<T, !Array.<Function>>}\n\t */\n\t_eventListeners: Map<T, Function[]>;\n\n\t/**\n\t * Add a listener for the given event.\n\t *\n\t * @param {!T} type The type of event to attach the listener for\n\t * @param {!Function} listener The listener\n\t */\n\taddEventListener(type: T, listener: Function): void {\n\t\tlet listeners = this._eventListeners.get(type);\n\n\t\tif (listeners === undefined) {\n\t\t\tthis._eventListeners.set(type, listeners = []);\n\t\t}\n\n\t\tlisteners.push(listener);\n\t}\n\n\t/**\n\t * Calls all listeners registered for the given event type.\n\t *\n\t * @param {!T} type The type of event to dispatch\n\t * @param {!Array.<*>} args Arguments for the listeners of the event\n\t */\n\t_dispatchEvent(type: T, args: Object[]): void {\n\t\tconst listeners = this._eventListeners.get(type);\n\t\tif (listeners !== undefined) {\n\t\t\tfor (const listener of listeners) {\n\t\t\t\tlistener.apply(this, args);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * The type of clock event.\n */\nexport enum ClockEvent {\n\tPlay,\n\tTick,\n\tPause,\n\tStop,\n\tRateChange,\n}\n\n/**\n * The clock interface. A clock is used by a renderer as a source of {@link libjass.renderers.ClockEvent}s.\n */\nexport interface Clock {\n\t/**\n\t * @type {number}\n\t */\n\tcurrentTime: number;\n\n\t/**\n\t * @type {boolean}\n\t */\n\tenabled: boolean;\n\n\t/**\n\t * @type {boolean}\n\t */\n\tpaused: boolean;\n\n\t/**\n\t * Gets the rate of the clock - how fast the clock ticks compared to real time.\n\t *\n\t * @type {number}\n\t */\n\trate: number;\n\n\t/**\n\t * Enable the clock.\n\t *\n\t * @return {boolean} True if the clock is now enabled, false if it was already enabled.\n\t */\n\tenable(): boolean;\n\n\t/**\n\t * Disable the clock.\n\t *\n\t * @return {boolean} True if the clock is now disabled, false if it was already disabled.\n\t */\n\tdisable(): boolean;\n\n\t/**\n\t * Toggle the clock.\n\t */\n\ttoggle(): void;\n\n\t/**\n\t * Enable or disable the clock.\n\t *\n\t * @param {boolean} enabled If true, the clock is enabled, otherwise it's disabled.\n\t * @return {boolean} True if the clock is now in the given state, false if it was already in that state.\n\t */\n\tsetEnabled(enabled: boolean): boolean;\n\n\t// EventSource members\n\n\t/**\n\t * @param {number} type\n\t * @param {!Function} listener\n\t */\n\taddEventListener(type: ClockEvent, listener: Function): void;\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport { parse } from \"./parse\";\nexport { BrowserReadableStream, Stream, StringStream, XhrStream } from \"./streams\";\nexport { StreamParser, SrtStreamParser } from \"./stream-parsers\";\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { debugMode } from \"../settings\";\n\nimport { ASS } from \"../types/ass\";\nimport { Attachment, AttachmentType } from \"../types/attachment\";\nimport { Dialogue } from \"../types/dialogue\";\nimport { Style } from \"../types/style\";\n\nimport { Map } from \"../utility/map\";\n\nimport { DeferredPromise, Promise } from \"../utility/promise\";\n\nimport { parseLineIntoProperty } from \"./misc\";\nimport { Stream } from \"./streams\";\n\nenum Section {\n\tScriptInfo,\n\tStyles,\n\tEvents,\n\tFonts,\n\tGraphics,\n\tOther,\n\tEOF,\n}\n\n/**\n * A parser that parses an {@link libjass.ASS} object from a {@link libjass.parser.Stream}.\n *\n * @param {!libjass.parser.Stream} stream The {@link libjass.parser.Stream} to parse\n */\nexport class StreamParser {\n\tprivate _ass: ASS = new ASS();\n\tprivate _minimalDeferred: DeferredPromise<ASS> = new DeferredPromise<ASS>();\n\tprivate _deferred: DeferredPromise<ASS> = new DeferredPromise<ASS>();\n\n\tprivate _shouldSwallowBom: boolean = true;\n\tprivate _currentSection: Section = Section.ScriptInfo;\n\tprivate _currentAttachment: Attachment | null = null;\n\n\tconstructor(private _stream: Stream) {\n\t\tthis._stream.nextLine().then(line => this._onNextLine(line), reason => {\n\t\t\tthis._minimalDeferred.reject(reason);\n\t\t\tthis._deferred.reject(reason);\n\t\t});\n\t}\n\n\t/**\n\t * @type {!Promise.<!libjass.ASS>} A promise that will be resolved when the script properties of the ASS script have been parsed from the stream. Styles and events have not necessarily been\n\t * parsed at the point this promise becomes resolved.\n\t */\n\tget minimalASS(): Promise<ASS> {\n\t\treturn this._minimalDeferred.promise;\n\t}\n\n\t/**\n\t * @type {!Promise.<!libjass.ASS>} A promise that will be resolved when the entire stream has been parsed.\n\t */\n\tget ass(): Promise<ASS> {\n\t\treturn this._deferred.promise;\n\t}\n\n\t/**\n\t * @type {number}\n\t */\n\tprivate get currentSection(): Section {\n\t\treturn this._currentSection;\n\t}\n\n\t/**\n\t * @type {number}\n\t */\n\tprivate set currentSection(value: Section) {\n\t\tif (this._currentAttachment !== null) {\n\t\t\tthis._ass.addAttachment(this._currentAttachment);\n\t\t\tthis._currentAttachment = null;\n\t\t}\n\n\t\tif (this._currentSection === Section.ScriptInfo && value !== Section.ScriptInfo) {\n\t\t\t// Exiting script info section\n\t\t\tthis._minimalDeferred.resolve(this._ass);\n\t\t}\n\n\t\tif (value === Section.EOF) {\n\t\t\tconst scriptProperties = this._ass.properties;\n\t\t\tif (scriptProperties.resolutionX === undefined || scriptProperties.resolutionY === undefined) {\n\t\t\t\t// Malformed script.\n\t\t\t\tthis._minimalDeferred.reject(\"Malformed ASS script.\");\n\t\t\t\tthis._deferred.reject(\"Malformed ASS script.\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._minimalDeferred.resolve(this._ass);\n\t\t\t\tthis._deferred.resolve(this._ass);\n\t\t\t}\n\t\t}\n\n\t\tthis._currentSection = value;\n\t}\n\n\t/**\n\t * @param {string} line\n\t */\n\tprivate _onNextLine(line: string | null): void {\n\t\tif (line === null) {\n\t\t\tthis.currentSection = Section.EOF;\n\t\t\treturn;\n\t\t}\n\n\t\tif (line[line.length - 1] === \"\\r\") {\n\t\t\tline = line.substr(0, line.length - 1);\n\t\t}\n\n\t\tif (line.charCodeAt(0) === 0xfeff && this._shouldSwallowBom) {\n\t\t\tline = line.substr(1);\n\t\t}\n\n\t\tthis._shouldSwallowBom = false;\n\n\t\tif (line === \"\") {\n\t\t\t// Ignore empty lines.\n\t\t}\n\n\t\telse if (line[0] === \";\" && this._currentAttachment === null) {\n\t\t\t// Lines starting with ; are comments, unless reading an attachment.\n\t\t}\n\n\t\telse if (line === \"[Script Info]\") {\n\t\t\tthis.currentSection = Section.ScriptInfo;\n\t\t}\n\t\telse if (line === \"[V4+ Styles]\" || line === \"[V4 Styles]\") {\n\t\t\tthis.currentSection = Section.Styles;\n\t\t}\n\t\telse if (line === \"[Events]\") {\n\t\t\tthis.currentSection = Section.Events;\n\t\t}\n\t\telse if (line === \"[Fonts]\") {\n\t\t\tthis.currentSection = Section.Fonts;\n\t\t}\n\t\telse if (line === \"[Graphics]\") {\n\t\t\tthis.currentSection = Section.Graphics;\n\t\t}\n\t\telse {\n\t\t\tif (this._currentAttachment === null && line[0] === \"[\" && line[line.length - 1] === \"]\") {\n\t\t\t\t/* This looks like the start of a new section. The section name is unrecognized if it is.\n\t\t\t\t * Since there's no current attachment being parsed it's definitely the start of a new section.\n\t\t\t\t * If an attachment is being parsed, this might be part of the attachment.\n\t\t\t\t */\n\t\t\t\tthis.currentSection = Section.Other;\n\t\t\t}\n\n\t\t\tswitch (this.currentSection) {\n\t\t\t\tcase Section.ScriptInfo:\n\t\t\t\t\tconst property = parseLineIntoProperty(line);\n\t\t\t\t\tif (property !== null) {\n\t\t\t\t\t\tswitch (property.name) {\n\t\t\t\t\t\t\tcase \"PlayResX\":\n\t\t\t\t\t\t\t\tthis._ass.properties.resolutionX = parseInt(property.value);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase \"PlayResY\":\n\t\t\t\t\t\t\t\tthis._ass.properties.resolutionY = parseInt(property.value);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase \"WrapStyle\":\n\t\t\t\t\t\t\t\tthis._ass.properties.wrappingStyle = parseInt(property.value);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase \"ScaledBorderAndShadow\":\n\t\t\t\t\t\t\t\tthis._ass.properties.scaleBorderAndShadow = (property.value === \"yes\");\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase Section.Styles:\n\t\t\t\t\tif (this._ass.stylesFormatSpecifier === null) {\n\t\t\t\t\t\tconst property = parseLineIntoProperty(line);\n\t\t\t\t\t\tif (property !== null && property.name === \"Format\") {\n\t\t\t\t\t\t\tthis._ass.stylesFormatSpecifier = property.value.split(\",\").map(str => str.trim());\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// Ignore any non-format lines\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis._ass.addStyle(line);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (ex) {\n\t\t\t\t\t\t\tif (debugMode) {\n\t\t\t\t\t\t\t\tconsole.error(`Could not parse style from line ${ line } - ${ ex.stack || ex }`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase Section.Events:\n\t\t\t\t\tif (this._ass.dialoguesFormatSpecifier === null) {\n\t\t\t\t\t\tconst property = parseLineIntoProperty(line);\n\t\t\t\t\t\tif (property !== null && property.name === \"Format\") {\n\t\t\t\t\t\t\tthis._ass.dialoguesFormatSpecifier = property.value.split(\",\").map(str => str.trim());\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// Ignore any non-format lines\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis._ass.addEvent(line);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (ex) {\n\t\t\t\t\t\t\tif (debugMode) {\n\t\t\t\t\t\t\t\tconsole.error(`Could not parse event from line ${ line } - ${ ex.stack || ex }`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase Section.Fonts:\n\t\t\t\tcase Section.Graphics:\n\t\t\t\t\tconst startOfNewAttachmentRegex = (this.currentSection === Section.Fonts) ? /^fontname:(.+)/ : /^filename:(.+)/;\n\t\t\t\t\tconst startOfNewAttachment = startOfNewAttachmentRegex.exec(line);\n\n\t\t\t\t\tif (startOfNewAttachment !== null) {\n\t\t\t\t\t\t// Start of new attachment\n\n\t\t\t\t\t\tif (this._currentAttachment !== null) {\n\t\t\t\t\t\t\tthis._ass.addAttachment(this._currentAttachment);\n\t\t\t\t\t\t\tthis._currentAttachment = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._currentAttachment = new Attachment(startOfNewAttachment[1].trim(), (this.currentSection === Section.Fonts) ? AttachmentType.Font : AttachmentType.Graphic);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this._currentAttachment !== null) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis._currentAttachment.contents += uuencodedToBase64(line);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (ex) {\n\t\t\t\t\t\t\tif (debugMode) {\n\t\t\t\t\t\t\t\tconsole.error(`Encountered error while reading font ${ this._currentAttachment.filename }: %o`, ex);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis._currentAttachment = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Ignore.\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase Section.Other:\n\t\t\t\t\t// Ignore other sections.\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(`Unhandled state ${ this.currentSection }`);\n\t\t\t}\n\t\t}\n\n\t\tthis._stream.nextLine().then(line => this._onNextLine(line), reason => {\n\t\t\tthis._minimalDeferred.reject(reason);\n\t\t\tthis._deferred.reject(reason);\n\t\t});\n\t}\n}\n\n/**\n * A parser that parses an {@link libjass.ASS} object from a {@link libjass.parser.Stream} of an SRT script.\n *\n * @param {!libjass.parser.Stream} stream The {@link libjass.parser.Stream} to parse\n */\nexport class SrtStreamParser {\n\tprivate _ass: ASS = new ASS();\n\tprivate _deferred: DeferredPromise<ASS> = new DeferredPromise<ASS>();\n\n\tprivate _shouldSwallowBom: boolean = true;\n\n\tprivate _currentDialogueNumber: string | null = null;\n\tprivate _currentDialogueStart: string | null = null;\n\tprivate _currentDialogueEnd: string | null = null;\n\tprivate _currentDialogueText: string | null = null;\n\n\tconstructor(private _stream: Stream) {\n\t\tthis._stream.nextLine().then(line => this._onNextLine(line), reason => {\n\t\t\tthis._deferred.reject(reason);\n\t\t});\n\n\t\tthis._ass.properties.resolutionX = 1280;\n\t\tthis._ass.properties.resolutionY = 720;\n\t\tthis._ass.properties.wrappingStyle = 1;\n\t\tthis._ass.properties.scaleBorderAndShadow = true;\n\n\t\tconst newStyle = new Style(new Map([[\"Name\", \"Default\"], [\"FontSize\", \"36\"]]));\n\t\tthis._ass.styles.set(newStyle.name, newStyle);\n\t}\n\n\t/**\n\t * @type {!Promise.<!libjass.ASS>} A promise that will be resolved when the entire stream has been parsed.\n\t */\n\tget ass(): Promise<ASS> {\n\t\treturn this._deferred.promise;\n\t}\n\n\t/**\n\t * @param {string} line\n\t */\n\tprivate _onNextLine(line: string | null): void {\n\t\tif (line === null) {\n\t\t\tif (this._currentDialogueNumber !== null && this._currentDialogueStart !== null && this._currentDialogueEnd !== null && this._currentDialogueText !== null) {\n\t\t\t\tthis._ass.dialogues.push(new Dialogue(new Map([\n\t\t\t\t\t[\"Style\", \"Default\"],\n\t\t\t\t\t[\"Start\", this._currentDialogueStart],\n\t\t\t\t\t[\"End\", this._currentDialogueEnd],\n\t\t\t\t\t[\"Text\", this._currentDialogueText],\n\t\t\t\t]), this._ass));\n\t\t\t}\n\n\t\t\tthis._deferred.resolve(this._ass);\n\t\t\treturn;\n\t\t}\n\n\t\tif (line[line.length - 1] === \"\\r\") {\n\t\t\tline = line.substr(0, line.length - 1);\n\t\t}\n\n\t\tif (line.charCodeAt(0) === 0xfeff && this._shouldSwallowBom) {\n\t\t\tline = line.substr(1);\n\t\t}\n\n\t\tthis._shouldSwallowBom = false;\n\n\t\tif (line === \"\") {\n\t\t\tif (this._currentDialogueNumber !== null && this._currentDialogueStart !== null && this._currentDialogueEnd !== null && this._currentDialogueText !== null) {\n\t\t\t\tthis._ass.dialogues.push(new Dialogue(new Map([\n\t\t\t\t\t[\"Style\", \"Default\"],\n\t\t\t\t\t[\"Start\", this._currentDialogueStart],\n\t\t\t\t\t[\"End\", this._currentDialogueEnd],\n\t\t\t\t\t[\"Text\", this._currentDialogueText],\n\t\t\t\t]), this._ass));\n\t\t\t}\n\n\t\t\tthis._currentDialogueNumber = this._currentDialogueStart = this._currentDialogueEnd = this._currentDialogueText = null;\n\t\t}\n\t\telse {\n\t\t\tif (this._currentDialogueNumber === null) {\n\t\t\t\tif (/^\\d+$/.test(line)) {\n\t\t\t\t\tthis._currentDialogueNumber = line;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this._currentDialogueStart === null && this._currentDialogueEnd === null) {\n\t\t\t\tconst match = /^(\\d\\d:\\d\\d:\\d\\d,\\d\\d\\d) --> (\\d\\d:\\d\\d:\\d\\d,\\d\\d\\d)/.exec(line);\n\t\t\t\tif (match !== null) {\n\t\t\t\t\tthis._currentDialogueStart = match[1].replace(\",\", \".\");\n\t\t\t\t\tthis._currentDialogueEnd = match[2].replace(\",\", \".\");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tline = line\n\t\t\t\t\t.replace(/<b>/g, \"{\\\\b1}\").replace(/\\{b\\}/g, \"{\\\\b1}\")\n\t\t\t\t\t.replace(/<\\/b>/g, \"{\\\\b0}\").replace(/\\{\\/b\\}/g, \"{\\\\b0}\")\n\t\t\t\t\t.replace(/<i>/g, \"{\\\\i1}\").replace(/\\{i\\}/g, \"{\\\\i1}\")\n\t\t\t\t\t.replace(/<\\/i>/g, \"{\\\\i0}\").replace(/\\{\\/i\\}/g, \"{\\\\i0}\")\n\t\t\t\t\t.replace(/<u>/g, \"{\\\\u1}\").replace(/\\{u\\}/g, \"{\\\\u1}\")\n\t\t\t\t\t.replace(/<\\/u>/g, \"{\\\\u0}\").replace(/\\{\\/u\\}/g, \"{\\\\u0}\")\n\t\t\t\t\t.replace(\n\t\t\t\t\t\t/<font color=\"#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})\">/g,\n\t\t\t\t\t\t(/* ujs:unreferenced */ substring: string, red: string, green: string, blue: string) => `{\\c&H${ blue }${ green }${ red }&}`\n\t\t\t\t\t).replace(/<\\/font>/g, \"{\\\\c}\");\n\n\t\t\t\tif (this._currentDialogueText !== null) {\n\t\t\t\t\tthis._currentDialogueText += \"\\\\N\" + line;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._currentDialogueText = line;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._stream.nextLine().then(line => this._onNextLine(line), reason => {\n\t\t\tthis._deferred.reject(reason);\n\t\t});\n\t}\n}\n\n/**\n * Converts a uuencoded string to a base64 string.\n *\n * @param {string} str\n * @return {string}\n */\nfunction uuencodedToBase64(str: string): string {\n\tlet result = \"\";\n\n\tfor (let i = 0; i < str.length; i++) {\n\t\tconst charCode = str.charCodeAt(i) - 33;\n\n\t\tif (charCode < 0 || charCode > 63) {\n\t\t\tthrow new Error(`Out-of-range character code ${ charCode } at index ${ i } in string ${ str }`);\n\t\t}\n\t\tif (charCode < 26) {\n\t\t\tresult += String.fromCharCode(\"A\".charCodeAt(0) + charCode);\n\t\t}\n\t\telse if (charCode < 52) {\n\t\t\tresult += String.fromCharCode(\"a\".charCodeAt(0) + charCode - 26);\n\t\t}\n\t\telse if (charCode < 62) {\n\t\t\tresult += String.fromCharCode(\"0\".charCodeAt(0) + charCode - 52);\n\t\t}\n\t\telse if (charCode === 62) {\n\t\t\tresult += \"+\";\n\t\t}\n\t\telse {\n\t\t\tresult += \"/\";\n\t\t}\n\t}\n\n\treturn result;\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as parser from \"../parser\";\nimport { parseLineIntoTypedTemplate } from \"../parser/misc\";\nimport { ReadableStream, TextDecoderConstructor } from \"../parser/streams\";\n\nimport { registerClass as serializable } from \"../serialization\";\n\nimport { debugMode, verboseMode } from \"../settings\";\n\nimport { Map } from \"../utility/map\";\nimport { Promise } from \"../utility/promise\";\n\nimport { Attachment } from \"./attachment\";\nimport { Dialogue } from \"./dialogue\";\nimport { Format } from \"./misc\";\nimport { ScriptProperties } from \"./script-properties\";\nimport { Style } from \"./style\";\n\ndeclare const global: {\n\tfetch?(url: string): Promise<{ body: ReadableStream; ok?: boolean; status?: number; }>;\n\tReadableStream?: Function & { prototype: ReadableStream; };\n\tTextDecoder?: TextDecoderConstructor;\n};\n\n/**\n * This class represents an ASS script. It contains the {@link libjass.ScriptProperties}, an array of {@link libjass.Style}s, and an array of {@link libjass.Dialogue}s.\n */\n@serializable\nexport class ASS {\n\t/**\n\t * Creates an ASS object from the raw text of an ASS script.\n\t *\n\t * @param {string} raw The raw text of the script.\n\t * @param {(number|string)=0} type The type of the script. One of the {@link libjass.Format} constants, or one of the strings \"ass\" and \"srt\".\n\t * @return {!Promise.<!libjass.ASS>}\n\t */\n\tstatic fromString(raw: string, type: Format | \"ass\" | \"srt\" = Format.ASS): Promise<ASS> {\n\t\treturn ASS.fromStream(new parser.StringStream(raw), type);\n\t}\n\n\t/**\n\t * Creates an ASS object from the given {@link libjass.parser.Stream}.\n\t *\n\t * @param {!libjass.parser.Stream} stream The stream to parse the script from\n\t * @param {(number|string)=0} type The type of the script. One of the {@link libjass.Format} constants, or one of the strings \"ass\" and \"srt\".\n\t * @return {!Promise.<!libjass.ASS>} A promise that will be resolved with the ASS object when it has been fully parsed\n\t */\n\tstatic fromStream(stream: parser.Stream, type: Format | \"ass\" | \"srt\" = Format.ASS): Promise<ASS> {\n\t\tswitch (type) {\n\t\t\tcase Format.ASS:\n\t\t\tcase \"ass\":\n\t\t\t\treturn new parser.StreamParser(stream).ass;\n\t\t\tcase Format.SRT:\n\t\t\tcase \"srt\":\n\t\t\t\treturn new parser.SrtStreamParser(stream).ass;\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Invalid value of type: ${ type }`);\n\t\t}\n\t}\n\n\t/**\n\t * Creates an ASS object from the given URL.\n\t *\n\t * @param {string} url The URL of the script.\n\t * @param {(number|string)=0} type The type of the script. One of the {@link libjass.Format} constants, or one of the strings \"ass\" and \"srt\".\n\t * @return {!Promise.<!libjass.ASS>} A promise that will be resolved with the ASS object when it has been fully parsed\n\t */\n\tstatic fromUrl(url: string, type: Format | \"ass\" | \"srt\" = Format.ASS): Promise<ASS> {\n\t\tlet fetchPromise: Promise<ASS>;\n\n\t\tif (\n\t\t\ttypeof global.fetch === \"function\" &&\n\t\t\ttypeof global.ReadableStream === \"function\" && typeof global.ReadableStream.prototype.getReader === \"function\" &&\n\t\t\ttypeof global.TextDecoder === \"function\"\n\t\t) {\n\t\t\tfetchPromise = global.fetch(url).then(response => {\n\t\t\t\tif (response.ok === false || (response.ok === undefined && (response.status === undefined || response.status < 200 || response.status > 299))) {\n\t\t\t\t\tthrow new Error(`HTTP request for ${ url } failed with status code ${ response.status }`);\n\t\t\t\t}\n\n\t\t\t\treturn ASS.fromReadableStream(response.body, \"utf-8\", type);\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tfetchPromise = Promise.reject<ASS>(new Error(\"Not supported.\"));\n\t\t}\n\n\t\treturn fetchPromise.catch(reason => {\n\t\t\tif (debugMode) {\n\t\t\t\tconsole.log(\"fetch() failed, falling back to XHR: %o\", reason);\n\t\t\t}\n\n\t\t\tconst xhr = new XMLHttpRequest();\n\t\t\tconst result = ASS.fromStream(new parser.XhrStream(xhr), type);\n\t\t\txhr.open(\"GET\", url, true);\n\t\t\txhr.send();\n\t\t\treturn result;\n\t\t});\n\t}\n\n\t/**\n\t * Creates an ASS object from the given ReadableStream.\n\t *\n\t * @param {!ReadableStream} stream\n\t * @param {string=\"utf-8\"} encoding\n\t * @param {(number|string)=0} type The type of the script. One of the {@link libjass.Format} constants, or one of the strings \"ass\" and \"srt\".\n\t * @return {!Promise.<!libjass.ASS>} A promise that will be resolved with the ASS object when it has been fully parsed\n\t */\n\tstatic fromReadableStream(stream: ReadableStream, encoding: string = \"utf-8\", type: Format | \"ass\" | \"srt\" = Format.ASS): Promise<ASS> {\n\t\treturn ASS.fromStream(new parser.BrowserReadableStream(stream, encoding), type);\n\t}\n\n\t/**\n\t * Custom deserialization for ASS objects.\n\t *\n\t * @param {!*} obj\n\t * @return {!libjass.ASS}\n\t */\n\tstatic fromJSON(obj: any): ASS {\n\t\tconst result: ASS = Object.create(ASS.prototype);\n\n\t\tresult._properties = obj._properties;\n\n\t\tresult._styles = new Map<string, Style>();\n\t\tfor (const name of Object.keys(obj._styles)) {\n\t\t\tconst style = obj._styles[name];\n\t\t\tresult._styles.set(name, style);\n\t\t}\n\n\t\tresult._dialogues = obj._dialogues;\n\t\tresult._attachments = obj._attachments;\n\t\tresult._stylesFormatSpecifier = obj._stylesFormatSpecifier;\n\t\tresult._dialoguesFormatSpecifier = obj._dialoguesFormatSpecifier;\n\n\t\treturn result;\n\t}\n\n\tprivate _properties: ScriptProperties = new ScriptProperties();\n\tprivate _styles: Map<string, Style> = new Map<string, Style>();\n\tprivate _dialogues: Dialogue[] = [];\n\tprivate _attachments: Attachment[] = [];\n\n\tprivate _stylesFormatSpecifier: string[] | null = null;\n\tprivate _dialoguesFormatSpecifier: string[] | null = null;\n\n\t/**\n\t * The properties of this script.\n\t *\n\t * @type {!libjass.ScriptProperties}\n\t */\n\tget properties(): ScriptProperties {\n\t\treturn this._properties;\n\t}\n\n\t/**\n\t * The styles in this script.\n\t *\n\t * @type {!Map.<string, !libjass.Style>}\n\t */\n\tget styles(): Map<string, Style> {\n\t\treturn this._styles;\n\t}\n\n\t/**\n\t * The dialogues in this script.\n\t *\n\t * @type {!Array.<!libjass.Dialogue>}\n\t */\n\tget dialogues(): Dialogue[] {\n\t\treturn this._dialogues;\n\t}\n\n\t/**\n\t * The attachments of this script.\n\t *\n\t * @type {!Array.<!libjass.Attachment>}\n\t */\n\tget attachments(): Attachment[] {\n\t\treturn this._attachments;\n\t}\n\n\t/**\n\t * The format specifier for the styles section.\n\t *\n\t * @type {Array.<string>}\n\t */\n\tget stylesFormatSpecifier(): string[] | null {\n\t\treturn this._stylesFormatSpecifier;\n\t}\n\n\t/**\n\t * The format specifier for the styles section.\n\t *\n\t * @type {Array.<string>}\n\t */\n\tget dialoguesFormatSpecifier(): string[] | null {\n\t\treturn this._dialoguesFormatSpecifier;\n\t}\n\n\t/**\n\t * The format specifier for the events section.\n\t *\n\t * @type {Array.<string>}\n\t */\n\tset stylesFormatSpecifier(value: string[] | null) {\n\t\tthis._stylesFormatSpecifier = value;\n\t}\n\n\t/**\n\t * The format specifier for the events section.\n\t *\n\t * @type {Array.<string>}\n\t */\n\tset dialoguesFormatSpecifier(value: string[] | null) {\n\t\tthis._dialoguesFormatSpecifier = value;\n\t}\n\n\tconstructor() {\n\t\t// Deprecated constructor argument\n\t\tif (arguments.length === 1) {\n\t\t\tthrow new Error(\"Constructor `new ASS(rawASS)` has been deprecated. Use `ASS.fromString(rawASS)` instead.\");\n\t\t}\n\n\t\tthis._styles.set(\"Default\", new Style(new Map([[\"Name\", \"Default\"]])));\n\t}\n\n\t/**\n\t * Add a style to this ASS script.\n\t *\n\t * @param {string} line The line from the script that contains the new style.\n\t */\n\taddStyle(line: string): void {\n\t\tif (this._stylesFormatSpecifier === null) {\n\t\t\tthrow new Error(\"stylesFormatSpecifier is not set.\");\n\t\t}\n\n\t\tconst styleLine = parseLineIntoTypedTemplate(line, this._stylesFormatSpecifier);\n\t\tif (styleLine === null || styleLine.type !== \"Style\") {\n\t\t\treturn;\n\t\t}\n\n\t\tconst styleTemplate = styleLine.template;\n\n\t\tif (verboseMode) {\n\t\t\tlet repr = \"\";\n\t\t\tstyleTemplate.forEach((value, key) => repr += `${ key } = ${ value }, `);\n\t\t\tconsole.log(`Read style: ${ repr }`);\n\t\t}\n\n\t\t// Create the dialogue and add it to the dialogues array\n\t\tconst style = new Style(styleTemplate);\n\t\tthis._styles.set(style.name, style);\n\t}\n\n\t/**\n\t * Add an event to this ASS script.\n\t *\n\t * @param {string} line The line from the script that contains the new event.\n\t */\n\taddEvent(line: string): void {\n\t\tif (this._dialoguesFormatSpecifier === null) {\n\t\t\tthrow new Error(\"dialoguesFormatSpecifier is not set.\");\n\t\t}\n\n\t\tconst dialogueLine = parseLineIntoTypedTemplate(line, this._dialoguesFormatSpecifier);\n\t\tif (dialogueLine === null || dialogueLine.type !== \"Dialogue\") {\n\t\t\treturn;\n\t\t}\n\n\t\tconst dialogueTemplate = dialogueLine.template;\n\n\t\tif (verboseMode) {\n\t\t\tlet repr = \"\";\n\t\t\tdialogueTemplate.forEach((value, key) => repr += `${ key } = ${ value }, `);\n\t\t\tconsole.log(`Read dialogue: ${ repr }`);\n\t\t}\n\n\t\t// Create the dialogue and add it to the dialogues array\n\t\tthis.dialogues.push(new Dialogue(dialogueTemplate, this));\n\t}\n\n\t/**\n\t * Add an attachment to this ASS script.\n\t *\n\t * @param {!libjass.Attachment} attachment\n\t */\n\taddAttachment(attachment: Attachment): void {\n\t\tthis._attachments.push(attachment);\n\t}\n\n\t/**\n\t * Custom JSON serialization for ASS objects.\n\t *\n\t * @return {!*}\n\t */\n\ttoJSON(): any {\n\t\tconst result = Object.create(null);\n\n\t\tresult._properties = this._properties;\n\n\t\tresult._styles = Object.create(null);\n\t\tthis._styles.forEach((style, name) => result._styles[name] = style);\n\n\t\tresult._dialogues = this._dialogues;\n\t\tresult._attachments = this._attachments;\n\t\tresult._stylesFormatSpecifier = this._stylesFormatSpecifier;\n\t\tresult._dialoguesFormatSpecifier = this._dialoguesFormatSpecifier;\n\n\t\tresult._classTag = (ASS.prototype as any)._classTag;\n\n\t\treturn result;\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { registerClass as serializable } from \"../serialization\";\n\nimport { WrappingStyle } from \"./misc\";\n\n/**\n * This class represents the properties of a {@link libjass.ASS} script.\n */\n@serializable\nexport class ScriptProperties {\n\tprivate _resolutionX: number;\n\tprivate _resolutionY: number;\n\tprivate _wrappingStyle: WrappingStyle;\n\tprivate _scaleBorderAndShadow: boolean;\n\n\t/**\n\t * The horizontal script resolution.\n\t *\n\t * @type {number}\n\t */\n\tget resolutionX(): number {\n\t\treturn this._resolutionX;\n\t}\n\n\t/**\n\t * The horizontal script resolution.\n\t *\n\t * @type {number}\n\t */\n\tset resolutionX(value: number) {\n\t\tthis._resolutionX = value;\n\t}\n\n\t/**\n\t * The vertical script resolution.\n\t *\n\t * @type {number}\n\t */\n\tget resolutionY(): number {\n\t\treturn this._resolutionY;\n\t}\n\n\t/**\n\t * The vertical script resolution.\n\t *\n\t * @type {number}\n\t */\n\tset resolutionY(value: number) {\n\t\tthis._resolutionY = value;\n\t}\n\n\t/**\n\t * The wrap style. One of the {@link libjass.WrappingStyle} constants.\n\t *\n\t * @type {number}\n\t */\n\tget wrappingStyle(): WrappingStyle {\n\t\treturn this._wrappingStyle;\n\t}\n\n\t/**\n\t * The wrap style. One of the {@link libjass.WrappingStyle} constants.\n\t *\n\t * @type {number}\n\t */\n\tset wrappingStyle(value: WrappingStyle) {\n\t\tthis._wrappingStyle = value;\n\t}\n\n\t/**\n\t * Whether to scale outline widths and shadow depths from script resolution to video resolution or not. If true, widths and depths are scaled.\n\t *\n\t * @type {boolean}\n\t */\n\tget scaleBorderAndShadow(): boolean {\n\t\treturn this._scaleBorderAndShadow;\n\t}\n\n\t/**\n\t * Whether to scale outline widths and shadow depths from script resolution to video resolution or not. If true, widths and depths are scaled.\n\t *\n\t * @type {boolean}\n\t */\n\tset scaleBorderAndShadow(value: boolean) {\n\t\tthis._scaleBorderAndShadow = value;\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ASS } from \"./ass\";\nimport { Style } from \"./style\";\n\nimport { valueOrDefault } from \"./misc\";\n\nimport { parse } from \"../parser/parse\";\n\nimport * as parts from \"../parts\";\n\nimport { registerClass as serializable } from \"../serialization\";\n\nimport { debugMode } from \"../settings\";\n\nimport { Map } from \"../utility/map\";\n\n/**\n * This class represents a dialogue in a {@link libjass.ASS} script.\n *\n * @param {!Map.<string, string>} template The template object that contains the dialogue's properties. It is a map of the string values read from the ASS file.\n * @param {string} template[\"Style\"] The name of the default style of this dialogue\n * @param {string} template[\"Start\"] The start time\n * @param {string} template[\"End\"] The end time\n * @param {string} template[\"Layer\"] The layer number\n * @param {string} template[\"Text\"] The text of this dialogue\n * @param {!libjass.ASS} ass The ASS object to which this dialogue belongs\n */\n@serializable\nexport class Dialogue {\n\tprivate static _lastDialogueId: number = -1;\n\n\tprivate _id: number;\n\n\tprivate _style: Style;\n\n\tprivate _start: number;\n\tprivate _end: number;\n\n\tprivate _layer: number;\n\tprivate _alignment: number;\n\n\tprivate _rawPartsString: string;\n\tprivate _parts: parts.Part[] | null = null;\n\n\tprivate _containsTransformTag: boolean = false;\n\n\tconstructor(template: Map<string, string>, ass: ASS) {\n\t\t{\n\t\t\tconst normalizedTemplate = new Map<string, string>();\n\t\t\ttemplate.forEach((value, key) => {\n\t\t\t\tnormalizedTemplate.set(key.toLowerCase(), value);\n\t\t\t});\n\t\t\ttemplate = normalizedTemplate;\n\t\t}\n\n\t\tthis._id = ++Dialogue._lastDialogueId;\n\n\t\tlet styleName = template.get(\"style\");\n\t\tif (typeof styleName === \"string\") {\n\t\t\tstyleName = styleName.replace(/^\\*+/, \"\");\n\t\t\tif (styleName.match(/^Default$/i) !== null) {\n\t\t\t\tstyleName = \"Default\";\n\t\t\t}\n\t\t}\n\n\t\tlet style = (styleName !== undefined) ? ass.styles.get(styleName) : undefined;\n\t\tif (style === undefined) {\n\t\t\tif (debugMode) {\n\t\t\t\tconsole.warn(`Unrecognized style ${ styleName }. Falling back to \"Default\"`);\n\t\t\t}\n\n\t\t\tstyle = ass.styles.get(\"Default\");\n\t\t\tif (style === undefined) {\n\t\t\t\tthrow new Error(`Unrecognized style ${ styleName }. Could not fall back to \"Default\" style since it doesn't exist.`);\n\t\t\t}\n\t\t}\n\t\tthis._style = style;\n\n\t\tconst start = template.get(\"start\");\n\t\tif (typeof start !== \"string\") {\n\t\t\tthrow new Error(`Dialogue start time ${ start } is not a string.`);\n\t\t}\n\t\tthis._start = toTime(start);\n\n\t\tconst end = template.get(\"end\");\n\t\tif (typeof end !== \"string\") {\n\t\t\tthrow new Error(`Dialogue end time ${ end } is not a string.`);\n\t\t}\n\t\tthis._end = toTime(end);\n\n\t\tthis._layer = Math.max(valueOrDefault(template, \"layer\", parseInt, value => !isNaN(value), \"0\"), 0);\n\n\t\tconst text = template.get(\"text\");\n\t\tif (typeof text !== \"string\") {\n\t\t\tthrow new Error(`Dialogue text ${ text } is not a string.`);\n\t\t}\n\t\tthis._rawPartsString = text;\n\t}\n\n\t/**\n\t * The unique ID of this dialogue. Auto-generated.\n\t *\n\t * @type {number}\n\t */\n\tget id(): number {\n\t\treturn this._id;\n\t}\n\n\t/**\n\t * The start time of this dialogue.\n\t *\n\t * @type {number}\n\t */\n\tget start(): number {\n\t\treturn this._start;\n\t}\n\n\t/**\n\t * The end time of this dialogue.\n\t *\n\t * @type {number}\n\t */\n\tget end(): number {\n\t\treturn this._end;\n\t}\n\n\t/**\n\t * The default style of this dialogue.\n\t *\n\t * @type {!libjass.Style}\n\t */\n\tget style(): Style {\n\t\treturn this._style;\n\t}\n\n\t/**\n\t * The alignment number of this dialogue.\n\t *\n\t * @type {number}\n\t */\n\tget alignment(): number {\n\t\tif (this._parts === null) {\n\t\t\tthis._parsePartsString();\n\t\t}\n\n\t\treturn this._alignment;\n\t}\n\n\t/**\n\t * The layer number of this dialogue.\n\t *\n\t * @type {number}\n\t */\n\tget layer(): number {\n\t\treturn this._layer;\n\t}\n\n\t/**\n\t * The {@link libjass.parts} of this dialogue.\n\t *\n\t * @type {!Array.<!libjass.parts.Part>}\n\t */\n\tget parts(): parts.Part[] {\n\t\tif (this._parts === null) {\n\t\t\tthis._parsePartsString();\n\t\t}\n\n\t\treturn this._parts!;\n\t}\n\n\t/**\n\t * Convenience getter for whether this dialogue contains a {\\t} tag.\n\t *\n\t * @type {boolean}\n\t */\n\tget containsTransformTag(): boolean {\n\t\tif (this._parts === null) {\n\t\t\tthis._parsePartsString();\n\t\t}\n\n\t\treturn this._containsTransformTag;\n\t}\n\n\t/**\n\t * @return {string} A simple representation of this dialogue's properties and parts.\n\t */\n\ttoString(): string {\n\t\treturn `#${ this._id } [${ this._start.toFixed(3) }-${ this._end.toFixed(3) }] ${ (this._parts !== null) ? this._parts.join(\", \") : this._rawPartsString }`;\n\t}\n\n\t/**\n\t * Parses this dialogue's parts from the raw parts string.\n\t */\n\tprivate _parsePartsString(): void {\n\t\tthis._parts = parse(this._rawPartsString, \"dialogueParts\") as parts.Part[];\n\n\t\tthis._alignment = this._style.alignment;\n\n\t\tthis._parts.forEach((part, index) => {\n\t\t\tif (part instanceof parts.Alignment) {\n\t\t\t\tthis._alignment = part.value;\n\t\t\t}\n\t\t\telse if (part instanceof parts.Move) {\n\t\t\t\tif (part.t1 === null || part.t2 === null) {\n\t\t\t\t\tthis._parts![index] =\n\t\t\t\t\t\tnew parts.Move(\n\t\t\t\t\t\t\tpart.x1, part.y1, part.x2, part.y2,\n\t\t\t\t\t\t\t0, this._end - this._start\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (part instanceof parts.Transform) {\n\t\t\t\tif (part.start === null || part.end === null || part.accel === null) {\n\t\t\t\t\tthis._parts![index] =\n\t\t\t\t\t\tnew parts.Transform(\n\t\t\t\t\t\t\t(part.start === null) ? 0 : part.start,\n\t\t\t\t\t\t\t(part.end === null) ? (this._end - this._start) : part.end,\n\t\t\t\t\t\t\t(part.accel === null) ? 1 : part.accel,\n\t\t\t\t\t\t\tpart.tags\n\t\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis._containsTransformTag = true;\n\t\t\t}\n\t\t});\n\n\t\tif (debugMode) {\n\t\t\tconst possiblyIncorrectParses = this._parts.filter(part => part instanceof parts.Comment && part.value.indexOf(\"\\\\\") !== -1);\n\t\t\tif (possiblyIncorrectParses.length > 0) {\n\t\t\t\tconsole.warn(\n`Possible incorrect parse:\n${ this._rawPartsString }\nwas parsed as\n${ this.toString() }\nThe possibly incorrect parses are:\n${ possiblyIncorrectParses.join(\"\\n\") }`\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Converts this string into the number of seconds it represents. This string must be in the form of hh:mm:ss.MMM\n *\n * @param {string} str\n * @return {number}\n */\nfunction toTime(str: string): number {\n\treturn str.split(\":\").reduce<number>((previousValue, currentValue) => previousValue * 60 + parseFloat(currentValue), 0);\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { parse } from \"../parser/parse\";\n\nimport { Color } from \"../parts\";\n\nimport { registerClass as serializable } from \"../serialization\";\n\nimport { Map } from \"../utility/map\";\n\nimport { BorderStyle, valueOrDefault } from \"./misc\";\n\n/**\n * This class represents a single global style declaration in a {@link libjass.ASS} script. The styles can be obtained via the {@link libjass.ASS.styles} property.\n *\n * @param {!Map.<string, string>} template The template object that contains the style's properties. It is a map of the string values read from the ASS file.\n * @param {string} template[\"Name\"] The name of the style\n * @param {string} template[\"Italic\"] -1 if the style is italicized\n * @param {string} template[\"Bold\"] -1 if the style is bold\n * @param {string} template[\"Underline\"] -1 if the style is underlined\n * @param {string} template[\"StrikeOut\"] -1 if the style is struck-through\n * @param {string} template[\"Fontname\"] The name of the font\n * @param {string} template[\"Fontsize\"] The size of the font\n * @param {string} template[\"ScaleX\"] The horizontal scaling of the font\n * @param {string} template[\"ScaleY\"] The vertical scaling of the font\n * @param {string} template[\"Spacing\"] The letter spacing of the font\n * @param {string} template[\"PrimaryColour\"] The primary color\n * @param {string} template[\"OutlineColour\"] The outline color\n * @param {string} template[\"BackColour\"] The shadow color\n * @param {string} template[\"Outline\"] The outline thickness\n * @param {string} template[\"Shadow\"] The shadow depth\n * @param {string} template[\"Alignment\"] The alignment number\n * @param {string} template[\"MarginL\"] The left margin\n * @param {string} template[\"MarginR\"] The right margin\n * @param {string} template[\"MarginV\"] The vertical margin\n */\n@serializable\nexport class Style {\n\tprivate _name: string;\n\n\tprivate _italic: boolean;\n\tprivate _bold: boolean;\n\tprivate _underline: boolean;\n\tprivate _strikeThrough: boolean;\n\n\tprivate _fontName: string;\n\tprivate _fontSize: number;\n\n\tprivate _fontScaleX: number;\n\tprivate _fontScaleY: number;\n\n\tprivate _letterSpacing: number;\n\n\tprivate _rotationZ: number;\n\n\tprivate _primaryColor: Color;\n\tprivate _secondaryColor: Color;\n\tprivate _outlineColor: Color;\n\tprivate _shadowColor: Color;\n\n\tprivate _outlineThickness: number;\n\tprivate _borderStyle: BorderStyle;\n\n\tprivate _shadowDepth: number;\n\n\tprivate _alignment: number;\n\n\tprivate _marginLeft: number;\n\tprivate _marginRight: number;\n\tprivate _marginVertical: number;\n\n\tconstructor(template: Map<string, string>) {\n\t\t{\n\t\t\tconst normalizedTemplate = new Map<string, string>();\n\t\t\ttemplate.forEach((value, key) => {\n\t\t\t\tnormalizedTemplate.set(key.toLowerCase(), value);\n\t\t\t});\n\t\t\ttemplate = normalizedTemplate;\n\t\t}\n\n\t\tconst name = template.get(\"name\");\n\t\tif (typeof name !== \"string\") {\n\t\t\tthrow new Error(`Style name ${ name } is not a string.`);\n\t\t}\n\t\tthis._name = name.replace(/^\\*+/, \"\");\n\n\t\tthis._italic = !!valueOrDefault(template, \"italic\", parseFloat, value => !isNaN(value), \"0\");\n\t\tthis._bold = !!valueOrDefault(template, \"bold\", parseFloat, value => !isNaN(value), \"0\");\n\t\tthis._underline = !!valueOrDefault(template, \"underline\", parseFloat, value => !isNaN(value), \"0\");\n\t\tthis._strikeThrough = !!valueOrDefault(template, \"strikeout\", parseFloat, value => !isNaN(value), \"0\");\n\n\t\tthis._fontName = valueOrDefault(template, \"fontname\", str => str, value => value.constructor === String, \"sans-serif\");\n\t\tthis._fontSize = valueOrDefault(template, \"fontsize\", parseFloat, value => !isNaN(value), \"18\");\n\n\t\tthis._fontScaleX = valueOrDefault(template, \"scalex\", parseFloat, value => value >= 0, \"100\") / 100;\n\t\tthis._fontScaleY = valueOrDefault(template, \"scaley\", parseFloat, value => value >= 0, \"100\") / 100;\n\n\t\tthis._letterSpacing = valueOrDefault(template, \"spacing\", parseFloat, value => value >= 0, \"0\");\n\n\t\tthis._rotationZ = valueOrDefault(template, \"angle\", parseFloat, value => !isNaN(value), \"0\");\n\n\t\tthis._primaryColor = valueOrDefault(template, \"primarycolour\", str => parse(str, \"colorWithAlpha\") as Color, null, \"&H00FFFFFF\");\n\t\tthis._secondaryColor = valueOrDefault(template, \"secondarycolour\", str => parse(str, \"colorWithAlpha\") as Color, null, \"&H00FFFF00\");\n\t\tthis._outlineColor = valueOrDefault(template, \"outlinecolour\", str => parse(str, \"colorWithAlpha\") as Color, null, \"&H00000000\");\n\t\tthis._shadowColor = valueOrDefault(template, \"backcolour\", str => parse(str, \"colorWithAlpha\") as Color, null, \"&H80000000\");\n\n\t\tthis._outlineThickness = valueOrDefault(template, \"outline\", parseFloat, value => value >= 0, \"2\");\n\t\tthis._borderStyle = valueOrDefault(template, \"borderstyle\", parseInt, value => (BorderStyle as any)[(BorderStyle as any)[value]] === value, \"1\");\n\n\t\tthis._shadowDepth = valueOrDefault(template, \"shadow\", parseFloat, value => value >= 0, \"3\");\n\n\t\tthis._alignment = valueOrDefault(template, \"alignment\", parseInt, value => value >= 1 && value <= 9, \"2\");\n\n\t\tthis._marginLeft = valueOrDefault(template, \"marginl\", parseFloat, value => !isNaN(value), \"20\");\n\t\tthis._marginRight = valueOrDefault(template, \"marginr\", parseFloat, value => !isNaN(value), \"20\");\n\t\tthis._marginVertical = valueOrDefault(template, \"marginv\", parseFloat, value => !isNaN(value), \"20\");\n\t}\n\n\t/**\n\t * The name of this style.\n\t *\n\t * @type {string}\n\t */\n\tget name(): string {\n\t\treturn this._name;\n\t}\n\n\t/**\n\t * Whether this style is italicized or not.\n\t *\n\t * @type {string}\n\t */\n\tget italic(): boolean {\n\t\treturn this._italic;\n\t}\n\n\t/**\n\t * Whether this style is bold or not.\n\t *\n\t * @type {boolean}\n\t */\n\tget bold(): boolean {\n\t\treturn this._bold;\n\t}\n\n\t/**\n\t * Whether this style is underlined or not.\n\t *\n\t * @type {boolean}\n\t */\n\tget underline(): boolean {\n\t\treturn this._underline;\n\t}\n\n\t/**\n\t * Whether this style is struck-through or not.\n\t *\n\t * @type {boolean}\n\t */\n\tget strikeThrough(): boolean {\n\t\treturn this._strikeThrough;\n\t}\n\n\t/**\n\t * The name of this style's font.\n\t *\n\t * @type {string}\n\t */\n\tget fontName(): string {\n\t\treturn this._fontName;\n\t}\n\n\t/**\n\t * The size of this style's font.\n\t *\n\t * @type {number}\n\t */\n\tget fontSize(): number {\n\t\treturn this._fontSize;\n\t}\n\n\t/**\n\t * The horizontal scaling of this style's font.\n\t *\n\t * @type {number}\n\t */\n\tget fontScaleX(): number {\n\t\treturn this._fontScaleX;\n\t}\n\n\t/**\n\t * The vertical scaling of this style's font.\n\t *\n\t * @type {number}\n\t */\n\tget fontScaleY(): number {\n\t\treturn this._fontScaleY;\n\t}\n\n\t/**\n\t * The letter spacing scaling of this style's font.\n\t *\n\t * @type {number}\n\t */\n\tget letterSpacing(): number {\n\t\treturn this._letterSpacing;\n\t}\n\n\t/**\n\t * The default Z-rotation of this style.\n\t *\n\t * @type {number}\n\t */\n\tget rotationZ(): number {\n\t\treturn this._rotationZ;\n\t}\n\n\t/**\n\t * The color of this style's font.\n\t *\n\t * @type {!libjass.parts.Color}\n\t */\n\tget primaryColor(): Color {\n\t\treturn this._primaryColor;\n\t}\n\n\t/**\n\t * The alternate color of this style's font, used in karaoke.\n\t *\n\t * @type {!libjass.parts.Color}\n\t */\n\tget secondaryColor(): Color {\n\t\treturn this._secondaryColor;\n\t}\n\n\t/**\n\t * The color of this style's outline.\n\t *\n\t * @type {!libjass.parts.Color}\n\t */\n\tget outlineColor(): Color {\n\t\treturn this._outlineColor;\n\t}\n\n\t/**\n\t * The color of this style's shadow.\n\t *\n\t * @type {!libjass.parts.Color}\n\t */\n\tget shadowColor(): Color {\n\t\treturn this._shadowColor;\n\t}\n\n\t/**\n\t * The thickness of this style's outline.\n\t *\n\t * @type {number}\n\t */\n\tget outlineThickness(): number {\n\t\treturn this._outlineThickness;\n\t}\n\n\t/**\n\t * The border style of this style.\n\t *\n\t * @type {number}\n\t */\n\tget borderStyle(): BorderStyle {\n\t\treturn this._borderStyle;\n\t}\n\n\t/**\n\t * The depth of this style's shadow.\n\t *\n\t * @type {number}\n\t */\n\tget shadowDepth(): number {\n\t\treturn this._shadowDepth;\n\t}\n\n\t/**\n\t * The alignment of dialogues of this style.\n\t *\n\t * @type {number}\n\t */\n\tget alignment(): number {\n\t\treturn this._alignment;\n\t}\n\n\t/**\n\t * The left margin of dialogues of this style.\n\t *\n\t * @type {number}\n\t */\n\tget marginLeft(): number {\n\t\treturn this._marginLeft;\n\t}\n\n\t/**\n\t * The right margin of dialogues of this style.\n\t *\n\t * @type {number}\n\t */\n\tget marginRight(): number {\n\t\treturn this._marginRight;\n\t}\n\n\t/**\n\t * The vertical margin of dialogues of this style.\n\t *\n\t * @type {number}\n\t */\n\tget marginVertical(): number {\n\t\treturn this._marginVertical;\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { registerClass as serializable } from \"../serialization\";\n\n/**\n * The type of an attachment.\n */\nexport enum AttachmentType {\n\tFont,\n\tGraphic,\n}\n\n/**\n * This class represents an attachment in a {@link libjass.ASS} script.\n *\n * @param {string} filename The filename of this attachment.\n * @param {number} type The type of this attachment.\n */\n@serializable\nexport class Attachment {\n\tprivate _contents: string = \"\";\n\n\tconstructor(private _filename: string, private _type: AttachmentType) { }\n\n\t/**\n\t * The filename of this attachment.\n\t *\n\t * @type {number}\n\t */\n\tget filename(): string {\n\t\treturn this._filename;\n\t}\n\n\t/**\n\t * The type of this attachment.\n\t *\n\t * @type {number}\n\t */\n\tget type(): AttachmentType {\n\t\treturn this._type;\n\t}\n\n\t/**\n\t * The contents of this attachment in base64 encoding.\n\t *\n\t * @type {number}\n\t */\n\tget contents(): string {\n\t\treturn this._contents;\n\t}\n\n\t/**\n\t * The contents of this attachment in base64 encoding.\n\t *\n\t * @type {number}\n\t */\n\tset contents(value: string) {\n\t\tthis._contents = value;\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Property, TypedTemplate } from \"../types/misc\";\n\nimport { Map } from \"../utility/map\";\n\n/**\n * Parses a line into a {@link ./types/misc.Property}.\n *\n * @param {string} line\n * @return {Property}\n */\nexport function parseLineIntoProperty(line: string): Property | null {\n\tconst colonPos = line.indexOf(\":\");\n\tif (colonPos === -1) {\n\t\treturn null;\n\t}\n\n\tconst name = line.substr(0, colonPos);\n\tconst value = line.substr(colonPos + 1).replace(/^\\s+/, \"\");\n\n\treturn { name, value };\n}\n\n/**\n * Parses a line into a {@link ./types/misc.TypedTemplate} according to the given format specifier.\n *\n * @param {string} line\n * @param {!Array.<string>} formatSpecifier\n * @return {TypedTemplate}\n */\nexport function parseLineIntoTypedTemplate(line: string, formatSpecifier: string[]): TypedTemplate | null {\n\tconst property = parseLineIntoProperty(line);\n\tif (property === null) {\n\t\treturn null;\n\t}\n\n\tconst value = property.value.split(\",\");\n\n\tif (value.length > formatSpecifier.length) {\n\t\tvalue[formatSpecifier.length - 1] = value.slice(formatSpecifier.length - 1).join(\",\");\n\t}\n\n\tconst template = new Map<string, string>();\n\tformatSpecifier.forEach((formatKey, index) => {\n\t\ttemplate.set(formatKey, value[index]);\n\t});\n\n\treturn { type: property.name, template };\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DeferredPromise, Promise } from \"../utility/promise\";\n\nexport interface ReadableStream {\n\t/**\n\t * @return {!ReadableStreamReader}\n\t */\n\tgetReader(): ReadableStreamReader;\n}\n\nexport interface ReadableStreamReader {\n\t/**\n\t * @return {!Promise.<{ value?: Uint8Array, done: boolean }>}\n\t */\n\tread(): Promise<{ value: Uint8Array; done: boolean; }>;\n}\n\nexport interface TextDecoder {\n\t/**\n\t * @param {!ArrayBuffer|!ArrayBufferView} input\n\t * @param {{ stream: boolean }} options\n\t * @return {string}\n\t */\n\tdecode(input: ArrayBuffer | ArrayBufferView, options: { stream: boolean }): string;\n}\nexport interface TextDecoderConstructor {\n\tnew (encoding: string, options: { ignoreBOM: boolean }): TextDecoder;\n\n\t/**\n\t * @type {!TextDecoder}\n\t */\n\tprototype: TextDecoder;\n}\n\ndeclare const global: {\n\t/**\n\t * @type {!TextDecoderConstructor}\n\t */\n\tTextDecoder?: TextDecoderConstructor;\n};\n\n/**\n * An interface for a stream.\n */\nexport interface Stream {\n\t/**\n\t * @return {!Promise.<?string>} A promise that will be resolved with the next line, or null if the stream is exhausted.\n\t */\n\tnextLine(): Promise<string | null>;\n}\n\n/**\n * A {@link libjass.parser.Stream} that reads from a string in memory.\n *\n * @param {string} str The string\n */\nexport class StringStream implements Stream {\n\tprivate _readTill: number = 0;\n\n\tconstructor(private _str: string) { }\n\n\t/**\n\t * @return {!Promise.<?string>} A promise that will be resolved with the next line, or null if the string has been completely read.\n\t */\n\tnextLine(): Promise<string | null> {\n\t\tlet result: Promise<string | null>;\n\n\t\tif (this._readTill < this._str.length) {\n\t\t\tconst nextNewLinePos = this._str.indexOf(\"\\n\", this._readTill);\n\t\t\tif (nextNewLinePos !== -1) {\n\t\t\t\tresult = Promise.resolve(this._str.substring(this._readTill, nextNewLinePos));\n\t\t\t\tthis._readTill = nextNewLinePos + 1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tresult = Promise.resolve(this._str.substr(this._readTill));\n\t\t\t\tthis._readTill = this._str.length;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tresult = Promise.resolve<string | null>(null);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\n/**\n * A {@link libjass.parser.Stream} that reads from an XMLHttpRequest object.\n *\n * @param {!XMLHttpRequest} xhr The XMLHttpRequest object. Make sure to not call .open() on this object before passing it in here,\n * since event handlers cannot be registered after open() has been called.\n */\nexport class XhrStream implements Stream {\n\tprivate _readTill: number = 0;\n\tprivate _pendingDeferred: DeferredPromise<string | null> | null = null;\n\tprivate _failedError: ErrorEvent | null = null;\n\n\tconstructor(private _xhr: XMLHttpRequest) {\n\t\t_xhr.addEventListener(\"progress\", () => this._onXhrProgress(), false);\n\t\t_xhr.addEventListener(\"load\", () => this._onXhrLoad(), false);\n\t\t_xhr.addEventListener(\"error\", event => this._onXhrError(event), false);\n\t}\n\n\t/**\n\t * @return {!Promise.<?string>} A promise that will be resolved with the next line, or null if the stream is exhausted.\n\t */\n\tnextLine(): Promise<string> {\n\t\tif (this._pendingDeferred !== null) {\n\t\t\tthrow new Error(\"XhrStream only supports one pending unfulfilled read at a time.\");\n\t\t}\n\n\t\tconst deferred = this._pendingDeferred = new DeferredPromise<string>();\n\n\t\tthis._tryResolveNextLine();\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t */\n\tprivate _onXhrProgress(): void {\n\t\tif (this._pendingDeferred === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._xhr.readyState === XMLHttpRequest.DONE) {\n\t\t\t/* Suppress resolving next line here. Let the \"load\" or \"error\" event handlers do it.\n\t\t\t *\n\t\t\t * This is required because a failed XHR fires the progress event with readyState === DONE before it fires the error event.\n\t\t\t * This would confuse _tryResolveNextLine() into thinking the request succeeded with no data if it was called here.\n\t\t\t */\n\t\t\treturn;\n\t\t}\n\n\t\tthis._tryResolveNextLine();\n\t}\n\n\t/**\n\t */\n\tprivate _onXhrLoad(): void {\n\t\tif (this._pendingDeferred === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._tryResolveNextLine();\n\t}\n\n\t/**\n\t * @param {!ErrorEvent} event\n\t */\n\tprivate _onXhrError(event: ErrorEvent): void {\n\t\tthis._failedError = event;\n\n\t\tif (this._pendingDeferred === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._tryResolveNextLine();\n\t}\n\n\t/**\n\t */\n\tprivate _tryResolveNextLine(): void {\n\t\tif (this._failedError !== null) {\n\t\t\tthis._pendingDeferred!.reject(this._failedError);\n\t\t\treturn;\n\t\t}\n\n\t\tconst response = this._xhr.responseText;\n\n\t\tconst nextNewLinePos = response.indexOf(\"\\n\", this._readTill);\n\t\tif (nextNewLinePos !== -1) {\n\t\t\tthis._pendingDeferred!.resolve(response.substring(this._readTill, nextNewLinePos));\n\t\t\tthis._readTill = nextNewLinePos + 1;\n\t\t\tthis._pendingDeferred = null;\n\t\t}\n\n\t\telse if (this._xhr.readyState === XMLHttpRequest.DONE) {\n\t\t\tif (this._failedError !== null) {\n\t\t\t\tthis._pendingDeferred!.reject(this._failedError);\n\t\t\t}\n\n\t\t\t// No more data. This is the last line.\n\t\t\telse if (this._readTill < response.length) {\n\t\t\t\tthis._pendingDeferred!.resolve(response.substr(this._readTill));\n\t\t\t\tthis._readTill = response.length;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._pendingDeferred!.resolve(null);\n\t\t\t}\n\n\t\t\tthis._pendingDeferred = null;\n\t\t}\n\t}\n}\n\n/**\n * A {@link libjass.parser.Stream} that reads from a ReadableStream object.\n *\n * @param {!ReadableStream} stream\n * @param {string} encoding\n */\nexport class BrowserReadableStream implements Stream {\n\tprivate _reader: ReadableStreamReader;\n\tprivate _decoder: TextDecoder;\n\tprivate _buffer: string = \"\";\n\tprivate _pendingDeferred: DeferredPromise<string | null> | null = null;\n\n\tconstructor(stream: ReadableStream, encoding: string) {\n\t\tthis._reader = stream.getReader();\n\t\tthis._decoder = new global.TextDecoder!(encoding, { ignoreBOM: true });\n\t}\n\n\t/**\n\t * @return {!Promise.<?string>} A promise that will be resolved with the next line, or null if the stream is exhausted.\n\t */\n\tnextLine(): Promise<string> {\n\t\tif (this._pendingDeferred !== null) {\n\t\t\tthrow new Error(\"BrowserReadableStream only supports one pending unfulfilled read at a time.\");\n\t\t}\n\n\t\tconst deferred = this._pendingDeferred = new DeferredPromise<string>();\n\n\t\tthis._tryResolveNextLine();\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t */\n\tprivate _tryResolveNextLine(): void {\n\t\tconst nextNewLinePos = this._buffer.indexOf(\"\\n\");\n\t\tif (nextNewLinePos !== -1) {\n\t\t\tthis._pendingDeferred!.resolve(this._buffer.substr(0, nextNewLinePos));\n\t\t\tthis._buffer = this._buffer.substr(nextNewLinePos + 1);\n\t\t\tthis._pendingDeferred = null;\n\t\t}\n\n\t\telse {\n\t\t\tthis._reader.read().then(next => {\n\t\t\t\tconst { value, done } = next;\n\n\t\t\t\tif (!done) {\n\t\t\t\t\tthis._buffer += this._decoder.decode(value, { stream: true });\n\t\t\t\t\tthis._tryResolveNextLine();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// No more data.\n\t\t\t\t\tif (this._buffer.length === 0) {\n\t\t\t\t\t\tthis._pendingDeferred!.resolve(null);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis._pendingDeferred!.resolve(this._buffer);\n\t\t\t\t\t\tthis._buffer = \"\";\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._pendingDeferred = null;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as parts from \"../parts\";\n\nimport { debugMode } from \"../settings\";\n\nimport { Map } from \"../utility/map\";\n\nconst rules = new Map<string, (parent: ParseNode) => ParseNode>();\n\n/**\n * Parses a given string with the specified rule.\n *\n * @param {string} input The string to be parsed.\n * @param {string} rule The rule to parse the string with\n * @return {*} The value returned depends on the rule used.\n */\nexport function parse(input: string, rule: string): any {\n\tconst { result } = new ParserRun(input, rule);\n\n\tif (result === null || result.end !== input.length) {\n\t\tif (debugMode) {\n\t\t\tconsole.error(\"Parse failed. %s %s %o\", rule, input, result);\n\t\t}\n\n\t\tthrow new Error(\"Parse failed.\");\n\t}\n\n\treturn result.value;\n}\n\n/**\n * This class represents a single run of the parser.\n *\n * @param {string} input\n * @param {string} rule\n */\nclass ParserRun {\n\tprivate _parseTree: ParseNode;\n\tprivate _result: ParseNode;\n\n\tconstructor(private _input: string, rule: string) {\n\t\tconst ruleFunction = rules.get(rule);\n\t\tif (ruleFunction === undefined) {\n\t\t\tthrow new Error(`Could not find parser rule named ${ rule }`);\n\t\t}\n\n\t\tthis._parseTree = new ParseNode(null);\n\n\t\tthis._result = ruleFunction.call(this, this._parseTree);\n\t}\n\n\t/**\n\t * @type {ParseNode}\n\t */\n\tget result(): ParseNode | null {\n\t\treturn this._result;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_dialogueParts(parent: ParseNode): ParseNode {\n\t\tconst current = new ParseNode(parent);\n\n\t\tcurrent.value = [];\n\n\t\twhile (this._haveMore()) {\n\t\t\tconst enclosedTagsNode = this.parse_enclosedTags(current);\n\n\t\t\tif (enclosedTagsNode !== null) {\n\t\t\t\tcurrent.value.push(...enclosedTagsNode.value);\n\t\t\t}\n\n\t\t\telse {\n\t\t\t\tconst whiteSpaceOrTextNode = this.parse_newline(current) || this.parse_hardspace(current) || this.parse_text(current);\n\n\t\t\t\tif (whiteSpaceOrTextNode.value instanceof parts.Text && current.value[current.value.length - 1] instanceof parts.Text) {\n\t\t\t\t\t// Merge consecutive text parts into one part\n\t\t\t\t\tconst previousTextPart = current.value[current.value.length - 1] as parts.Text;\n\t\t\t\t\tcurrent.value[current.value.length - 1] = new parts.Text(previousTextPart.value + (whiteSpaceOrTextNode.value as parts.Text).value);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcurrent.value.push(whiteSpaceOrTextNode.value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tlet inDrawingMode = false;\n\n\t\tcurrent.value.forEach((part: parts.Part, i: number) => {\n\t\t\tif (part instanceof parts.DrawingMode) {\n\t\t\t\tinDrawingMode = part.scale !== 0;\n\t\t\t}\n\n\t\t\telse if (part instanceof parts.Text && inDrawingMode) {\n\t\t\t\tcurrent.value[i] = new parts.DrawingInstructions(parse(part.value, \"drawingInstructions\") as parts.drawing.Instruction[]);\n\t\t\t}\n\t\t});\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_enclosedTags(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tcurrent.value = [];\n\n\t\tif (this.read(current, \"{\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tfor (let next = this._peek(); this._haveMore() && next !== \"}\"; next = this._peek()) {\n\t\t\tlet childNode: ParseNode | null = null;\n\n\t\t\tif (this.read(current, \"\\\\\") !== null) {\n\t\t\t\tchildNode =\n\t\t\t\t\tthis.parse_tag_alpha(current) ||\n\t\t\t\t\tthis.parse_tag_iclip(current) ||\n\t\t\t\t\tthis.parse_tag_xbord(current) ||\n\t\t\t\t\tthis.parse_tag_ybord(current) ||\n\t\t\t\t\tthis.parse_tag_xshad(current) ||\n\t\t\t\t\tthis.parse_tag_yshad(current) ||\n\n\t\t\t\t\tthis.parse_tag_blur(current) ||\n\t\t\t\t\tthis.parse_tag_bord(current) ||\n\t\t\t\t\tthis.parse_tag_clip(current) ||\n\t\t\t\t\tthis.parse_tag_fade(current) ||\n\t\t\t\t\tthis.parse_tag_fscx(current) ||\n\t\t\t\t\tthis.parse_tag_fscy(current) ||\n\t\t\t\t\tthis.parse_tag_move(current) ||\n\t\t\t\t\tthis.parse_tag_shad(current) ||\n\n\t\t\t\t\tthis.parse_tag_fad(current) ||\n\t\t\t\t\tthis.parse_tag_fax(current) ||\n\t\t\t\t\tthis.parse_tag_fay(current) ||\n\t\t\t\t\tthis.parse_tag_frx(current) ||\n\t\t\t\t\tthis.parse_tag_fry(current) ||\n\t\t\t\t\tthis.parse_tag_frz(current) ||\n\t\t\t\t\tthis.parse_tag_fsp(current) ||\n\t\t\t\t\tthis.parse_tag_fsplus(current) ||\n\t\t\t\t\tthis.parse_tag_fsminus(current) ||\n\t\t\t\t\tthis.parse_tag_org(current) ||\n\t\t\t\t\tthis.parse_tag_pbo(current) ||\n\t\t\t\t\tthis.parse_tag_pos(current) ||\n\n\t\t\t\t\tthis.parse_tag_an(current) ||\n\t\t\t\t\tthis.parse_tag_be(current) ||\n\t\t\t\t\tthis.parse_tag_fn(current) ||\n\t\t\t\t\tthis.parse_tag_fr(current) ||\n\t\t\t\t\tthis.parse_tag_fs(current) ||\n\t\t\t\t\tthis.parse_tag_kf(current) ||\n\t\t\t\t\tthis.parse_tag_ko(current) ||\n\t\t\t\t\tthis.parse_tag_1a(current) ||\n\t\t\t\t\tthis.parse_tag_1c(current) ||\n\t\t\t\t\tthis.parse_tag_2a(current) ||\n\t\t\t\t\tthis.parse_tag_2c(current) ||\n\t\t\t\t\tthis.parse_tag_3a(current) ||\n\t\t\t\t\tthis.parse_tag_3c(current) ||\n\t\t\t\t\tthis.parse_tag_4a(current) ||\n\t\t\t\t\tthis.parse_tag_4c(current) ||\n\n\t\t\t\t\tthis.parse_tag_a(current) ||\n\t\t\t\t\tthis.parse_tag_b(current) ||\n\t\t\t\t\tthis.parse_tag_c(current) ||\n\t\t\t\t\tthis.parse_tag_i(current) ||\n\t\t\t\t\tthis.parse_tag_k(current) ||\n\t\t\t\t\tthis.parse_tag_K(current) ||\n\t\t\t\t\tthis.parse_tag_p(current) ||\n\t\t\t\t\tthis.parse_tag_q(current) ||\n\t\t\t\t\tthis.parse_tag_r(current) ||\n\t\t\t\t\tthis.parse_tag_s(current) ||\n\t\t\t\t\tthis.parse_tag_t(current) ||\n\t\t\t\t\tthis.parse_tag_u(current);\n\n\t\t\t\tif (childNode === null) {\n\t\t\t\t\tcurrent.pop(); // Unread backslash\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (childNode === null) {\n\t\t\t\tchildNode = this.parse_comment(current);\n\t\t\t}\n\n\t\t\tif (childNode !== null) {\n\t\t\t\tif (childNode.value instanceof parts.Comment && current.value[current.value.length - 1] instanceof parts.Comment) {\n\t\t\t\t\t// Merge consecutive comment parts into one part\n\t\t\t\t\tcurrent.value[current.value.length - 1] =\n\t\t\t\t\t\tnew parts.Comment(\n\t\t\t\t\t\t\t(current.value[current.value.length - 1] as parts.Comment).value +\n\t\t\t\t\t\t\t(childNode.value as parts.Comment).value\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcurrent.value.push(childNode.value);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.read(current, \"}\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_newline(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"\\\\N\") === null && this.read(current, \"\\\\n\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.NewLine();\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_hardspace(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"\\\\h\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.Text(\"\\u00A0\");\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_text(parent: ParseNode): ParseNode {\n\t\tconst value = this._peek();\n\n\t\tconst current = new ParseNode(parent);\n\t\tconst valueNode = new ParseNode(current, value);\n\n\t\tcurrent.value = new parts.Text(valueNode.value);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_comment(parent: ParseNode): ParseNode {\n\t\tconst value = this._peek();\n\n\t\tconst current = new ParseNode(parent);\n\t\tconst valueNode = new ParseNode(current, value);\n\n\t\tcurrent.value = new parts.Comment(valueNode.value);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_a(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"a\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tlet next = this._peek();\n\n\t\tswitch (next) {\n\t\t\tcase \"1\":\n\t\t\t\tconst next2 = this._peek(2);\n\n\t\t\t\tswitch (next2) {\n\t\t\t\t\tcase \"10\":\n\t\t\t\t\tcase \"11\":\n\t\t\t\t\t\tnext = next2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"2\":\n\t\t\tcase \"3\":\n\t\t\tcase \"5\":\n\t\t\tcase \"6\":\n\t\t\tcase \"7\":\n\t\t\tcase \"9\":\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = new ParseNode(current, next);\n\n\t\tlet value: number = -1;\n\t\tswitch ((valueNode.value)) {\n\t\t\tcase \"1\":\n\t\t\t\tvalue = 1;\n\t\t\t\tbreak;\n\n\t\t\tcase \"2\":\n\t\t\t\tvalue = 2;\n\t\t\t\tbreak;\n\n\t\t\tcase \"3\":\n\t\t\t\tvalue = 3;\n\t\t\t\tbreak;\n\n\t\t\tcase \"5\":\n\t\t\t\tvalue = 7;\n\t\t\t\tbreak;\n\n\t\t\tcase \"6\":\n\t\t\t\tvalue = 8;\n\t\t\t\tbreak;\n\n\t\t\tcase \"7\":\n\t\t\t\tvalue = 9;\n\t\t\t\tbreak;\n\n\t\t\tcase \"9\":\n\t\t\t\tvalue = 4;\n\t\t\t\tbreak;\n\n\t\t\tcase \"10\":\n\t\t\t\tvalue = 5;\n\t\t\t\tbreak;\n\n\t\t\tcase \"11\":\n\t\t\t\tvalue = 6;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tcurrent.value = new parts.Alignment(value);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_alpha(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_an(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"an\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst next = this._peek();\n\n\t\tif (next < \"1\" || next > \"9\") {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = new ParseNode(current, next);\n\n\t\tcurrent.value = new parts.Alignment(parseInt(valueNode.value));\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_b(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"b\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tlet valueNode: ParseNode | null = null;\n\n\t\tlet next = this._peek();\n\n\t\tif (next >= \"1\" && next <= \"9\") {\n\t\t\tnext = this._peek(3);\n\t\t\tif (next.substr(1) === \"00\") {\n\t\t\t\tvalueNode = new ParseNode(current, next);\n\t\t\t\tvalueNode.value = parseInt(valueNode.value);\n\t\t\t}\n\t\t}\n\n\t\tif (valueNode === null) {\n\t\t\tvalueNode = this.parse_enableDisable(current);\n\t\t}\n\n\t\tif (valueNode !== null) {\n\t\t\tcurrent.value = new parts.Bold(valueNode.value);\n\t\t}\n\t\telse {\n\t\t\tcurrent.value = new parts.Bold(null);\n\t\t}\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_be(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_blur(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_bord(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_c(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_clip(parent: ParseNode): ParseNode | null {\n\t\treturn this._parse_tag_clip_or_iclip(\"clip\", parent);\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fad(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"fad\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \"(\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst startNode = this.parse_decimal(current);\n\t\tif (startNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst endNode = this.parse_decimal(current);\n\t\tif (endNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \")\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.Fade(startNode.value / 1000, endNode.value / 1000);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fade(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"fade\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \"(\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst a1Node = this.parse_decimal(current);\n\t\tif (a1Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst a2Node = this.parse_decimal(current);\n\t\tif (a2Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst a3Node = this.parse_decimal(current);\n\t\tif (a3Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst t1Node = this.parse_decimal(current);\n\t\tif (t1Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst t2Node = this.parse_decimal(current);\n\t\tif (t2Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst t3Node = this.parse_decimal(current);\n\t\tif (t3Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst t4Node = this.parse_decimal(current);\n\t\tif (t4Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \")\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value =\n\t\t\tnew parts.ComplexFade(\n\t\t\t\t1 - a1Node.value / 255, 1 - a2Node.value / 255, 1 - a3Node.value / 255,\n\t\t\t\tt1Node.value / 1000, t2Node.value / 1000, t3Node.value / 1000, t4Node.value / 1000\n\t\t\t);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fax(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fay(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fn(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"fn\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = new ParseNode(current, \"\");\n\n\t\tfor (let next = this._peek(); this._haveMore() && next !== \"\\\\\" && next !== \"}\"; next = this._peek()) {\n\t\t\tvalueNode.value += next;\n\t\t}\n\n\t\tif (valueNode.value.length > 0) {\n\t\t\tcurrent.value = new parts.FontName(valueNode.value);\n\t\t}\n\t\telse {\n\t\t\tcurrent.value = new parts.FontName(null);\n\t\t}\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fr(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_frx(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fry(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_frz(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fs(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fsplus(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"fs+\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = this.parse_decimal(current);\n\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.FontSizePlus(valueNode.value / 10);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fsminus(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"fs-\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = this.parse_decimal(current);\n\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.FontSizeMinus(valueNode.value / 10);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fscx(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"fscx\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = this.parse_decimal(current);\n\n\t\tif (valueNode !== null) {\n\t\t\tcurrent.value = new parts.FontScaleX(valueNode.value / 100);\n\t\t}\n\t\telse {\n\t\t\tcurrent.value = new parts.FontScaleX(null);\n\t\t}\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fscy(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"fscy\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = this.parse_decimal(current);\n\n\t\tif (valueNode !== null) {\n\t\t\tcurrent.value = new parts.FontScaleY(valueNode.value / 100);\n\t\t}\n\t\telse {\n\t\t\tcurrent.value = new parts.FontScaleY(null);\n\t\t}\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_fsp(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_i(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_iclip(parent: ParseNode): ParseNode | null {\n\t\treturn this._parse_tag_clip_or_iclip(\"iclip\", parent);\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_k(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"k\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = this.parse_decimal(current);\n\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.ColorKaraoke(valueNode.value / 100);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_K(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"K\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = this.parse_decimal(current);\n\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.SweepingColorKaraoke(valueNode.value / 100);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_kf(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"kf\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = this.parse_decimal(current);\n\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.SweepingColorKaraoke(valueNode.value / 100);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_ko(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"ko\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = this.parse_decimal(current);\n\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.OutlineKaraoke(valueNode.value / 100);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_move(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"move\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \"(\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst x1Node = this.parse_decimal(current);\n\t\tif (x1Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst y1Node = this.parse_decimal(current);\n\t\tif (y1Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst x2Node = this.parse_decimal(current);\n\t\tif (x2Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst y2Node = this.parse_decimal(current);\n\t\tif (y2Node === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tlet t1Node: ParseNode | null = null;\n\t\tlet t2Node: ParseNode | null = null;\n\n\t\tif (this.read(current, \",\") !== null) {\n\t\t\tt1Node = this.parse_decimal(current);\n\t\t\tif (t1Node === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (this.read(current, \",\") === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tt2Node = this.parse_decimal(current);\n\t\t\tif (t2Node === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.read(current, \")\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.Move(\n\t\t\tx1Node.value, y1Node.value, x2Node.value, y2Node.value,\n\t\t\t(t1Node !== null) ? (t1Node.value / 1000) : null, (t2Node !== null) ? (t2Node.value / 1000) : null\n\t\t);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_org(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"org\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \"(\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst xNode = this.parse_decimal(current);\n\t\tif (xNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst yNode = this.parse_decimal(current);\n\t\tif (yNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \")\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.RotationOrigin(xNode.value, yNode.value);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_p(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_pbo(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_pos(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"pos\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \"(\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst xNode = this.parse_decimal(current);\n\t\tif (xNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \",\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst yNode = this.parse_decimal(current);\n\t\tif (yNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \")\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = new parts.Position(xNode.value, yNode.value);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_q(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"q\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst next = this._peek();\n\n\t\tif (next < \"0\" || next > \"3\") {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = new ParseNode(current, next);\n\n\t\tcurrent.value = new parts.WrappingStyle(parseInt(valueNode.value));\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_r(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"r\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode = new ParseNode(current, \"\");\n\n\t\tfor (let next = this._peek(); this._haveMore() && next !== \"\\\\\" && next !== \"}\"; next = this._peek()) {\n\t\t\tvalueNode.value += next;\n\t\t}\n\n\t\tif (valueNode.value.length > 0) {\n\t\t\tcurrent.value = new parts.Reset(valueNode.value);\n\t\t}\n\t\telse {\n\t\t\tcurrent.value = new parts.Reset(null);\n\t\t}\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_s(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_shad(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_t(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, \"t\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \"(\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tlet startNode: ParseNode | null = null;\n\t\tlet endNode: ParseNode | null = null;\n\t\tlet accelNode: ParseNode | null = null;\n\n\t\tconst firstNode = this.parse_decimal(current);\n\t\tif (firstNode !== null) {\n\t\t\tif (this.read(current, \",\") === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst secondNode = this.parse_decimal(current);\n\t\t\tif (secondNode !== null) {\n\t\t\t\tstartNode = firstNode;\n\t\t\t\tendNode = secondNode;\n\n\t\t\t\tif (this.read(current, \",\") === null) {\n\t\t\t\t\tparent.pop();\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst thirdNode = this.parse_decimal(current);\n\t\t\t\tif (thirdNode !== null) {\n\t\t\t\t\taccelNode = thirdNode;\n\n\t\t\t\t\tif (this.read(current, \",\") === null) {\n\t\t\t\t\t\tparent.pop();\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\taccelNode = firstNode;\n\n\t\t\t\tif (this.read(current, \",\") === null) {\n\t\t\t\t\tparent.pop();\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst transformTags: parts.Part[] = [];\n\n\t\tfor (let next = this._peek(); this._haveMore() && next !== \")\" && next !== \"}\"; next = this._peek()) {\n\t\t\tlet childNode: ParseNode | null = null;\n\n\t\t\tif (this.read(current, \"\\\\\") !== null) {\n\t\t\t\tchildNode =\n\t\t\t\t\tthis.parse_tag_alpha(current) ||\n\t\t\t\t\tthis.parse_tag_iclip(current) ||\n\t\t\t\t\tthis.parse_tag_xbord(current) ||\n\t\t\t\t\tthis.parse_tag_ybord(current) ||\n\t\t\t\t\tthis.parse_tag_xshad(current) ||\n\t\t\t\t\tthis.parse_tag_yshad(current) ||\n\n\t\t\t\t\tthis.parse_tag_blur(current) ||\n\t\t\t\t\tthis.parse_tag_bord(current) ||\n\t\t\t\t\tthis.parse_tag_clip(current) ||\n\t\t\t\t\tthis.parse_tag_fscx(current) ||\n\t\t\t\t\tthis.parse_tag_fscy(current) ||\n\t\t\t\t\tthis.parse_tag_shad(current) ||\n\n\t\t\t\t\tthis.parse_tag_fax(current) ||\n\t\t\t\t\tthis.parse_tag_fay(current) ||\n\t\t\t\t\tthis.parse_tag_frx(current) ||\n\t\t\t\t\tthis.parse_tag_fry(current) ||\n\t\t\t\t\tthis.parse_tag_frz(current) ||\n\t\t\t\t\tthis.parse_tag_fsp(current) ||\n\t\t\t\t\tthis.parse_tag_fsplus(current) ||\n\t\t\t\t\tthis.parse_tag_fsminus(current) ||\n\n\t\t\t\t\tthis.parse_tag_be(current) ||\n\t\t\t\t\tthis.parse_tag_fr(current) ||\n\t\t\t\t\tthis.parse_tag_fs(current) ||\n\t\t\t\t\tthis.parse_tag_1a(current) ||\n\t\t\t\t\tthis.parse_tag_1c(current) ||\n\t\t\t\t\tthis.parse_tag_2a(current) ||\n\t\t\t\t\tthis.parse_tag_2c(current) ||\n\t\t\t\t\tthis.parse_tag_3a(current) ||\n\t\t\t\t\tthis.parse_tag_3c(current) ||\n\t\t\t\t\tthis.parse_tag_4a(current) ||\n\t\t\t\t\tthis.parse_tag_4c(current) ||\n\n\t\t\t\t\tthis.parse_tag_c(current);\n\n\t\t\t\tif (childNode === null) {\n\t\t\t\t\tcurrent.pop(); // Unread backslash\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (childNode === null) {\n\t\t\t\tchildNode = this.parse_comment(current);\n\t\t\t}\n\n\t\t\tif (childNode !== null) {\n\t\t\t\tif (childNode.value instanceof parts.Comment && transformTags[transformTags.length - 1] instanceof parts.Comment) {\n\t\t\t\t\t// Merge consecutive comment parts into one part\n\t\t\t\t\ttransformTags[transformTags.length - 1] =\n\t\t\t\t\t\tnew parts.Comment(\n\t\t\t\t\t\t\t(transformTags[transformTags.length - 1] as parts.Comment).value +\n\t\t\t\t\t\t\t(childNode.value as parts.Comment).value\n\t\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\ttransformTags.push(childNode.value);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tthis.read(current, \")\");\n\n\t\tcurrent.value =\n\t\t\tnew parts.Transform(\n\t\t\t\t(startNode !== null) ? (startNode.value / 1000) : null,\n\t\t\t\t(endNode !== null) ? (endNode.value / 1000) : null,\n\t\t\t\t(accelNode !== null) ? (accelNode.value / 1000) : null,\n\t\t\t\ttransformTags\n\t\t\t);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_u(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_xbord(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_xshad(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_ybord(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_yshad(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_1a(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_1c(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_2a(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_2c(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_3a(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_3c(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_4a(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_tag_4c(parent: ParseNode): ParseNode | null {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_drawingInstructions(parent: ParseNode): ParseNode {\n\t\tconst current = new ParseNode(parent);\n\n\t\tlet currentType: string | null = null;\n\t\tconst numberParts: ParseNode[] = [];\n\n\t\tcurrent.value = [];\n\n\t\twhile (this._haveMore()) {\n\t\t\twhile (this.read(current, \" \") !== null) { }\n\t\t\tif (!this._haveMore()) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (currentType !== null) {\n\t\t\t\tconst numberPart = this.parse_decimal(current);\n\t\t\t\tif (numberPart !== null) {\n\t\t\t\t\tnumberParts.push(numberPart);\n\n\t\t\t\t\tif (currentType === \"m\" && numberParts.length === 2) {\n\t\t\t\t\t\tcurrent.value.push(new parts.drawing.MoveInstruction(numberParts[0].value, numberParts[1].value));\n\t\t\t\t\t\tnumberParts.splice(0, numberParts.length);\n\t\t\t\t\t}\n\t\t\t\t\telse if (currentType === \"l\" && numberParts.length === 2) {\n\t\t\t\t\t\tcurrent.value.push(new parts.drawing.LineInstruction(numberParts[0].value, numberParts[1].value));\n\t\t\t\t\t\tnumberParts.splice(0, numberParts.length);\n\t\t\t\t\t}\n\t\t\t\t\telse if (currentType === \"b\" && numberParts.length === 6) {\n\t\t\t\t\t\tcurrent.value.push(new parts.drawing.CubicBezierCurveInstruction(\n\t\t\t\t\t\t\tnumberParts[0].value, numberParts[1].value,\n\t\t\t\t\t\t\tnumberParts[2].value, numberParts[3].value,\n\t\t\t\t\t\t\tnumberParts[4].value, numberParts[5].value));\n\t\t\t\t\t\tnumberParts.splice(0, numberParts.length);\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst typePart = this.parse_text(current);\n\t\t\tconst newType = (typePart.value as parts.Text).value;\n\t\t\tswitch (newType) {\n\t\t\t\tcase \"m\":\n\t\t\t\tcase \"l\":\n\t\t\t\tcase \"b\":\n\t\t\t\t\tcurrentType = newType;\n\t\t\t\t\tnumberParts.splice(0, numberParts.length);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\twhile (this.read(current, \" \") !== null) { }\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_decimalInt32(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tconst isNegative = this.read(current, \"-\") !== null;\n\n\t\tconst numberNode = new ParseNode(current, \"\");\n\t\tfor (let next = this._peek(); this._haveMore() && next >= \"0\" && next <= \"9\"; next = this._peek()) {\n\t\t\tnumberNode.value += next;\n\t\t}\n\n\t\tif (numberNode.value.length === 0) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tlet value = parseInt(numberNode.value);\n\t\tif (value >= 0xFFFFFFFF) {\n\t\t\tvalue = 0xFFFFFFFF;\n\t\t}\n\t\telse if (isNegative) {\n\t\t\tvalue = -value;\n\t\t}\n\n\t\tcurrent.value = value;\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_hexInt32(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tconst isNegative = this.read(current, \"-\") !== null;\n\n\t\tconst numberNode = new ParseNode(current, \"\");\n\t\tfor (\n\t\t\tlet next = this._peek();\n\t\t\tthis._haveMore() && (\n\t\t\t\t(next >= \"0\" && next <= \"9\") ||\n\t\t\t\t(next >= \"a\" && next <= \"f\") ||\n\t\t\t\t(next >= \"A\" && next <= \"F\")\n\t\t\t);\n\t\t\tnext = this._peek()) {\n\n\t\t\tnumberNode.value += next;\n\t\t}\n\n\t\tif (numberNode.value.length === 0) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tlet value = parseInt(numberNode.value, 16);\n\t\tif (value >= 0xFFFFFFFF) {\n\t\t\tvalue = 0xFFFFFFFF;\n\t\t}\n\t\telse if (isNegative) {\n\t\t\tvalue = -value;\n\t\t}\n\n\t\tcurrent.value = value;\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_decimalOrHexInt32(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tconst valueNode =\n\t\t\t(this.read(current, \"&H\") !== null || this.read(current, \"&h\") !== null) ?\n\t\t\t\tthis.parse_hexInt32(current) :\n\t\t\t\tthis.parse_decimalInt32(current);\n\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = valueNode.value;\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_decimal(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tconst negative = (this.read(current, \"-\") !== null);\n\n\t\tconst numericalPart = this.parse_unsignedDecimal(current);\n\n\t\tif (numericalPart === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tcurrent.value = numericalPart.value;\n\n\t\tif (negative) {\n\t\t\tcurrent.value = -current.value;\n\t\t}\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_unsignedDecimal(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tconst characteristicNode = new ParseNode(current, \"\");\n\n\t\tlet mantissaNode: ParseNode | null = null;\n\n\t\tfor (let next = this._peek(); this._haveMore() && next >= \"0\" && next <= \"9\"; next = this._peek()) {\n\t\t\tcharacteristicNode.value += next;\n\t\t}\n\n\t\tif (characteristicNode.value.length === 0) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \".\") !== null) {\n\t\t\tmantissaNode = new ParseNode(current, \"\");\n\n\t\t\tfor (let next = this._peek(); this._haveMore() && next >= \"0\" && next <= \"9\"; next = this._peek()) {\n\t\t\t\tmantissaNode.value += next;\n\t\t\t}\n\n\t\t\tif (mantissaNode.value.length === 0) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tcurrent.value = parseFloat(characteristicNode.value + ((mantissaNode !== null) ? (\".\" + mantissaNode.value) : \"\"));\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_enableDisable(parent: ParseNode): ParseNode | null {\n\t\tconst next = this._peek();\n\n\t\tif (next === \"0\" || next === \"1\") {\n\t\t\tconst result = new ParseNode(parent, next);\n\t\t\tresult.value = (result.value === \"1\");\n\n\t\t\treturn result;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_color(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\twhile (this.read(current, \"&\") !== null || this.read(current, \"H\") !== null) { }\n\n\t\tconst valueNode = this.parse_hexInt32(current);\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst value = valueNode.value;\n\n\t\tcurrent.value = new parts.Color(\n\t\t\tvalue & 0xFF,\n\t\t\t(value >> 8) & 0xFF,\n\t\t\t(value >> 16) & 0xFF\n\t\t);\n\n\t\twhile (this.read(current, \"&\") !== null || this.read(current, \"H\") !== null) { }\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_alpha(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\twhile (this.read(current, \"&\") !== null || this.read(current, \"H\") !== null) { }\n\n\t\tconst valueNode = this.parse_hexInt32(current);\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst value = valueNode.value;\n\n\t\tcurrent.value = 1 - (value & 0xFF) / 0xFF;\n\n\t\twhile (this.read(current, \"&\") !== null || this.read(current, \"H\") !== null) { }\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tparse_colorWithAlpha(parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tconst valueNode = this.parse_decimalOrHexInt32(current);\n\t\tif (valueNode === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst value = valueNode.value;\n\n\t\tcurrent.value = new parts.Color(\n\t\t\tvalue & 0xFF,\n\t\t\t(value >> 8) & 0xFF,\n\t\t\t(value >> 16) & 0xFF,\n\t\t\t1 - ((value >> 24) & 0xFF) / 0xFF\n\t\t);\n\n\t\treturn current;\n\t}\n\n\t/**\n\t * @param {!ParseNode} parent\n\t * @param {string} next\n\t * @return {ParseNode}\n\t */\n\tread(parent: ParseNode, next: string): ParseNode | null {\n\t\tif (this._peek(next.length) !== next) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new ParseNode(parent, next);\n\t}\n\n\t/**\n\t * @param {number=1} count\n\t * @return {string}\n\t */\n\tprivate _peek(count: number = 1): string {\n\t\t// Fastpath for count === 1. http://jsperf.com/substr-vs-indexer\n\t\tif (count === 1) { return this._input[this._parseTree.end]; }\n\n\t\treturn this._input.substr(this._parseTree.end, count);\n\t}\n\n\t/**\n\t * @return {boolean}\n\t */\n\tprivate _haveMore(): boolean {\n\t\treturn this._parseTree.end < this._input.length;\n\t}\n\n\t/**\n\t * @param {string} tagName One of \"clip\" and \"iclip\"\n\t * @param {!ParseNode} parent\n\t * @return {ParseNode}\n\t */\n\tprivate _parse_tag_clip_or_iclip(tagName: \"clip\" | \"iclip\", parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, tagName) === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.read(current, \"(\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tlet x1Node: ParseNode | null = null;\n\t\tlet x2Node: ParseNode | null = null;\n\t\tlet y1Node: ParseNode | null = null;\n\t\tlet y2Node: ParseNode | null = null;\n\t\tlet scaleNode: ParseNode | null = null;\n\t\tlet commandsNode: ParseNode | null = null;\n\n\t\tconst firstNode = this.parse_decimal(current);\n\n\t\tif (firstNode !== null) {\n\t\t\tif (this.read(current, \",\") === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst secondNode = this.parse_decimal(current);\n\n\t\t\tif (secondNode !== null) {\n\t\t\t\tx1Node = firstNode;\n\t\t\t\ty1Node = secondNode;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tscaleNode = firstNode;\n\t\t\t}\n\t\t}\n\n\t\tif (x1Node !== null && y1Node !== null) {\n\t\t\tif (this.read(current, \",\") === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tx2Node = this.parse_decimal(current);\n\t\t\tif (x2Node === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (this.read(current, \",\") === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\ty2Node = this.parse_decimal(current);\n\t\t\tif (y2Node === null) {\n\t\t\t\tparent.pop();\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tcurrent.value = new parts.RectangularClip(x1Node.value, y1Node.value, x2Node.value, y2Node.value, tagName === \"clip\");\n\t\t}\n\t\telse {\n\t\t\tcommandsNode = new ParseNode(current, \"\");\n\n\t\t\tfor (let next = this._peek(); this._haveMore() && next !== \")\" && next !== \"}\"; next = this._peek()) {\n\t\t\t\tcommandsNode.value += next;\n\t\t\t}\n\n\t\t\tcurrent.value = new parts.VectorClip((scaleNode !== null) ? scaleNode.value : 1, parse(commandsNode.value, \"drawingInstructions\") as parts.drawing.Instruction[], tagName === \"clip\");\n\t\t}\n\n\t\tif (this.read(current, \")\") === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\treturn current;\n\t}\n}\n\n/**\n * Constructs a simple tag parser function and sets it on the prototype of the {@link ./parser/parse.ParserRun} class.\n *\n * @param {string} tagName The name of the tag to generate the parser function for\n * @param {function(new: !libjass.parts.Part, *)} tagConstructor The type of tag to be returned by the generated parser function\n * @param {function(!ParseNode): ParseNode} valueParser The parser for the tag's value\n * @param {boolean} required Whether the tag's value is required or optional\n */\nfunction makeTagParserFunction(\n\ttagName: string,\n\ttagConstructor: { new (value: any): parts.Part },\n\tvalueParser: (current: ParseNode) => ParseNode | null,\n\trequired: boolean\n): void {\n\t(ParserRun.prototype as any)[`parse_tag_${ tagName }`] = function (this: ParserRun, parent: ParseNode): ParseNode | null {\n\t\tconst current = new ParseNode(parent);\n\n\t\tif (this.read(current, tagName) === null) {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst valueNode: ParseNode | null = valueParser.call(this, current);\n\n\t\tif (valueNode !== null) {\n\t\t\tcurrent.value = new tagConstructor(valueNode.value);\n\t\t}\n\t\telse if (!required) {\n\t\t\tcurrent.value = new tagConstructor(null);\n\t\t}\n\t\telse {\n\t\t\tparent.pop();\n\t\t\treturn null;\n\t\t}\n\n\t\treturn current;\n\t};\n}\n\nmakeTagParserFunction(\"alpha\", parts.Alpha, ParserRun.prototype.parse_alpha, false);\nmakeTagParserFunction(\"be\", parts.Blur, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"blur\", parts.GaussianBlur, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"bord\", parts.Border, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"c\", parts.PrimaryColor, ParserRun.prototype.parse_color, false);\nmakeTagParserFunction(\"fax\", parts.SkewX, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"fay\", parts.SkewY, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"fr\", parts.RotateZ, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"frx\", parts.RotateX, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"fry\", parts.RotateY, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"frz\", parts.RotateZ, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"fs\", parts.FontSize, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"fsp\", parts.LetterSpacing, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"i\", parts.Italic, ParserRun.prototype.parse_enableDisable, false);\nmakeTagParserFunction(\"p\", parts.DrawingMode, ParserRun.prototype.parse_decimal, true);\nmakeTagParserFunction(\"pbo\", parts.DrawingBaselineOffset, ParserRun.prototype.parse_decimal, true);\nmakeTagParserFunction(\"s\", parts.StrikeThrough, ParserRun.prototype.parse_enableDisable, false);\nmakeTagParserFunction(\"shad\", parts.Shadow, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"u\", parts.Underline, ParserRun.prototype.parse_enableDisable, false);\nmakeTagParserFunction(\"xbord\", parts.BorderX, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"xshad\", parts.ShadowX, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"ybord\", parts.BorderY, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"yshad\", parts.ShadowY, ParserRun.prototype.parse_decimal, false);\nmakeTagParserFunction(\"1a\", parts.PrimaryAlpha, ParserRun.prototype.parse_alpha, false);\nmakeTagParserFunction(\"1c\", parts.PrimaryColor, ParserRun.prototype.parse_color, false);\nmakeTagParserFunction(\"2a\", parts.SecondaryAlpha, ParserRun.prototype.parse_alpha, false);\nmakeTagParserFunction(\"2c\", parts.SecondaryColor, ParserRun.prototype.parse_color, false);\nmakeTagParserFunction(\"3a\", parts.OutlineAlpha, ParserRun.prototype.parse_alpha, false);\nmakeTagParserFunction(\"3c\", parts.OutlineColor, ParserRun.prototype.parse_color, false);\nmakeTagParserFunction(\"4a\", parts.ShadowAlpha, ParserRun.prototype.parse_alpha, false);\nmakeTagParserFunction(\"4c\", parts.ShadowColor, ParserRun.prototype.parse_color, false);\n\nfor (const key of Object.keys(ParserRun.prototype)) {\n\tif (key.indexOf(\"parse_\") === 0 && typeof (ParserRun.prototype as any)[key] === \"function\") {\n\t\trules.set(key.substr(\"parse_\".length), (ParserRun.prototype as any)[key]);\n\t}\n}\n\n/**\n * This class represents a single parse node. It has a start and end position, and an optional value object.\n *\n * @param {ParseNode} parent The parent of this parse node.\n * @param {*=null} value If provided, it is assigned as the value of the node.\n */\nclass ParseNode {\n\tprivate _children: ParseNode[] = [];\n\n\tprivate _start: number;\n\tprivate _end: number;\n\tprivate _value: any;\n\n\tconstructor(private _parent: ParseNode | null, value: any = null) {\n\t\tif (_parent !== null) {\n\t\t\t_parent.children.push(this);\n\t\t}\n\n\t\tthis._start = ((_parent !== null) ? _parent.end : 0);\n\t\tthis._end = this._start;\n\n\t\tthis.value = value;\n\t}\n\n\t/**\n\t * The start position of this parse node.\n\t *\n\t * @type {number}\n\t */\n\tget start(): number {\n\t\treturn this._start;\n\t}\n\n\t/**\n\t * The end position of this parse node.\n\t *\n\t * @type {number}\n\t */\n\tget end(): number {\n\t\treturn this._end;\n\t}\n\n\t/**\n\t * @type {ParseNode}\n\t */\n\tget parent(): ParseNode | null {\n\t\treturn this._parent;\n\t}\n\n\t/**\n\t * @type {!Array.<!ParseNode>}\n\t */\n\tget children(): ParseNode[] {\n\t\treturn this._children;\n\t}\n\n\t/**\n\t * An optional object associated with this parse node.\n\t *\n\t * @type {*}\n\t */\n\tget value(): any {\n\t\treturn this._value;\n\t}\n\n\t/**\n\t * An optional object associated with this parse node.\n\t *\n\t * If the value is a string, then the end property is updated to be the length of the string.\n\t *\n\t * @type {*}\n\t */\n\tset value(newValue: any) {\n\t\tthis._value = newValue;\n\n\t\tif (this._value !== null && this._value.constructor === String && this._children.length === 0) {\n\t\t\tthis._setEnd(this._start + this._value.length);\n\t\t}\n\t}\n\n\t/**\n\t * Removes the last child of this node and updates the end position to be end position of the new last child.\n\t */\n\tpop(): void {\n\t\tthis._children.splice(this._children.length - 1, 1);\n\n\t\tif (this._children.length > 0) {\n\t\t\tthis._setEnd(this._children[this._children.length - 1].end);\n\t\t}\n\t\telse {\n\t\t\tthis._setEnd(this.start);\n\t\t}\n\t}\n\n\t/**\n\t * Updates the end property of this node and its parent recursively to the root node.\n\t *\n\t * @param {number} newEnd\n\t */\n\tprivate _setEnd(newEnd: number): void {\n\t\tthis._end = newEnd;\n\n\t\tif (this._parent !== null && this._parent.end !== this._end) {\n\t\t\tthis._parent._setEnd(this._end);\n\t\t}\n\t}\n}\n\nimport { Promise } from \"../utility/promise\";\n\nimport { WorkerCommands } from \"../webworker/commands\";\nimport { registerWorkerCommand } from \"../webworker/misc\";\n\nregisterWorkerCommand(WorkerCommands.Parse, parameters => new Promise(resolve => {\n\tresolve(parse(parameters.input, parameters.rule));\n}));\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { WrappingStyle as WrappingStyleType } from \"../types/misc\";\n\nimport * as drawing from \"./drawing\";\nexport { drawing };\n\n/**\n * Represents a CSS color with red, green, blue and alpha components.\n *\n * Instances of this class are immutable.\n *\n * @param {number} red\n * @param {number} green\n * @param {number} blue\n * @param {number=1} alpha\n */\nexport class Color {\n\tconstructor(private _red: number, private _green: number, private _blue: number, private _alpha: number = 1) { }\n\n\t/**\n\t * The red component of this color as a number between 0 and 255.\n\t *\n\t * @type {number}\n\t */\n\tget red(): number {\n\t\treturn this._red;\n\t}\n\n\t/**\n\t * The green component of this color as a number between 0 and 255.\n\t *\n\t * @type {number}\n\t */\n\tget green(): number {\n\t\treturn this._green;\n\t}\n\n\t/**\n\t * The blue component of this color as a number between 0 and 255.\n\t *\n\t * @type {number}\n\t */\n\tget blue(): number {\n\t\treturn this._blue;\n\t}\n\n\t/**\n\t * The alpha component of this color as a number between 0 and 1, where 0 means transparent and 1 means opaque.\n\t *\n\t * @type {number}\n\t */\n\tget alpha(): number {\n\t\treturn this._alpha;\n\t}\n\n\t/**\n\t * @param {?number} value The new alpha. If null, the existing alpha is used.\n\t * @return {!libjass.parts.Color} Returns a new Color instance with the same color but the provided alpha.\n\t */\n\twithAlpha(value: number): Color {\n\t\tif (value !== null) {\n\t\t\treturn new Color(this._red, this._green, this._blue, value);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * @return {string} The CSS representation \"rgba(...)\" of this color.\n\t */\n\ttoString(): string {\n\t\treturn `rgba(${ this._red }, ${ this._green }, ${ this._blue }, ${ this._alpha.toFixed(3) })`;\n\t}\n\n\t/**\n\t * Returns a new Color by interpolating the current color to the final color by the given progression.\n\t *\n\t * @param {!libjass.parts.Color} final\n\t * @param {number} progression\n\t * @return {!libjass.parts.Color}\n\t */\n\tinterpolate(final: Color, progression: number): Color {\n\t\treturn new Color(\n\t\t\tthis._red + progression * (final.red - this._red),\n\t\t\tthis._green + progression * (final.green - this._green),\n\t\t\tthis._blue + progression * (final.blue - this._blue),\n\t\t\tthis._alpha + progression * (final.alpha - this._alpha)\n\t\t);\n\t}\n}\n\n/**\n * The base interface of the ASS tag classes.\n */\nexport interface Part { }\n\n/**\n * A comment, i.e., any text enclosed in {} that is not understood as an ASS tag.\n *\n * @param {string} value The text of this comment\n */\nexport class Comment {\n\tconstructor(private _value: string) { }\n\n\t/**\n\t * The value of this comment.\n\t *\n\t * @type {string}\n\t */\n\tget value(): string {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A block of text, i.e., any text not enclosed in {}. Also includes \\h.\n *\n * @param {string} value The content of this block of text\n */\nexport class Text {\n\tconstructor(private _value: string) { }\n\n\t/**\n\t * The value of this text part.\n\t *\n\t * @type {string}\n\t */\n\tget value(): string {\n\t\treturn this._value;\n\t}\n\n\t/**\n\t * @return {string}\n\t */\n\ttoString(): string {\n\t\treturn `Text { value: ${ this._value.replace(/\\u00A0/g, \"\\\\h\") } }`;\n\t}\n}\n\n/**\n * A newline character \\N.\n */\nexport class NewLine {\n}\n\n/**\n * An italic tag {\\i}\n *\n * @param {?boolean} value {\\i1} -> true, {\\i0} -> false, {\\i} -> null\n */\nexport class Italic {\n\tconstructor(private _value: boolean) { }\n\n\t/**\n\t * The value of this italic tag.\n\t *\n\t * @type {?boolean}\n\t */\n\tget value(): boolean {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A bold tag {\\b}\n *\n * @param {?boolean|?number} value {\\b1} -> true, {\\b0} -> false, {\\b###} -> weight of the bold (number), {\\b} -> null\n */\nexport class Bold {\n\tconstructor(private _value: boolean | number | null) { }\n\n\t/**\n\t * The value of this bold tag.\n\t *\n\t * @type {?boolean|?number}\n\t */\n\tget value(): boolean | number | null {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * An underline tag {\\u}\n *\n * @param {?boolean} value {\\u1} -> true, {\\u0} -> false, {\\u} -> null\n */\nexport class Underline {\n\tconstructor(private _value: boolean) { }\n\n\t/**\n\t * The value of this underline tag.\n\t *\n\t * @type {?boolean}\n\t */\n\tget value(): boolean {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A strike-through tag {\\s}\n *\n * @param {?boolean} value {\\s1} -> true, {\\s0} -> false, {\\s} -> null\n */\nexport class StrikeThrough {\n\tconstructor(private _value: boolean) { }\n\n\t/**\n\t * The value of this strike-through tag.\n\t *\n\t * @type {?boolean}\n\t */\n\tget value(): boolean {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A border tag {\\bord}\n *\n * @param {?number} value {\\bord###} -> width (number), {\\bord} -> null\n */\nexport class Border {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this border tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A horizontal border tag {\\xbord}\n *\n * @param {?number} value {\\xbord###} -> width (number), {\\xbord} -> null\n */\nexport class BorderX {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this horizontal border tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A vertical border tag {\\ybord}\n *\n * @param {?number} value {\\ybord###} -> height (number), {\\ybord} -> null\n */\nexport class BorderY {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this vertical border tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A shadow tag {\\shad}\n *\n * @param {?number} value {\\shad###} -> depth (number), {\\shad} -> null\n */\nexport class Shadow {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this shadow tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A horizontal shadow tag {\\xshad}\n *\n * @param {?number} value {\\xshad###} -> depth (number), {\\xshad} -> null\n */\nexport class ShadowX {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this horizontal shadow tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A vertical shadow tag {\\yshad}\n *\n * @param {?number} value {\\yshad###} -> depth (number), {\\yshad} -> null\n */\nexport class ShadowY {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this vertical shadow tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A blur tag {\\be}\n *\n * @param {?number} value {\\be###} -> strength (number), {\\be} -> null\n */\nexport class Blur {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this blur tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A Gaussian blur tag {\\blur}\n *\n * @param {?number} value {\\blur###} -> strength (number), {\\blur} -> null\n */\nexport class GaussianBlur {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this Gaussian blur tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A font name tag {\\fn}\n *\n * @param {?string} value {\\fn###} -> name (string), {\\fn} -> null\n */\nexport class FontName {\n\tconstructor(private _value: string | null) { }\n\n\t/**\n\t * The value of this font name tag.\n\t *\n\t * @type {?string}\n\t */\n\tget value(): string | null {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A font size tag {\\fs}\n *\n * @param {?number} value {\\fs###} -> size (number), {\\fs} -> null\n */\nexport class FontSize {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this font size tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A font size increase tag {\\fs+}\n *\n * @param {number} value {\\fs+###} -> relative difference (number, percentage)\n */\nexport class FontSizePlus {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this font size increase tag.\n\t *\n\t * @type {number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A font size decrease tag {\\fs-}\n *\n * @param {number} value {\\fs-###} -> relative difference (number, percentage)\n */\nexport class FontSizeMinus {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this font size decrease tag.\n\t *\n\t * @type {number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A horizontal font scaling tag {\\fscx}\n *\n * @param {?number} value {\\fscx###} -> scale (number), {\\fscx} -> null\n */\nexport class FontScaleX {\n\tconstructor(private _value: number | null) { }\n\n\t/**\n\t * The value of this horizontal font scaling tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number | null {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A vertical font scaling tag {\\fscy}\n *\n * @param {?number} value {\\fscy###} -> scale (number), {\\fscy} -> null\n */\nexport class FontScaleY {\n\tconstructor(private _value: number | null) { }\n\n\t/**\n\t * The value of this vertical font scaling tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number | null {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A letter-spacing tag {\\fsp}\n *\n * @param {?number} value {\\fsp###} -> spacing (number), {\\fsp} -> null\n */\nexport class LetterSpacing {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this letter-spacing tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * An X-axis rotation tag {\\frx}\n *\n * @param {?number} value {\\frx###} -> angle (number), {\\frx} -> null\n */\nexport class RotateX {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this X-axis rotation tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A Y-axis rotation tag {\\fry}\n *\n * @param {?number} value {\\fry###} -> angle (number), {\\fry} -> null\n */\nexport class RotateY {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this Y-axis rotation tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A Z-axis rotation tag {\\fr} or {\\frz}\n *\n * @param {?number} value {\\frz###} -> angle (number), {\\frz} -> null\n */\nexport class RotateZ {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this Z-axis rotation tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * An X-axis shearing tag {\\fax}\n *\n * @param {?number} value {\\fax###} -> angle (number), {\\fax} -> null\n */\nexport class SkewX {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this X-axis shearing tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A Y-axis shearing tag {\\fay}\n *\n * @param {?number} value {\\fay###} -> angle (number), {\\fay} -> null\n */\nexport class SkewY {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this Y-axis shearing tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A primary color tag {\\c} or {\\1c}\n *\n * @param {libjass.parts.Color} value {\\1c###} -> color (Color), {\\1c} -> null\n */\nexport class PrimaryColor {\n\tconstructor(private _value: Color) { }\n\n\t/**\n\t * The value of this primary color tag.\n\t *\n\t * @type {libjass.parts.Color}\n\t */\n\tget value(): Color {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A secondary color tag {\\2c}\n *\n * @param {libjass.parts.Color} value {\\2c###} -> color (Color), {\\2c} -> null\n */\nexport class SecondaryColor {\n\tconstructor(private _value: Color) { }\n\n\t/**\n\t * The value of this secondary color tag.\n\t *\n\t * @type {libjass.parts.Color}\n\t */\n\tget value(): Color {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * An outline color tag {\\3c}\n *\n * @param {libjass.parts.Color} value {\\3c###} -> color (Color), {\\3c} -> null\n */\nexport class OutlineColor {\n\tconstructor(private _value: Color) { }\n\n\t/**\n\t * The value of this outline color tag.\n\t *\n\t * @type {libjass.parts.Color}\n\t */\n\tget value(): Color {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A shadow color tag {\\4c}\n *\n * @param {libjass.parts.Color} value {\\4c###} -> color (Color), {\\4c} -> null\n */\nexport class ShadowColor {\n\tconstructor(private _value: Color) { }\n\n\t/**\n\t * The value of this shadow color tag.\n\t *\n\t * @type {libjass.parts.Color}\n\t */\n\tget value(): Color {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * An alpha tag {\\alpha}\n *\n * @param {?number} value {\\alpha###} -> alpha (number), {\\alpha} -> null\n */\nexport class Alpha {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this alpha tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A primary alpha tag {\\1a}\n *\n * @param {?number} value {\\1a###} -> alpha (number), {\\1a} -> null\n */\nexport class PrimaryAlpha {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this primary alpha tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A secondary alpha tag {\\2a}\n *\n * @param {?number} value {\\2a###} -> alpha (number), {\\2a} -> null\n */\nexport class SecondaryAlpha {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this secondary alpha tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * An outline alpha tag {\\3a}\n *\n * @param {?number} value {\\3a###} -> alpha (number), {\\3a} -> null\n */\nexport class OutlineAlpha {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this outline alpha tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A shadow alpha tag {\\4a}\n *\n * @param {?number} value {\\4a###} -> alpha (number), {\\4a} -> null\n */\nexport class ShadowAlpha {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this shadow alpha tag.\n\t *\n\t * @type {?number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * An alignment tag {\\an} or {\\a}\n *\n * @param {number} value {\\an###} -> alignment (number)\n */\nexport class Alignment {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this alignment tag.\n\t *\n\t * @type {number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A color karaoke tag {\\k}\n *\n * @param {number} duration {\\k###} -> duration (number)\n */\nexport class ColorKaraoke {\n\tconstructor(private _duration: number) { }\n\n\t/**\n\t * The duration of this color karaoke tag.\n\t *\n\t * @type {number}\n\t */\n\tget duration(): number {\n\t\treturn this._duration;\n\t}\n}\n\n/**\n * A sweeping color karaoke tag {\\K} or {\\kf}\n *\n * @param {number} duration {\\kf###} -> duration (number)\n */\nexport class SweepingColorKaraoke {\n\tconstructor(private _duration: number) { }\n\n\t/**\n\t * The duration of this sweeping color karaoke tag.\n\t *\n\t * @type {number}\n\t */\n\tget duration(): number {\n\t\treturn this._duration;\n\t}\n}\n\n/**\n * An outline karaoke tag {\\ko}\n *\n * @param {number} duration {\\ko###} -> duration (number)\n */\nexport class OutlineKaraoke {\n\tconstructor(private _duration: number) { }\n\n\t/**\n\t * The duration of this outline karaoke tag.\n\t *\n\t * @type {number}\n\t */\n\tget duration(): number {\n\t\treturn this._duration;\n\t}\n}\n\n/**\n * A wrapping style tag {\\q}\n *\n * @param {number} value {\\q###} -> style (number)\n */\nexport class WrappingStyle {\n\tconstructor(private _value: WrappingStyleType) { }\n\n\t/**\n\t * The value of this wrapping style tag.\n\t *\n\t * @type {number}\n\t */\n\tget value(): WrappingStyleType {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A style reset tag {\\r}\n *\n * @param {?string} value {\\r###} -> style name (string), {\\r} -> null\n */\nexport class Reset {\n\tconstructor(private _value: string | null) { }\n\n\t/**\n\t * The value of this style reset tag.\n\t *\n\t * @type {?string}\n\t */\n\tget value(): string | null {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A position tag {\\pos}\n *\n * @param {number} x\n * @param {number} y\n */\nexport class Position {\n\tconstructor(private _x: number, private _y: number) { }\n\n\t/**\n\t * The x value of this position tag.\n\t *\n\t * @type {number}\n\t */\n\tget x(): number {\n\t\treturn this._x;\n\t}\n\n\t/**\n\t * The y value of this position tag.\n\t *\n\t * @type {number}\n\t */\n\tget y(): number {\n\t\treturn this._y;\n\t}\n}\n\n/**\n * A movement tag {\\move}\n *\n * @param {number} x1\n * @param {number} y1\n * @param {number} x2\n * @param {number} y2\n * @param {?number} t1\n * @param {?number} t2\n */\nexport class Move {\n\tconstructor(private _x1: number, private _y1: number, private _x2: number, private _y2: number, private _t1: number | null, private _t2: number | null) { }\n\n\t/**\n\t * The starting x value of this move tag.\n\t *\n\t * @type {number}\n\t */\n\tget x1(): number {\n\t\treturn this._x1;\n\t}\n\n\t/**\n\t * The starting y value of this move tag.\n\t *\n\t * @type {number}\n\t */\n\tget y1(): number {\n\t\treturn this._y1;\n\t}\n\n\t/**\n\t * The ending x value of this move tag.\n\t *\n\t * @type {number}\n\t */\n\tget x2(): number {\n\t\treturn this._x2;\n\t}\n\n\t/**\n\t * The ending y value of this move tag.\n\t *\n\t * @type {number}\n\t */\n\tget y2(): number {\n\t\treturn this._y2;\n\t}\n\n\t/**\n\t * The start time of this move tag.\n\t *\n\t * @type {?number}\n\t */\n\tget t1(): number | null {\n\t\treturn this._t1;\n\t}\n\n\t/**\n\t * The end time value of this move tag.\n\t *\n\t * @type {?number}\n\t */\n\tget t2(): number | null {\n\t\treturn this._t2;\n\t}\n}\n\n/**\n * A rotation origin tag {\\org}\n *\n * @param {number} x\n * @param {number} y\n */\nexport class RotationOrigin {\n\tconstructor(private _x: number, private _y: number) { }\n\n\t/**\n\t * The x value of this rotation origin tag.\n\t *\n\t * @type {number}\n\t */\n\tget x(): number {\n\t\treturn this._x;\n\t}\n\n\t/**\n\t * The y value of this rotation origin tag.\n\t *\n\t * @type {number}\n\t */\n\tget y(): number {\n\t\treturn this._y;\n\t}\n}\n\n/**\n * A simple fade tag {\\fad}\n *\n * @param {number} start\n * @param {number} end\n */\nexport class Fade {\n\tconstructor(private _start: number, private _end: number) { }\n\n\t/**\n\t * The start time of this fade tag.\n\t *\n\t * @type {number}\n\t */\n\tget start(): number {\n\t\treturn this._start;\n\t}\n\n\t/**\n\t * The end time of this fade tag.\n\t *\n\t * @type {number}\n\t */\n\tget end(): number {\n\t\treturn this._end;\n\t}\n}\n\n/**\n * A complex fade tag {\\fade}\n *\n * @param {number} a1\n * @param {number} a2\n * @param {number} a3\n * @param {number} t1\n * @param {number} t2\n * @param {number} t3\n * @param {number} t4\n */\nexport class ComplexFade {\n\tconstructor(\n\t\tprivate _a1: number, private _a2: number, private _a3: number,\n\t\tprivate _t1: number, private _t2: number, private _t3: number, private _t4: number\n\t) { }\n\n\t/**\n\t * The alpha value of this complex fade tag at time t2.\n\t *\n\t * @type {number}\n\t */\n\tget a1(): number {\n\t\treturn this._a1;\n\t}\n\n\t/**\n\t * The alpha value of this complex fade tag at time t3.\n\t *\n\t * @type {number}\n\t */\n\tget a2(): number {\n\t\treturn this._a2;\n\t}\n\n\t/**\n\t * The alpha value of this complex fade tag at time t4.\n\t *\n\t * @type {number}\n\t */\n\tget a3(): number {\n\t\treturn this._a3;\n\t}\n\n\t/**\n\t * The starting time of this complex fade tag.\n\t *\n\t * @type {number}\n\t */\n\tget t1(): number {\n\t\treturn this._t1;\n\t}\n\n\t/**\n\t * The first intermediate time of this complex fade tag.\n\t *\n\t * @type {number}\n\t */\n\tget t2(): number {\n\t\treturn this._t2;\n\t}\n\n\t/**\n\t * The second intermediate time of this complex fade tag.\n\t *\n\t * @type {number}\n\t */\n\tget t3(): number {\n\t\treturn this._t3;\n\t}\n\n\t/**\n\t * The ending time of this complex fade tag.\n\t *\n\t * @type {number}\n\t */\n\tget t4(): number {\n\t\treturn this._t4;\n\t}\n}\n\n/**\n * A transform tag {\\t}\n *\n * @param {?number} start\n * @param {?number} end\n * @param {?number} accel\n * @param {!Array.<!libjass.parts.Tag>} tags\n */\nexport class Transform {\n\tconstructor(private _start: number | null, private _end: number | null, private _accel: number | null, private _tags: Part[]) { }\n\n\t/**\n\t * The starting time of this transform tag.\n\t *\n\t * @type {?number}\n\t */\n\tget start(): number | null {\n\t\treturn this._start;\n\t}\n\n\t/**\n\t * The ending time of this transform tag.\n\t *\n\t * @type {?number}\n\t */\n\tget end(): number | null {\n\t\treturn this._end;\n\t}\n\n\t/**\n\t * The acceleration of this transform tag.\n\t *\n\t * @type {?number}\n\t */\n\tget accel(): number | null {\n\t\treturn this._accel;\n\t}\n\n\t/**\n\t * The tags animated by this transform tag.\n\t *\n\t * @type {!Array.<!libjass.parts.Tag>}\n\t */\n\tget tags(): Part[] {\n\t\treturn this._tags;\n\t}\n}\n\n/**\n * A rectangular clip tag {\\clip} or {\\iclip}\n *\n * @param {number} x1\n * @param {number} y1\n * @param {number} x2\n * @param {number} y2\n * @param {boolean} inside\n */\nexport class RectangularClip {\n\tconstructor(private _x1: number, private _y1: number, private _x2: number, private _y2: number, private _inside: boolean) { }\n\n\t/**\n\t * The X coordinate of the starting position of this rectangular clip tag.\n\t *\n\t * @type {number}\n\t */\n\tget x1(): number {\n\t\treturn this._x1;\n\t}\n\n\t/**\n\t * The Y coordinate of the starting position of this rectangular clip tag.\n\t *\n\t * @type {number}\n\t */\n\tget y1(): number {\n\t\treturn this._y1;\n\t}\n\n\t/**\n\t * The X coordinate of the ending position of this rectangular clip tag.\n\t *\n\t * @type {number}\n\t */\n\tget x2(): number {\n\t\treturn this._x2;\n\t}\n\n\t/**\n\t * The Y coordinate of the ending position of this rectangular clip tag.\n\t *\n\t * @type {number}\n\t */\n\tget y2(): number {\n\t\treturn this._y2;\n\t}\n\n\t/**\n\t * Whether this rectangular clip tag clips the region it encloses or the region it excludes.\n\t *\n\t * @type {boolean}\n\t */\n\tget inside(): boolean {\n\t\treturn this._inside;\n\t}\n}\n\n/**\n * A vector clip tag {\\clip} or {\\iclip}\n *\n * @param {number} scale\n * @param {!Array.<!libjass.parts.drawing.Instruction>} instructions\n * @param {boolean} inside\n */\nexport class VectorClip {\n\tconstructor(private _scale: number, private _instructions: drawing.Instruction[], private _inside: boolean) { }\n\n\t/**\n\t * The scale of this vector clip tag.\n\t *\n\t * @type {number}\n\t */\n\tget scale(): number {\n\t\treturn this._scale;\n\t}\n\n\t/**\n\t * The clip commands of this vector clip tag.\n\t *\n\t * @type {string}\n\t */\n\tget instructions(): drawing.Instruction[] {\n\t\treturn this._instructions;\n\t}\n\n\t/**\n\t * Whether this vector clip tag clips the region it encloses or the region it excludes.\n\t *\n\t * @type {boolean}\n\t */\n\tget inside(): boolean {\n\t\treturn this._inside;\n\t}\n}\n\n/**\n * A drawing mode tag {\\p}\n *\n * @param {number} scale\n */\nexport class DrawingMode {\n\tconstructor(private _scale: number) { }\n\n\t/**\n\t * The scale of this drawing mode tag.\n\t *\n\t * @type {number}\n\t */\n\tget scale(): number {\n\t\treturn this._scale;\n\t}\n}\n\n/**\n * A drawing mode baseline offset tag {\\pbo}\n *\n * @param {number} value\n */\nexport class DrawingBaselineOffset {\n\tconstructor(private _value: number) { }\n\n\t/**\n\t * The value of this drawing mode baseline offset tag.\n\t *\n\t * @type {number}\n\t */\n\tget value(): number {\n\t\treturn this._value;\n\t}\n}\n\n/**\n * A pseudo-part representing text interpreted as drawing instructions\n *\n * @param {!Array.<!libjass.parts.drawing.Instruction>} instructions\n */\nexport class DrawingInstructions {\n\tconstructor(private _instructions: drawing.Instruction[]) { }\n\n\t/**\n\t * The instructions contained in this drawing instructions part.\n\t *\n\t * @type {!Array.<!libjass.parts.drawing.Instruction>}\n\t */\n\tget instructions(): drawing.Instruction[] {\n\t\treturn this._instructions;\n\t}\n}\n\nconst addToString = function (ctor: Function, ctorName: string): void {\n\tif (!ctor.prototype.hasOwnProperty(\"toString\")) {\n\t\tconst propertyNames = Object.getOwnPropertyNames(ctor.prototype).filter(property => property !== \"constructor\");\n\n\t\tctor.prototype.toString = function (this: any): string {\n\t\t\treturn (\n\t\t\t\tctorName + \" { \" +\n\t\t\t\tpropertyNames.map(name => `${ name }: ${ this[name] }`).join(\", \") +\n\t\t\t\t((propertyNames.length > 0) ? \" \" : \"\") +\n\t\t\t\t\"}\"\n\t\t\t);\n\t\t};\n\t}\n};\n\nimport { registerClass } from \"../serialization\";\n\ndeclare const exports: any;\n\nfor (const key of Object.keys(exports)) {\n\tconst value: any = exports[key];\n\tif (value instanceof Function) {\n\t\taddToString(value, key);\n\t\tregisterClass(value);\n\t}\n}\n\nfor (const key of Object.keys(drawing)) {\n\tconst value: any = (drawing as any)[key];\n\tif (value instanceof Function) {\n\t\taddToString(value, `Drawing${ key }`);\n\t\tregisterClass(value);\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * The base interface of the drawing instructions.\n */\nexport interface Instruction { }\n\n/**\n * An instruction to move to a particular position.\n *\n * @param {number} x\n * @param {number} y\n */\nexport class MoveInstruction implements Instruction {\n\tconstructor(private _x: number, private _y: number) { }\n\n\t/**\n\t * The X position of this move instruction.\n\t *\n\t * @type {number}\n\t */\n\tget x(): number {\n\t\treturn this._x;\n\t}\n\n\t/**\n\t * The Y position of this move instruction.\n\t *\n\t * @type {number}\n\t */\n\tget y(): number {\n\t\treturn this._y;\n\t}\n}\n\n/**\n * An instruction to draw a line to a particular position.\n *\n * @param {number} x\n * @param {number} y\n */\nexport class LineInstruction implements Instruction {\n\tconstructor(private _x: number, private _y: number) { }\n\n\t/**\n\t * The X position of this line instruction.\n\t *\n\t * @type {number}\n\t */\n\tget x(): number {\n\t\treturn this._x;\n\t}\n\n\t/**\n\t * The Y position of this line instruction.\n\t *\n\t * @type {number}\n\t */\n\tget y(): number {\n\t\treturn this._y;\n\t}\n}\n\n/**\n * An instruction to draw a cubic bezier curve to a particular position, with two given control points.\n *\n * @param {number} x1\n * @param {number} y1\n * @param {number} x2\n * @param {number} y2\n * @param {number} x3\n * @param {number} y3\n */\nexport class CubicBezierCurveInstruction implements Instruction {\n\tconstructor(private _x1: number, private _y1: number, private _x2: number, private _y2: number, private _x3: number, private _y3: number) { }\n\n\t/**\n\t * The X position of the first control point of this cubic bezier curve instruction.\n\t *\n\t * @type {number}\n\t */\n\tget x1(): number {\n\t\treturn this._x1;\n\t}\n\n\t/**\n\t * The Y position of the first control point of this cubic bezier curve instruction.\n\t *\n\t * @type {number}\n\t */\n\tget y1(): number {\n\t\treturn this._y1;\n\t}\n\n\t/**\n\t * The X position of the second control point of this cubic bezier curve instruction.\n\t *\n\t * @type {number}\n\t */\n\tget x2(): number {\n\t\treturn this._x2;\n\t}\n\n\t/**\n\t * The Y position of the second control point of this cubic bezier curve instruction.\n\t *\n\t * @type {number}\n\t */\n\tget y2(): number {\n\t\treturn this._y2;\n\t}\n\n\t/**\n\t * The ending X position of this cubic bezier curve instruction.\n\t *\n\t * @type {number}\n\t */\n\tget x3(): number {\n\t\treturn this._x3;\n\t}\n\n\t/**\n\t * The ending Y position of this cubic bezier curve instruction.\n\t *\n\t * @type {number}\n\t */\n\tget y3(): number {\n\t\treturn this._y3;\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Map } from \"../utility/map\";\n\n/**\n * The format of the string passed to {@link libjass.ASS.fromString}\n */\nexport enum Format {\n\tASS,\n\tSRT,\n}\n\n/**\n * The wrapping style defined in the {@link libjass.ScriptProperties}\n */\nexport enum WrappingStyle {\n\tSmartWrappingWithWiderTopLine = 0,\n\tSmartWrappingWithWiderBottomLine = 3,\n\tEndOfLineWrapping = 1,\n\tNoLineWrapping = 2,\n}\n\n/**\n * The border style defined in the {@link libjass.Style} properties.\n */\nexport enum BorderStyle {\n\tOutline = 1,\n\tOpaqueBox = 3,\n}\n\n/**\n * A property.\n */\nexport interface Property {\n\t/**\n\t * @type {string}\n\t */\n\tname: string;\n\n\t/**\n\t * @type {string}\n\t */\n\tvalue: string;\n}\n\n/**\n * A template object with a particular type.\n */\nexport interface TypedTemplate {\n\t/**\n\t * @type {string}\n\t */\n\ttype: string;\n\n\t/**\n\t * @type {!Map.<string, string>}\n\t */\n\ttemplate: Map<string, string>;\n}\n\n/**\n * @param {!Map.<string, string>} template\n * @param {string} key\n * @param {function(string):T} converter\n * @param {?function(T):boolean} validator\n * @param {T} defaultValue\n * @return {T}\n */\nexport function valueOrDefault<T>(template: Map<string, string>, key: string, converter: (str: string) => T, validator: ((value: T) => boolean) | null, defaultValue: string): T {\n\tconst value = template.get(key);\n\tif (value === undefined) {\n\t\treturn converter(defaultValue);\n\t}\n\n\ttry {\n\t\tconst result = converter(value);\n\n\t\tif (validator !== null && !validator(result)) {\n\t\t\tthrow new Error(\"Validation failed.\");\n\t\t}\n\n\t\treturn result;\n\t}\n\tcatch (ex) {\n\t\tthrow new Error(`Property ${ key } has invalid value ${ value } - ${ ex.stack }`);\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { WorkerChannel, WorkerChannelImpl } from \"./channel\";\nexport { WorkerChannel } from \"./channel\";\n\nexport { WorkerCommands } from \"./commands\";\n\n/**\n * Indicates whether web workers are supposed in this environment or not.\n *\n * @type {boolean}\n */\nexport const supported = typeof Worker !== \"undefined\";\n\nconst _scriptNode = (typeof document !== \"undefined\" && document.currentScript !== undefined) ? (document.currentScript as HTMLScriptElement) : null;\n\n/**\n * Create a new web worker and returns a {@link libjass.webworker.WorkerChannel} to it.\n *\n * @param {string=} scriptPath The path to libjass.js to be loaded in the web worker. If the browser supports document.currentScript, the parameter is optional and, if not provided,\n * the path will be determined from the src attribute of the <script> element that contains the currently running copy of libjass.js\n * @return {!libjass.webworker.WorkerChannel} A communication channel to the new web worker.\n */\nexport function createWorker(scriptPath?: string): WorkerChannel {\n\tif (scriptPath === undefined) {\n\t\tif (_scriptNode === null) {\n\t\t\tthrow new Error(\"Could not auto-detect path of libjass.js, and explicit path was not passed in.\");\n\t\t}\n\n\t\tscriptPath = _scriptNode.src;\n\t}\n\n\treturn new WorkerChannelImpl(new Worker(scriptPath));\n}\n\ndeclare const global: any;\n\nif (typeof WorkerGlobalScope !== \"undefined\" && global instanceof WorkerGlobalScope) {\n\t// This is a web worker. Set up a channel to talk back to the main thread.\n\tnew WorkerChannelImpl(global);\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { deserialize, serialize } from \"../serialization\";\n\nimport { Map } from \"../utility/map\";\n\nimport { DeferredPromise, Promise } from \"../utility/promise\";\n\nimport { WorkerCommands } from \"./commands\";\nimport { getWorkerCommandHandler, registerWorkerCommand } from \"./misc\";\n\n/**\n * Represents a communication channel between the host and the web worker. An instance of this class is created by calling {@link libjass.webworker.createWorker}\n */\nexport interface WorkerChannel {\n\t/**\n\t * Sends a request to the other side to execute the given command with the given parameters.\n\t *\n\t * @param {number} command\n\t * @param {*} parameters\n\t * @return {!Promise.<*>} A promise that will get resolved when the other side computes the result\n\t */\n\trequest(command: WorkerCommands, parameters: any): Promise<any>;\n}\n\n/**\n * The signature of a handler registered to handle a particular command in {@link libjass.webworker.WorkerCommands}\n */\nexport interface WorkerCommandHandler {\n\t(parameters: any): Promise<any>;\n}\n\n/**\n * The interface implemented by a communication channel to the other side.\n */\nexport interface WorkerCommunication {\n\t/**\n\t * @param {\"message\"} type\n\t * @param {function(!MessageEvent): *} listener\n\t * @param {?boolean} useCapture\n\t */\n\taddEventListener(type: \"message\", listener: (ev: MessageEvent) => any, useCapture?: boolean): void;\n\n\t/**\n\t * @param {string} type\n\t * @param {!EventListener} listener\n\t * @param {?boolean} useCapture\n\t */\n\taddEventListener(type: string, listener: EventListener, useCapture?: boolean): void;\n\n\t/**\n\t * @param {*} message\n\t */\n\tpostMessage(message: any): void;\n}\n\n/**\n * The interface implemented by a request sent to the other side of the communication channel.\n */\ninterface WorkerRequestMessage {\n\t/**\n\t * An internal identifier for this request. Used to connect responses to their corresponding requests.\n\t *\n\t * @type {number}\n\t */\n\trequestId: number;\n\n\t/**\n\t * The command type of this request.\n\t *\n\t * @type {number}\n\t */\n\tcommand: WorkerCommands;\n\n\t/**\n\t * Any parameters serialized with this request.\n\t *\n\t * @type {*}\n\t */\n\tparameters: any;\n}\n\n/**\n * The interface implemented by a response received from the other side of the communication channel.\n */\ninterface WorkerResponseMessage {\n\t/**\n\t * An internal identifier for this response. Used to connect responses to their corresponding requests.\n\t *\n\t * @type {number}\n\t */\n\trequestId: number;\n\n\t/**\n\t * Set if the computation of this response resulted in an error.\n\t *\n\t * @type {*}\n\t */\n\terror: any;\n\n\t/**\n\t * The result of computing this response.\n\t *\n\t * @type {*}\n\t */\n\tresult: any;\n}\n\n/**\n * Internal implementation of libjass.webworker.WorkerChannel\n *\n * @param {!*} comm The object used to talk to the other side of the channel. When created by the main thread, this is the Worker object.\n * When created by the web worker, this is its global object.\n */\nexport class WorkerChannelImpl implements WorkerChannel {\n\tprivate static _lastRequestId: number = -1;\n\n\tprivate _pendingRequests: Map<number, DeferredPromise<any>> = new Map<number, DeferredPromise<any>>();\n\n\tconstructor(private _comm: WorkerCommunication) {\n\t\tthis._comm.addEventListener(\"message\", ev => this._onMessage(ev.data as string), false);\n\t}\n\n\t/**\n\t * @param {number} command\n\t * @param {*} parameters\n\t * @return {!Promise.<*>}\n\t */\n\trequest(command: WorkerCommands, parameters: any): Promise<any> {\n\t\tconst deferred = new DeferredPromise<any>();\n\t\tconst requestId = ++WorkerChannelImpl._lastRequestId;\n\t\tthis._pendingRequests.set(requestId, deferred);\n\n\t\tconst requestMessage: WorkerRequestMessage = { requestId, command, parameters };\n\t\tthis._comm.postMessage(serialize(requestMessage));\n\n\t\treturn deferred.promise;\n\t}\n\n\t/**\n\t * @param {number} requestId\n\t */\n\tcancelRequest(requestId: number): void {\n\t\tconst deferred = this._pendingRequests.get(requestId);\n\t\tif (deferred === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._pendingRequests.delete(requestId);\n\t\tdeferred.reject(new Error(\"Cancelled.\"));\n\t}\n\n\t/**\n\t * @param {!WorkerResponseMessage} message\n\t */\n\tprivate _respond(message: WorkerResponseMessage): void {\n\t\tlet { requestId, error, result } = message;\n\t\tif (error instanceof Error) {\n\t\t\terror = { message: error.message, stack: error.stack };\n\t\t}\n\t\tthis._comm.postMessage(serialize({ command: WorkerCommands.Response, requestId, error, result }));\n\t}\n\n\t/**\n\t * @param {string} rawMessage\n\t */\n\tprivate _onMessage(rawMessage: string): void {\n\t\tconst message = deserialize(rawMessage) as { command: WorkerCommands };\n\n\t\tif (message.command === WorkerCommands.Response) {\n\t\t\tconst responseMessage = message as any as WorkerResponseMessage;\n\n\t\t\tconst deferred = this._pendingRequests.get(responseMessage.requestId);\n\t\t\tif (deferred !== undefined) {\n\t\t\t\tthis._pendingRequests.delete(responseMessage.requestId);\n\t\t\t\tif (responseMessage.error === null) {\n\t\t\t\t\tdeferred.resolve(responseMessage.result);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdeferred.reject(responseMessage.error);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tconst requestMessage = message as WorkerRequestMessage;\n\t\t\tconst requestId = requestMessage.requestId;\n\n\t\t\tconst commandCallback = getWorkerCommandHandler(requestMessage.command);\n\t\t\tif (commandCallback === undefined) {\n\t\t\t\tthis._respond({ requestId, error: new Error(`No handler registered for command ${ requestMessage.command }`), result: null });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcommandCallback(requestMessage.parameters).then<WorkerResponseMessage>(\n\t\t\t\tresult => ({ requestId, error: null, result }),\n\t\t\t\terror => ({ requestId, error, result: null })\n\t\t\t).then(responseMessage => this._respond(responseMessage));\n\t\t}\n\t}\n}\n\nregisterWorkerCommand(WorkerCommands.Ping, parameters => Promise.resolve(null));\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Map } from \"../utility/map\";\n\nimport { WorkerCommandHandler } from \"./channel\";\nimport { WorkerCommands } from \"./commands\";\n\nconst workerCommands = new Map<WorkerCommands, WorkerCommandHandler>();\n\n/**\n * Registers a handler for the given worker command.\n *\n * @param {number} command The command that this handler will handle. One of the {@link libjass.webworker.WorkerCommands} constants.\n * @param {function(*, function(*, *))} handler The handler. A function of the form (parameters: *, response: function(error: *, result: *): void): void\n */\nexport function registerWorkerCommand(command: WorkerCommands, handler: WorkerCommandHandler): void {\n\tworkerCommands.set(command, handler);\n}\n\n/**\n * Gets the handler for the given worker command.\n *\n * @param {number} command\n * @return {?function(*, function(*, *))}\n */\nexport function getWorkerCommandHandler(command: WorkerCommands): WorkerCommandHandler | undefined {\n\treturn workerCommands.get(command);\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * The commands that can be sent to or from a web worker.\n */\nexport enum WorkerCommands {\n\tResponse = 0,\n\tParse = 1,\n\tPing = 2,\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Map } from \"./utility/map\";\n\nconst classes = new Map<number, Function & { fromJSON?: (obj: any) => any }>();\n\n/**\n * Registers a class as a serializable type.\n *\n * @param {function(new:*)} clazz\n */\nexport function registerClass(clazz: Function & { fromJSON?: (obj: any) => any }): void {\n\tclazz.prototype._classTag = classes.size;\n\tclasses.set(clazz.prototype._classTag, clazz);\n}\n\n/**\n * Serializes the given object.\n *\n * @param {*} obj\n * @return {string}\n */\nexport function serialize(obj: any): string {\n\treturn JSON.stringify(obj, (/* ujs:unreferenced */ key: string, value: any) => {\n\t\tif (value && (value._classTag !== undefined) && !Object.prototype.hasOwnProperty.call(value, \"_classTag\")) {\n\t\t\t// Copy the _classTag from this object's prototype to itself, so that it will be serialized.\n\t\t\tvalue._classTag = value._classTag;\n\t\t}\n\n\t\treturn value;\n\t});\n}\n\n/**\n * @param {string} str\n * @return {*}\n */\nexport function deserialize(str: string): any {\n\treturn JSON.parse(str, (/* ujs:unreferenced */ key: string, value: any) => {\n\t\tif (value && (value._classTag !== undefined)) {\n\t\t\tconst clazz = classes.get(value._classTag);\n\t\t\tif (clazz === undefined) {\n\t\t\t\tthrow new Error(`Unknown class of tag ${ value._classTag } cannot be deserialized.`);\n\t\t\t}\n\n\t\t\tif (typeof clazz.fromJSON === \"function\") {\n\t\t\t\tvalue = clazz.fromJSON(value);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconst hydratedValue = Object.create(clazz.prototype);\n\t\t\t\tfor (const key of Object.keys(value)) {\n\t\t\t\t\thydratedValue[key] = value[key];\n\t\t\t\t}\n\t\t\t\tvalue = hydratedValue;\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t});\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface Thenable<T> {\n\t/** @type {function(this:!Thenable.<T>, function(T|!Thenable.<T>), function(*))} */\n\tthen: ThenableThen<T>;\n}\n\nexport interface ThenableThen<T> {\n\t/** @type {function(this:!Thenable.<T>, function(T|!Thenable.<T>), function(*))} */\n\t(this: Thenable<T>, resolve: ((resolution: T | Thenable<T>) => void) | undefined, reject: ((reason: any) => void) | undefined): void;\n}\n\nexport interface Promise<T> extends Thenable<T> {\n\t/**\n\t * @param {function(T):!Thenable.<U>} onFulfilled\n\t * @param {?function(*):(U|!Thenable.<U>)} onRejected\n\t * @return {!Promise.<U>}\n\t */\n\tthen<U>(onFulfilled: (value: T) => Thenable<U> | undefined, onRejected?: (reason: any) => U | Thenable<U>): Promise<U>;\n\n\t/**\n\t * @param {function(T):U} onFulfilled\n\t * @param {?function(*):(U|!Thenable.<U>)} onRejected\n\t * @return {!Promise.<U>}\n\t */\n\tthen<U>(onFulfilled: (value: T) => U | undefined, onRejected?: (reason: any) => U | Thenable<U>): Promise<U>;\n\n\t/**\n\t * @param {function(*):(T|!Thenable.<T>)} onRejected\n\t * @return {!Promise.<T>}\n\t */\n\tcatch(onRejected: (reason: any) => T | Thenable<T>): Promise<T>;\n}\n\n// Based on https://github.com/petkaantonov/bluebird/blob/1b1467b95442c12378d0ea280ede61d640ab5510/src/schedule.js\nconst enqueueJob = (function (): (callback: () => void) => void {\n\tconst MutationObserver = global.MutationObserver || global.WebkitMutationObserver;\n\n\tif (global.process !== undefined && typeof global.process.nextTick === \"function\") {\n\t\tconst process = global.process;\n\t\treturn (callback: () => void) => {\n\t\t\tprocess.nextTick(callback);\n\t\t};\n\t}\n\telse if (MutationObserver !== undefined) {\n\t\tconst pending: (() => void)[] = [];\n\t\tlet currentlyPending = false;\n\n\t\tconst div = document.createElement(\"div\");\n\n\t\tconst observer = new MutationObserver(() => {\n\t\t\tconst processing = pending.splice(0, pending.length);\n\n\t\t\tfor (const callback of processing) {\n\t\t\t\tcallback();\n\t\t\t}\n\n\t\t\tcurrentlyPending = false;\n\n\t\t\tif (pending.length > 0) {\n\t\t\t\tdiv.classList.toggle(\"foo\");\n\t\t\t\tcurrentlyPending = true;\n\t\t\t}\n\t\t});\n\n\t\tobserver.observe(div, { attributes: true });\n\n\t\treturn (callback: () => void) => {\n\t\t\tpending.push(callback);\n\n\t\t\tif (!currentlyPending) {\n\t\t\t\tdiv.classList.toggle(\"foo\");\n\t\t\t\tcurrentlyPending = true;\n\t\t\t}\n\t\t};\n\t}\n\telse {\n\t\treturn (callback: () => void) => setTimeout(callback, 0);\n\t}\n})();\n\n/**\n * Promise implementation for browsers that don't support it.\n *\n * @param {function(function(T|!Thenable.<T>), function(*))} executor\n */\nclass SimplePromise<T> {\n\t/**\n\t * @param {T|!Thenable.<T>} value\n\t * @return {!Promise.<T>}\n\t */\n\tstatic resolve<T>(value: T | Thenable<T>): Promise<T> {\n\t\tif (value instanceof SimplePromise) {\n\t\t\treturn value;\n\t\t}\n\n\t\treturn new Promise<T>(resolve => resolve(value));\n\t}\n\n\t/**\n\t * @param {*} reason\n\t * @return {!Promise.<T>}\n\t */\n\tstatic reject<T>(reason: any): Promise<T> {\n\t\treturn new Promise<T>((/* ujs:unreferenced */ resolve, reject) => reject(reason));\n\t}\n\n\t/**\n\t * @param {!Array.<T|!Thenable.<T>>} values\n\t * @return {!Promise.<!Array.<T>>}\n\t */\n\tstatic all<T>(values: (T | Thenable<T>)[]): Promise<T[]> {\n\t\treturn new Promise<T[]>((resolve, reject) => {\n\t\t\tconst result: T[] = [];\n\n\t\t\tlet numUnresolved = values.length;\n\t\t\tif (numUnresolved === 0) {\n\t\t\t\tresolve(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvalues.forEach((value, index) => Promise.resolve(value).then(value => {\n\t\t\t\tresult[index] = value;\n\t\t\t\tnumUnresolved--;\n\n\t\t\t\tif (numUnresolved === 0) {\n\t\t\t\t\tresolve(result);\n\t\t\t\t}\n\t\t\t}, reject));\n\t\t});\n\t}\n\n\t/**\n\t * @param {!Array.<T|!Thenable.<T>>} values\n\t * @return {!Promise.<T>}\n\t */\n\tstatic race<T>(values: (T | Thenable<T>)[]): Promise<T> {\n\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\tfor (const value of values) {\n\t\t\t\tPromise.resolve(value).then(resolve, reject);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _state: SimplePromiseState = SimplePromiseState.PENDING;\n\n\tprivate _fulfillReactions: FulfilledPromiseReaction<T, any>[] = [];\n\tprivate _rejectReactions: RejectedPromiseReaction<any>[] = [];\n\n\tprivate _fulfilledValue: T | null = null;\n\tprivate _rejectedReason: any = null;\n\n\tconstructor(executor: (resolve: (resolution: T | Thenable<T>) => void, reject: (reason: any) => void) => void) {\n\t\tif (typeof executor !== \"function\") {\n\t\t\tthrow new TypeError(`typeof executor !== \"function\"`);\n\t\t}\n\n\t\tconst { resolve, reject } = this._createResolvingFunctions();\n\t\ttry {\n\t\t\texecutor(resolve, reject);\n\t\t}\n\t\tcatch (ex) {\n\t\t\treject(ex);\n\t\t}\n\t}\n\n\t/**\n\t * @param {?function(T):(U|!Thenable.<U>)} onFulfilled\n\t * @param {?function(*):(U|!Thenable.<U>)} onRejected\n\t * @return {!Promise.<U>}\n\t */\n\tthen<U>(onFulfilled: ((value: T) => U | Thenable<U>) | undefined, onRejected?: (reason: any) => U | Thenable<U>): Promise<U> {\n\t\tconst resultCapability = new DeferredPromise<U>();\n\n\t\tif (typeof onFulfilled !== \"function\") {\n\t\t\tonFulfilled = (value: T) => value as any as U;\n\t\t}\n\n\t\tif (typeof onRejected !== \"function\") {\n\t\t\tonRejected = (reason: any): U => { throw reason; };\n\t\t}\n\n\t\tconst fulfillReaction: FulfilledPromiseReaction<T, U> = {\n\t\t\tcapabilities: resultCapability,\n\t\t\thandler: onFulfilled,\n\t\t};\n\n\t\tconst rejectReaction: RejectedPromiseReaction<U> = {\n\t\t\tcapabilities: resultCapability,\n\t\t\thandler: onRejected,\n\t\t};\n\n\t\tswitch (this._state) {\n\t\t\tcase SimplePromiseState.PENDING:\n\t\t\t\tthis._fulfillReactions.push(fulfillReaction);\n\t\t\t\tthis._rejectReactions.push(rejectReaction);\n\t\t\t\tbreak;\n\n\t\t\tcase SimplePromiseState.FULFILLED:\n\t\t\t\tthis._enqueueFulfilledReactionJob(fulfillReaction, this._fulfilledValue!);\n\t\t\t\tbreak;\n\n\t\t\tcase SimplePromiseState.REJECTED:\n\t\t\t\tthis._enqueueRejectedReactionJob(rejectReaction, this._rejectedReason);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn resultCapability.promise;\n\t}\n\n\t/**\n\t * @param {function(*):(T|!Thenable.<T>)} onRejected\n\t * @return {!Promise.<T>}\n\t */\n\tcatch(onRejected: (reason: any) => T | Thenable<T>): Promise<T> {\n\t\treturn this.then(undefined, onRejected);\n\t}\n\n\t/**\n\t * @return {{ resolve(T|!Thenable.<T>), reject(*) }}\n\t */\n\tprivate _createResolvingFunctions(): { resolve(resolution: T | Thenable<T>): void; reject(reason: any): void; } {\n\t\tlet alreadyResolved = false;\n\n\t\tconst resolve = (resolution: T | Thenable<T>): void => {\n\t\t\tif (alreadyResolved) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\talreadyResolved = true;\n\n\t\t\tif (resolution === this) {\n\t\t\t\tthis._reject(new TypeError(`resolution === this`));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (resolution === null || (typeof resolution !== \"object\" && typeof resolution !== \"function\")) {\n\t\t\t\tthis._fulfill(resolution as T);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tvar then = (resolution as Thenable<T>).then;\n\t\t\t}\n\t\t\tcatch (ex) {\n\t\t\t\tthis._reject(ex);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (typeof then !== \"function\") {\n\t\t\t\tthis._fulfill(resolution as T);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tenqueueJob(() => this._resolveWithThenable(resolution as Thenable<T>, then));\n\t\t};\n\n\t\tconst reject = (reason: any): void => {\n\t\t\tif (alreadyResolved) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\talreadyResolved = true;\n\n\t\t\tthis._reject(reason);\n\t\t};\n\n\t\treturn { resolve, reject };\n\t}\n\n\t/**\n\t * @param {!Thenable.<T>} thenable\n\t * @param {{function(this:!Thenable.<T>, function(T|!Thenable.<T>), function(*))}} then\n\t */\n\tprivate _resolveWithThenable(thenable: Thenable<T>, then: ThenableThen<T>): void {\n\t\tconst { resolve, reject } = this._createResolvingFunctions();\n\n\t\ttry {\n\t\t\tthen.call(thenable, resolve, reject);\n\t\t}\n\t\tcatch (ex) {\n\t\t\treject(ex);\n\t\t}\n\t}\n\n\t/**\n\t * @param {T} value\n\t */\n\tprivate _fulfill(value: T): void {\n\t\tconst reactions = this._fulfillReactions;\n\n\t\tthis._fulfilledValue = value;\n\t\tthis._fulfillReactions = [];\n\t\tthis._rejectReactions = [];\n\t\tthis._state = SimplePromiseState.FULFILLED;\n\n\t\tfor (const reaction of reactions) {\n\t\t\tthis._enqueueFulfilledReactionJob(reaction, value);\n\t\t}\n\t}\n\n\t/**\n\t * @param {*} reason\n\t */\n\tprivate _reject(reason: any): void {\n\t\tconst reactions = this._rejectReactions;\n\n\t\tthis._rejectedReason = reason;\n\t\tthis._fulfillReactions = [];\n\t\tthis._rejectReactions = [];\n\t\tthis._state = SimplePromiseState.REJECTED;\n\n\t\tfor (const reaction of reactions) {\n\t\t\tthis._enqueueRejectedReactionJob(reaction, reason);\n\t\t}\n\t}\n\n\t/**\n\t * @param {!FulfilledPromiseReaction.<T, *>} reaction\n\t * @param {T} value\n\t */\n\tprivate _enqueueFulfilledReactionJob(reaction: FulfilledPromiseReaction<T, any>, value: T): void {\n\t\tenqueueJob(() => {\n\t\t\tconst { capabilities: { resolve, reject }, handler } = reaction;\n\n\t\t\tlet handlerResult: any | Thenable<any>;\n\n\t\t\ttry {\n\t\t\t\thandlerResult = handler(value);\n\t\t\t}\n\t\t\tcatch (ex) {\n\t\t\t\treject(ex);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresolve(handlerResult);\n\t\t});\n\t}\n\n\t/**\n\t * @param {!RejectedPromiseReaction.<*>} reaction\n\t * @param {*} reason\n\t */\n\tprivate _enqueueRejectedReactionJob(reaction: RejectedPromiseReaction<any>, reason: any): void {\n\t\tenqueueJob(() => {\n\t\t\tconst { capabilities: { resolve, reject }, handler } = reaction;\n\n\t\t\tlet handlerResult: any | Thenable<any>;\n\n\t\t\ttry {\n\t\t\t\thandlerResult = handler(reason);\n\t\t\t}\n\t\t\tcatch (ex) {\n\t\t\t\treject(ex);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresolve(handlerResult);\n\t\t});\n\t}\n}\n\n/**\n * Set to the global implementation of Promise if the environment has one, else set to {@link ./utility/promise.SimplePromise}\n *\n * Can be set to a value using {@link libjass.configure}\n *\n * Set it to null to force {@link ./utility/promise.SimplePromise} to be used even if a global Promise is present.\n *\n * @type {function(new:Promise)}\n */\nexport var Promise: {\n\tnew <T>(init: (resolve: (value: T | Thenable<T>) => void, reject: (reason: any) => void) => void): Promise<T>;\n\tprototype: Promise<any>;\n\tresolve<T>(value: T | Thenable<T>): Promise<T>;\n\treject<T>(reason: any): Promise<T>;\n\tall<T>(values: (T | Thenable<T>)[]): Promise<T[]>;\n\trace<T>(values: (T | Thenable<T>)[]): Promise<T>;\n} = global.Promise || SimplePromise;\n\ndeclare var global: {\n\tPromise?: typeof Promise;\n\tMutationObserver?: typeof MutationObserver;\n\tWebkitMutationObserver?: typeof MutationObserver;\n\tprocess?: {\n\t\tnextTick(callback: () => void): void;\n\t}\n};\n\ninterface FulfilledPromiseReaction<T, U> {\n\t/** @type {!libjass.DeferredPromise.<U>} */\n\tcapabilities: DeferredPromise<U>;\n\n\t/**\n\t * @param {T} value\n\t * @return {U|!Thenable.<U>}\n\t */\n\thandler(value: T): U | Thenable<U>;\n}\n\ninterface RejectedPromiseReaction<U> {\n\t/** @type {!libjass.DeferredPromise.<U>} */\n\tcapabilities: DeferredPromise<U>;\n\n\t/**\n\t * @param {*} reason\n\t * @return {U|!Thenable.<U>}\n\t */\n\thandler(reason: any): U | Thenable<U>;\n}\n\n/**\n * The state of the {@link ./utility/promise.SimplePromise}\n */\nenum SimplePromiseState {\n\tPENDING = 0,\n\tFULFILLED = 1,\n\tREJECTED = 2,\n}\n\n/**\n * Sets the Promise implementation used by libjass to the provided one. If null, {@link ./utility/promise.SimplePromise} is used.\n *\n * @param {?function(new:Promise)} value\n */\nexport function setImplementation(value: typeof Promise | null): void {\n\tif (value !== null) {\n\t\tPromise = value;\n\t}\n\telse {\n\t\tPromise = SimplePromise;\n\t}\n}\n\n/**\n * A deferred promise.\n */\nexport class DeferredPromise<T> {\n\t/**\n\t * @type {function(T|!Thenable.<T>)}\n\t */\n\tresolve: (value: T | Thenable<T>) => void;\n\n\t/**\n\t * @type {function(*)} reason\n\t */\n\treject: (reason: any) => void;\n\n\tprivate _promise: Promise<T>;\n\n\tconstructor() {\n\t\tthis._promise = new Promise<T>((resolve, reject) => {\n\t\t\tObject.defineProperties(this, {\n\t\t\t\tresolve: { value: resolve, enumerable: true },\n\t\t\t\treject: { value: reject, enumerable: true },\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * @type {!Promise.<T>}\n\t */\n\tget promise(): Promise<T> {\n\t\treturn this._promise;\n\t}\n}\n\n/**\n * Returns a promise that resolves to the first (in iteration order) promise that fulfills, and rejects if all the promises reject.\n *\n * @param {!Array.<!Promise.<T>>} promises\n * @return {!Promise.<T>}\n */\nexport function first<T>(promises: Promise<T>[]): Promise<T> {\n\treturn first_rec(promises, []);\n}\n\n/**\n * @param {!Array.<!Promise.<T>>} promises\n * @param {!Array.<*>} previousRejections\n * @return {!Promise.<T>}\n */\nfunction first_rec<T>(promises: Promise<T>[], previousRejections: any[]): Promise<T> {\n\tif (promises.length === 0) {\n\t\treturn Promise.reject(previousRejections);\n\t}\n\n\tconst [head, ...tail] = promises;\n\treturn head.catch(reason => first_rec(tail, previousRejections.concat(reason)));\n}\n\n/**\n * Returns a promise that resolves to the first (in time order) promise that fulfills, and rejects if all the promises reject.\n *\n * @param {!Array.<!Promise.<T>>} promises\n * @return {!Promise.<T>}\n */\nexport function any<T>(promises: Promise<T>[]): Promise<T> {\n\treturn new Promise<T>((resolve, reject) =>\n\t\tPromise.all<any>(promises.map(promise => promise.then(resolve, reason => reason))).then(reject));\n}\n\n/**\n * Returns a promise that runs the given callback when the promise has resolved regardless of whether it fulfilled or rejected.\n *\n * @param {!Promise.<T>} promise\n * @param {function()} body\n * @return {!Promise.<T>}\n */\nexport function lastly<T>(promise: Promise<T>, body: () => void): Promise<T> {\n\treturn promise.then<any>(value => {\n\t\tbody();\n\t\treturn value;\n\t}, reason => {\n\t\tbody();\n\t\tthrow reason;\n\t});\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface Map<K, V> {\n\t/**\n\t * @type {number}\n\t */\n\tsize: number;\n\n\t/**\n\t * @param {K} key\n\t * @return {?V}\n\t */\n\tget(key: K): V | undefined;\n\n\t/**\n\t * @param {K} key\n\t * @return {boolean}\n\t */\n\thas(key: K): boolean;\n\n\t/**\n\t * @param {K} key\n\t * @param {V} value\n\t * @return {libjass.Map.<K, V>} This map\n\t */\n\tset(key: K, value: V): this;\n\n\t/**\n\t * @param {K} key\n\t * @return {boolean} true if the key was present before being deleted, false otherwise\n\t */\n\tdelete(key: K): boolean;\n\n\t/**\n\t */\n\tclear(): void;\n\n\t/**\n\t * @param {function(V, K, libjass.Map.<K, V>)} callbackfn A function that is called with each key and value in the map.\n\t * @param {*} thisArg\n\t */\n\tforEach(callbackfn: (value: V, index: K, map: this) => void, thisArg?: any): void;\n}\n\n/**\n * Map implementation for browsers that don't support it. Only supports keys which are of Number or String type, or which have a property called \"id\".\n *\n * Keys and values are stored as properties of an object, with property names derived from the key type.\n *\n * @param {!Array.<!Array.<*>>=} iterable Only an array of elements (where each element is a 2-tuple of key and value) is supported.\n */\nclass SimpleMap<K, V> implements Map<K, V> {\n\tprivate _keys: { [key: string]: K };\n\tprivate _values: { [key: string]: V };\n\tprivate _size: number;\n\n\tconstructor(iterable?: [K, V][]) {\n\t\tthis.clear();\n\n\t\tif (iterable === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(iterable)) {\n\t\t\tthrow new Error(\"Non-array iterables are not supported by the SimpleMap constructor.\");\n\t\t}\n\n\t\tfor (const element of iterable) {\n\t\t\tthis.set(element[0], element[1]);\n\t\t}\n\t}\n\n\t/**\n\t * @param {K} key\n\t * @return {?V}\n\t */\n\tget(key: K): V | undefined {\n\t\tconst property = this._keyToProperty(key);\n\n\t\tif (property === null) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn this._values[property];\n\t}\n\n\t/**\n\t * @param {K} key\n\t * @return {boolean}\n\t */\n\thas(key: K): boolean {\n\t\tconst property = this._keyToProperty(key);\n\n\t\tif (property === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn property in this._keys;\n\t}\n\n\t/**\n\t * @param {K} key\n\t * @param {V} value\n\t * @return {libjass.Map.<K, V>} This map\n\t */\n\tset(key: K, value: V): this {\n\t\tconst property = this._keyToProperty(key);\n\n\t\tif (property === null) {\n\t\t\tthrow new Error(\"This Map implementation only supports Number and String keys, or keys with an id property.\");\n\t\t}\n\n\t\tif (!(property in this._keys)) {\n\t\t\tthis._size++;\n\t\t}\n\n\t\tthis._keys[property] = key;\n\t\tthis._values[property] = value;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * @param {K} key\n\t * @return {boolean} true if the key was present before being deleted, false otherwise\n\t */\n\tdelete(key: K): boolean {\n\t\tconst property = this._keyToProperty(key);\n\n\t\tif (property === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst result = property in this._keys;\n\n\t\tif (result) {\n\t\t\tdelete this._keys[property];\n\t\t\tdelete this._values[property];\n\t\t\tthis._size--;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t/**\n\t */\n\tclear(): void {\n\t\tthis._keys = Object.create(null);\n\t\tthis._values = Object.create(null);\n\t\tthis._size = 0;\n\t}\n\n\t/**\n\t * @param {function(V, K, libjass.Map.<K, V>)} callbackfn A function that is called with each key and value in the map.\n\t * @param {*} thisArg\n\t */\n\tforEach(callbackfn: (value: V, index: K, map: this) => void, thisArg?: any): void {\n\t\tfor (const property of Object.keys(this._keys)) {\n\t\t\tcallbackfn.call(thisArg, this._values[property], this._keys[property], this);\n\t\t}\n\t}\n\n\t/**\n\t * @type {number}\n\t */\n\tget size(): number {\n\t\treturn this._size;\n\t}\n\n\t/**\n\t * Converts the given key into a property name for the internal map.\n\t *\n\t * @param {K} key\n\t * @return {?string}\n\t */\n\tprivate _keyToProperty(key: K): string | null {\n\t\tif (typeof key === \"number\") {\n\t\t\treturn `#${ key }`;\n\t\t}\n\n\t\tif (typeof key === \"string\") {\n\t\t\treturn `'${ key }`;\n\t\t}\n\n\t\tif ((key as any).id !== undefined) {\n\t\t\treturn `!${ (key as any).id }`;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\n/**\n * Set to the global implementation of Map if the environment has one, else set to {@link ./utility/map.SimpleMap}\n *\n * Can be set to a value using {@link libjass.configure}\n *\n * Set it to null to force {@link ./utility/map.SimpleMap} to be used even if a global Map is present.\n *\n * @type {function(new:Map, !Array.<!Array.<*>>=)}\n */\nexport var Map: {\n\tnew <K, V>(iterable?: [K, V][]): Map<K, V>;\n\tprototype: Map<any, any>;\n} = global.Map || SimpleMap;\n\nif (typeof Map.prototype.forEach !== \"function\" || (() => {\n\ttry {\n\t\treturn new Map([[1, \"foo\"], [2, \"bar\"]]).size !== 2;\n\t}\n\tcatch (ex) {\n\t\treturn true;\n\t}\n})()) {\n\tMap = SimpleMap;\n}\n\ndeclare var global: {\n\tMap?: typeof Map;\n};\n\n/**\n * Sets the Map implementation used by libjass to the provided one. If null, {@link ./utility/map.SimpleMap} is used.\n *\n * @param {?function(new:Map, !Array.<!Array.<*>>=)} value\n */\nexport function setImplementation(value: typeof Map | null): void {\n\tif (value !== null) {\n\t\tMap = value;\n\t}\n\telse {\n\t\tMap = SimpleMap;\n\t}\n}\n","/**\n * libjass\n *\n * https://github.com/Arnavion/libjass\n *\n * Copyright 2013 Arnav Singh\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface Set<T> {\n\t/**\n\t * @type {number}\n\t */\n\tsize: number;\n\n\t/**\n\t * @param {T} value\n\t * @return {libjass.Set.<T>} This set\n\t */\n\tadd(value: T): this;\n\n\t/**\n\t */\n\tclear(): void;\n\n\t/**\n\t * @param {T} value\n\t * @return {boolean}\n\t */\n\thas(value: T): boolean;\n\n\t/**\n\t * @param {function(T, T, libjass.Set.<T>)} callbackfn A function that is called with each value in the set.\n\t * @param {*} thisArg\n\t */\n\tforEach(callbackfn: (value: T, index: T, set: this) => void, thisArg?: any): void;\n}\n\n/**\n * Set implementation for browsers that don't support it. Only supports Number and String elements.\n *\n * Elements are stored as properties of an object, with names derived from their type.\n *\n * @param {!Array.<T>=} iterable Only an array of values is supported.\n */\nclass SimpleSet<T> implements Set<T> {\n\tprivate _elements: { [key: string]: T };\n\tprivate _size: number;\n\n\tconstructor(iterable?: T[]) {\n\t\tthis.clear();\n\n\t\tif (iterable === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(iterable)) {\n\t\t\tthrow new Error(\"Non-array iterables are not supported by the SimpleSet constructor.\");\n\t\t}\n\n\t\tfor (const value of iterable) {\n\t\t\tthis.add(value);\n\t\t}\n\t}\n\n\t/**\n\t * @param {T} value\n\t * @return {libjass.Set.<T>} This set\n\t */\n\tadd(value: T): this {\n\t\tconst property = this._toProperty(value);\n\n\t\tif (property === null) {\n\t\t\tthrow new Error(\"This Set implementation only supports Number and String values.\");\n\t\t}\n\n\t\tif (!(property in this._elements)) {\n\t\t\tthis._size++;\n\t\t}\n\n\t\tthis._elements[property] = value;\n\n\t\treturn this;\n\t}\n\n\t/**\n\t */\n\tclear(): void {\n\t\tthis._elements = Object.create(null);\n\t\tthis._size = 0;\n\t}\n\n\t/**\n\t * @param {T} value\n\t * @return {boolean}\n\t */\n\thas(value: T): boolean {\n\t\tconst property = this._toProperty(value);\n\n\t\tif (property === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn property in this._elements;\n\t}\n\n\t/**\n\t * @param {function(T, T, libjass.Set.<T>)} callbackfn A function that is called with each value in the set.\n\t * @param {*} thisArg\n\t */\n\tforEach(callbackfn: (value: T, index: T, set: this) => void, thisArg?: any): void {\n\t\tfor (const property of Object.keys(this._elements)) {\n\t\t\tconst element = this._elements[property];\n\t\t\tcallbackfn.call(thisArg, element, element, this);\n\t\t}\n\t}\n\n\t/**\n\t * @type {number}\n\t */\n\tget size(): number {\n\t\treturn this._size;\n\t}\n\n\t/**\n\t * Converts the given value into a property name for the internal map.\n\t *\n\t * @param {T} value\n\t * @return {?string}\n\t */\n\tprivate _toProperty(value: T): string | null {\n\t\tif (typeof value === \"number\") {\n\t\t\treturn `#${ value }`;\n\t\t}\n\n\t\tif (typeof value === \"string\") {\n\t\t\treturn `'${ value }`;\n\t\t}\n\n\t\treturn null;\n\t}\n}\n\n/**\n * Set to the global implementation of Set if the environment has one, else set to {@link ./utility/set.SimpleSet}\n *\n * Can be set to a value using {@link libjass.configure}\n *\n * Set it to null to force {@link ./utility/set.SimpleSet} to be used even if a global Set is present.\n *\n * @type {function(new:Set, !Array.<T>=)}\n */\nexport var Set: {\n\tnew <T>(iterable?: T[]): Set<T>;\n\tprototype: Set<any>;\n} = global.Set || SimpleSet;\n\nif (typeof Set.prototype.forEach !== \"function\" || (() => {\n\ttry {\n\t\treturn new Set([1, 2]).size !== 2;\n\t}\n\tcatch (ex) {\n\t\treturn true;\n\t}\n})()) {\n\tSet = SimpleSet;\n}\n\ndeclare var global: {\n\tSet?: typeof Set;\n};\n\n/**\n * Sets the Set implementation used by libjass to the provided one. If null, {@link ./utility/set.SimpleSet} is used.\n *\n * @param {?function(new:Set, !Array.<T>=)} value\n */\nexport function setImplementation(value: typeof Set | null): void {\n\tif (value !== null) {\n\t\tSet = value;\n\t}\n\telse {\n\t\tSet = SimpleSet;\n\t}\n}\n"]}